<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0048)http://www.vckbase.com/document/viewdoc/?id=1641 -->
<HTML><HEAD><TITLE>VC知识库文章 - 在VC中调用&nbsp; WebService</TITLE>
<META http-equiv=Content-Type content="text/html; charset=gb2312">
<META content=webservice,web,service,服务 name=keywords>
<META content=webservice,web,service,服务 name=description><LINK 
href="VC知识库文章 - 在VC中调用&nbsp; WebService.files/style.css" rel=stylesheet>
<META content="MSHTML 6.00.2900.3314" name=GENERATOR></HEAD>
<BODY bgColor=#ffffff leftMargin=0 topMargin=0>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR bgColor=#a0d39b>
    <TD width="14%" height=78>&nbsp;<IMG height=13 
      src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/vckcom.gif" width=109></TD>
    <TD align=left width="76%"></TD>
    <TD vAlign=bottom align=right height=78><IMG height=27 
      src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/earch.gif" width=89></TD></TR>
  <TR bgColor=#eeeeee>
    <TD colSpan=2><FONT class=small color=#333333>::</FONT><A 
      href="http://www.vckbase.com/"><FONT color=black><SPAN 
      class=small>首页</SPAN></FONT></A> &gt;&gt; <A 
      href="http://www.vckbase.com/document"><FONT color=black><SPAN 
      class=small>文档中心</SPAN></FONT></A> &gt;&gt; <A 
      href="http://www.vckbase.com/document/journal"><SPAN class=small><FONT 
      color=black>在线杂志</FONT></SPAN></A> &gt;&gt; <A 
      href="http://www.vckbase.com/document/listdoc.asp?sclsid=1915"><SPAN 
      class=small><FONT color=black>XML Web 服务</FONT></SPAN></A></TD>
    <TD class=small align=right width="10%">[ <A 
      href="http://www.vckbase.com/document/journal/redir.asp?journal=47"><SPAN 
      class=small><FONT color=black>在线杂志 第47期</FONT></SPAN></A> ] 
</TD></TR></TBODY></TABLE>
<DIV align=center><BR><A href="http://www.uipower.com/" target=_blank><IMG 
height=116 src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/skin11.gif" width=990 
border=0></A> <!--br>
 <script type="text/javascript">
google_ad_client = "pub-4159669282587342";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "image";
google_ad_channel = "";
</script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script--></DIV><BR>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD background="VC知识库文章 - 在VC中调用&nbsp; WebService.files/dotline2.gif" 
    height=1></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD width=40 height=74></TD>
    <TD vAlign=top width=* height=74>
      <FORM name=form2 action=/SYS/script/find.asp method=post>
      <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR>
          <TD><SPAN id=docinfo>[ <FONT color=#009900>原创文档</FONT> 本文适合中级读者 
            已阅读11719次 ]</SPAN></TD>
          <TD align=right><INPUT class=rect maxLength=20 size=10 name=keyword> 
            <SELECT class=rect name=gclsid> <OPTION value=100 
              selected>文档</OPTION> <OPTION value=200>代码</OPTION> <OPTION 
              value=400>工具</OPTION></SELECT> <INPUT type=image height=15 width=21 
            src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/go.gif" align=absMiddle 
            border=0 name=imageField> </TD></TR></TBODY></TABLE></FORM>
      <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR>
          <TD>
            <P align=center><B>在VC中调用&nbsp; WebService <BR></B><BR>作者：<A 
            href="mailto:yexiaozhou2003@hotmail.com">叶小舟</A></P>
            <P><A 
            href="http://www.vckbase.com/code/downcode.asp?id=2892">下载源代码</A>
            <P><BR>一、什么是&nbsp; WebService ？<BR><BR>&nbsp;WebService&nbsp; 
            其实就是一个基于网络的应用程序,它向外部程序提供一定的调用接口。外部（远程）的程序，可以经由Web对其进行调用。
            <P>二、 WebService 的特性：<BR><BR>1.由于 WebService 
            经由web服务器发布，所以比DCOM而言，可以顺利穿过防火墙。这也是 WebService 的优点之一，可以说， WebService 
            ,为分布 式应用的开发，提供了一个很好的平台。<BR>2.对 WebService 
            的调用，是通过SOAP协议进行的。简单对象访问协议(SOAP)提供了标准的远程过程调用(RPC)方法来调用Web service。 
            而SOAP也是基于XML和XSD的，XML是SOAP的数据编码方式,因此，对 WebService 的调用也可以是跨平台的。、
            <P>三、怎样调用&nbsp; WebService ?<BR><BR>　　Visual Studio.NET 内建提供了对 
            WebService 的调用。在VC.NET中，调用 WebService 只需要简单的几个步骤即可。只要找到 WebService 
            的发布 地址，将地址引入到VC工程中。这时，编译器会预先编译一次，自动生成和 WebService 
            相关的头文件（也可以叫Web代理文件） WebService .h。 在你的程序中，包含 WebService 
            .h然后生成相关的对象，就可以对远程的 WebService 进行调用了。<BR><BR>　　为演示怎样调用 WebService 
            ，我们用网上一个已经发布的 WebService ，名字叫TranslateService，其功能是对多种语言进行互相翻译。 这个 
            WebService 的地址如下： <A 
            href="http://www.webservicex.net/TranslateService.asmx">http://www.WebServicex.net/TranslateService.asmx</A>
            <P>四、程序示例<BR><BR>1.基于控制台的托管程序示例<BR><BR>下面，我们先介绍VC.net中，基于控制台的托管程序，调用 
            WebService 的例子：<BR><BR>启动Visual Studio.NET 2003，新建一个Visual 
            C++项目，类型选择为基于.NET的托管控制台应用。然后，引入 WebService 到工程，在解决方案 
            的项目名称上，单击右键，选择“添加Web引用”。如下图（图1）：
            <P><IMG height=431 
            src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/vcwebservicepic1.jpg" 
            width=268 border=0><BR>图1 添加 WebService 引用到工程中
            <P>　　填入 WebService 的地址，然后点击”转到”按钮。 WebService 
            的相关细节，会被显示在下面。Web引用名，可以采用默认的名字，也可以自己设置 
            一个，在这里，我们起名叫TService。然后点击“添加引用”（图2），编译器自动生成TService.h以及 WebService 
            .h。在 WebService .h里面已经包含了 TService.h。在工程的代码中，我们直接包含头文件 WebService 
            .h即可。
            <P><IMG height=463 
            src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/vcwebservicepic2.jpg" 
            width=701 border=0><BR>图2 添加 WebService 
            <P>　　TService.h是由编译器自动生成的，打开文件，我们可以看到，在命名空间TService中，编译器为我们自动封装了一个叫TranslateService的托管 
            类，以及一个名字叫Language的枚举类型。<BR><BR>Language类型在这个 WebService 
            中，用来描述翻译语言的类型，比如：<BR><BR>EnglishTOChinese（英语到中文）<BR>ChineseTOEnglish（中文到英语）<BR>EnglishTOGerman 
            （英语到德语）<BR>EnglishTOFrench 
            （英语到法语）<BR>等等……<BR><BR>在测试程序中，我们选择英语到中文的形式。<BR></P><PRE>#include "stdafx.h"
#include " WebService .h"
//包含 WebService .h头文件到程序中

#using <MSCORLIB.DLL>

using namespace System;
using namespace TService;
//使用TService的命名空间

int _tmain()
{
	String *str=new String(S"Hello,world!");
	String *strResult;
	TranslateService *pService=new TranslateService; //建立远程 WebService 对象
	Language Lan=Language::EnglishTOChinese;   //设置翻译类型
	strResult=pService-&gt;Translate(Lan,str);     //调用 WebService 
	Console::WriteLine(str);
	Console::WriteLine(strResult);              //输出结果
	return 0;
}
</PRE>程序结果如下：(图3）
            <P><IMG height=247 
            src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/vcwebservicepic3.jpg" 
            width=357 border=0></P>
            <P>2.基于MFC的程序示例<BR><BR>　　在MFC程序中，一样可以调用 WebService 
            ，我们可以建立一个简单的基于对话框的MFC程序，工程名字为TranslateMFC。由于需要使用托管类型，所以 
            在编译器设置里面，需要打开/clr开关。(图4）选择项目―TranslateMFC属性，打开项目的属性页，在常规，下面的使用托管扩展选项，将其选择为“是”。 
            这样，我们的项目就支持托管了C++扩展了。</P>
            <P><IMG height=460 
            src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/vcwebservicepic4.jpg" 
            width=644 border=0><BR>图4 在工程属性打开clr开关</P>
            <P>　　和上一个例子的方法一样，引用 WebService 到工程，创建 WebService 对象，然后调用 WebService 
            。不过在MFC中，我们如果直接用new来创建 WebService 对象的时候，编译器会报错（如下图）这是为什么呢？</P>
            <P><IMG height=121 
            src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/vcwebservicepic5.jpg" 
            width=522 border=0><BR>图5 编译产生的C3828错误</P>
            <P>　　为了跟踪内存的使用情况，在 MFC 调试版本中使用时 MFC 重定义 new 运算符。由于此重定义的缘故，会在 MFC 
            应用程序中创建托管类的实例，从而导致错误。在将现有 MFC 
            代码移植到公共语言运行库时通常会发生这种情况。对于发布版本不会发生该错误，这是因为 MFC 不重定义 new 
            运算符。在以下示例中，放置在 .cpp 文件中的托管代码创建 String 类的一个实例。这将导致在 MFC 
            应用程序调试版本中进行编译时发生C3828编译器错误。若要避免该错误，可在创建托管类型实例前，使用#undef 和 
            push_macro指令暂时取消定义 new 运算符。在最后一行托管代码的后面，使用pop_macro 还原先前的 new 
            运算符定义。示例代码如下：(图6)</P>
            <P><IMG height=116 
            src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/vcwebservicepic6.jpg" 
            width=340 border=0></P>
            <P>　　由于此 WebService 
            支持30多中语言类型的转换，在这里，为示例简单，我只保留了几门语言的转换功能。其他的语言，只需要判断的时候，加入不同 
            Language枚举类型即可。<BR><BR>下面是程序运行的结果演示：</P>
            <P><IMG height=237 
            src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/vcwebservicepic7.jpg" 
            width=389 border=0><BR>图7 MFC程序运行界面</P>
            <P><IMG height=237 
            src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/vcwebservicepic8.jpg" 
            width=389 border=0><BR>图7 英文翻译为中文</P>
            <P><IMG height=237 
            src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/vcwebservicepic9.jpg" 
            width=389 border=0><BR>图8 英文翻译为日文</P>
            <P><IMG height=237 
            src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/vcwebservicepic10.jpg" 
            width=389 border=0><BR>图9 英文翻译为法文</P>
            <P>五、结束语 <BR><BR>　　通过以上的例子，我们看到了 WebService 
            为构建分布式应用，提供了强大的功能支持。<BR>更多的有关 WebService 的问题，请访问<A 
            href="http://www.microsoft.com/china/MSDN/library/WebServices">http://www.microsoft.com/china/MSDN/library/WebServices</A>获取更多的信息 
            <BR><BR>补充：该程序的运行，需要.NET FrameWork的支持。</P>
            <P></P></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR>
<DIV align=center>
<SCRIPT type=text/javascript><!--
google_ad_client = "pub-4159669282587342";
google_alternate_color = "FFFFFF";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "text_image";
google_ad_channel ="";
google_color_border = "B4D0DC";
google_color_bg = "ECF8FF";
google_color_link = "0000CC";
google_color_url = "008000";
google_color_text = "6F6F6F";
//--></SCRIPT>

<SCRIPT src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/show_ads.js" 
type=text/javascript>
</SCRIPT>
<BR><BR>
<TABLE class=small height=18 cellSpacing=0 cellPadding=0 width="98%" border=0>
  <TBODY>
  <TR vAlign=center>
    <TD width="47%" bgColor=#a0d39b><IMG height=10 
      src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/toplogo.gif" width=10>最新评论 <A 
      href="http://www.vckbase.com/SYS/script/viewcomment.asp?gclsid=100&amp;itemid=1641" 
      target=_blank><SPAN class=small>[发表评论]</SPAN></A> <A 
      href="http://www.vckbase.com/support/contribute.html" target=_blank><SPAN 
      class=small>[文章投稿]</SPAN></A></TD>
    <TD align=right width="53%" bgColor=#a0d39b><IMG height=9 
      src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/rec1.gif" width=9> <A 
      href="http://www.vckbase.com/SYS/script/viewcomment.asp?gclsid=100&amp;itemid=1641" 
      target=_blank><SPAN class=small>查看所有评论</SPAN></A> <IMG height=9 
      src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/rec1.gif" width=9> <A 
      href="http://www.vckbase.com/SYS/script/writemail.asp?gclsid=100&amp;itemid=1641&amp;title=%d4%daVC%d6%d0%b5%f7%d3%c3%26nbsp%3b+WebService" 
      target=_blank><SPAN class=small>推荐给好友</SPAN></A> <IMG height=9 
      src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/rec1.gif" width=9> <A 
      href="javascript:window.print();"><SPAN 
  class=small>打印</SPAN></A></TD></TR></TBODY></TABLE>
<TABLE class=small cellSpacing=1 cellPadding=0 width="98%" bgColor=#ffffff 
border=0>
  <TBODY>
  <TR>
    <TD bgColor=#ffffff><BR><IMG height=11 
      src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/doc2.gif" width=11 
      align=absMiddle> 好文！！ ( musicfan 发表于 2007-11-7 16:02:00)<BR>&nbsp;<BR><IMG 
      height=11 src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/doc2.gif" width=11 
      align=absMiddle> 呵呵，你这个问法明显是做不到的 ( qqonline 发表于 2006-10-10 
      18:54:00)<BR>&nbsp;<BR><IMG height=11 
      src="VC知识库文章 - 在VC中调用&nbsp; WebService.files/doc2.gif" width=11 
      align=absMiddle> VS.NET编译的NET程序，怎么样编译成native格式，做到不依赖NetFramework运行。 ( 
      littlestar 发表于 2006-4-29 
      13:58:00)<BR>&nbsp;<BR>.......................................................<BR><A 
      href="http://www.vckbase.com/SYS/script/viewcomment.asp?gclsid=100&amp;itemid=1641" 
      target=_blank><SPAN class=small>More...</SPAN></A> 
</TD></TR></TBODY></TABLE></DIV><BR>
<DIV align=right><BR><SPAN class=small>版权所有 &copy; 1999 - 2008 VC知识库&nbsp; 
<BR><BR></SPAN></DIV></BODY></HTML>
