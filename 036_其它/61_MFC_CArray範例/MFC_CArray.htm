<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0048)http://www.vckbase.com/document/viewdoc/?id=1668 -->
<HTML><HEAD><TITLE>VC知识库文章 - 使用MFC的数组类</TITLE>
<META http-equiv=Content-Type content="text/html; charset=gb2312">
<META content=array,mfc name=keywords>
<META content=array,mfc name=description><LINK href="MFC_CArray.files/style.css" 
rel=stylesheet>
<META content="MSHTML 6.00.2900.3354" name=GENERATOR></HEAD>
<BODY bgColor=#ffffff leftMargin=0 topMargin=0>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR bgColor=#a0d39b>
    <TD width="14%" height=78>&nbsp;<IMG height=13 
      src="MFC_CArray.files/vckcom.gif" width=109></TD>
    <TD align=left width="76%"></TD>
    <TD vAlign=bottom align=right height=78><IMG height=27 
      src="MFC_CArray.files/earch.gif" width=89></TD></TR>
  <TR bgColor=#eeeeee>
    <TD colSpan=2><FONT class=small color=#333333>::</FONT><A 
      href="http://www.vckbase.com/"><FONT color=black><SPAN 
      class=small>首页</SPAN></FONT></A> &gt;&gt; <A 
      href="http://www.vckbase.com/document"><FONT color=black><SPAN 
      class=small>文档中心</SPAN></FONT></A> &gt;&gt; <A 
      href="http://www.vckbase.com/document/journal"><SPAN class=small><FONT 
      color=black>在线杂志</FONT></SPAN></A> &gt;&gt; <A 
      href="http://www.vckbase.com/document/listdoc.asp?sclsid=101"><SPAN 
      class=small><FONT color=black>C++、MFC</FONT></SPAN></A></TD>
    <TD class=small align=right width="10%">[ <A 
      href="http://www.vckbase.com/document/journal/redir.asp?journal=48"><SPAN 
      class=small><FONT color=black>在线杂志 第48期</FONT></SPAN></A> ] 
</TD></TR></TBODY></TABLE>
<DIV align=center><BR><A href="http://www.uipower.com/" target=_blank><IMG 
height=116 src="MFC_CArray.files/skin11.gif" width=990 border=0></A> <!--br>
 <script type="text/javascript">
google_ad_client = "pub-4159669282587342";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "image";
google_ad_channel = "";
</script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script--></DIV><BR>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD background=MFC_CArray.files/dotline2.gif height=1></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD width=40 height=74></TD>
    <TD vAlign=top width=* height=74>
      <FORM name=form2 action=/SYS/script/find.asp method=post>
      <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR>
          <TD><SPAN id=docinfo>[ <FONT color=#009900>原创文档</FONT> 本文适合初级读者 
            已阅读14001次 ]</SPAN></TD>
          <TD align=right><INPUT class=rect maxLength=20 size=10 name=keyword> 
            <SELECT class=rect name=gclsid> <OPTION value=100 
              selected>文档</OPTION> <OPTION value=200>代码</OPTION> <OPTION 
              value=400>工具</OPTION></SELECT> <INPUT type=image height=15 width=21 
            src="MFC_CArray.files/go.gif" align=absMiddle border=0 
            name=imageField> </TD></TR></TBODY></TABLE></FORM>
      <STYLE>TABLE.MsoTableGrid {
	BORDER-RIGHT: windowtext 1pt solid; BORDER-TOP: windowtext 1pt solid; TEXT-JUSTIFY: inter-ideograph; FONT-SIZE: 10pt; BORDER-LEFT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; FONT-FAMILY: "Times New Roman"; TEXT-ALIGN: justify
}
</STYLE>

      <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR>
          <TD>
            <P align=center><B>使用MFC的数组类</B><BR><BR>作者：<A 
            href="mailto:han_yao_xu@163.com">韩耀旭</A></P>
            <P><A 
            href="http://www.vckbase.com/code/downcode.asp?id=2930">下载源代码</A></P>
            <P>　　MFC的数组类支持的数组类似于C++中的常规数组，可以存放任何数据类型。C++的常规数组在使用前必须将其定义成能够容纳所有可能需要的元素，而MFC数组类创建的对象可以根据需要动态地增大或减小，数组的起始下标是0，而上限可以是固定的，也可以随着元素的增加而增加，数组在内存中的地址仍然是连续分配的。<BR>　　MFC定义了数组模板类CArray，并针对各种常用变量类型定义了CByteArray，CWordArray，CUIntArray，CDWordArray，CStringArray，CObArray，CPtrArray。详见下表：</P>
            <TABLE id=table2 width="64%" border=0>
              <TBODY>
              <TR>
                <TD align=middle><B>数组类</B></TD>
                <TD align=middle><B>变量类型</B></TD>
                <TD align=middle><B>变量数值范围</B></TD>
                <TD align=middle><B>头文件</B></TD></TR>
              <TR>
                <TD align=middle>CArray</TD>
                <TD align=middle>通过模板类的参数类型设定各种类型</TD>
                <TD align=middle>　</TD>
                <TD>Afxtempl.h</TD></TR>
              <TR>
                <TD align=middle>CByteArray</TD>
                <TD align=middle>8位无符号整数 BYTE类型</TD>
                <TD align=middle>0―255 </TD>
                <TD>Afxcoll.h</TD></TR>
              <TR>
                <TD align=middle>CWordArray</TD>
                <TD align=middle>16位无符号整数 WORD类型</TD>
                <TD align=middle>0―65535</TD>
                <TD>Afxcoll.h</TD></TR>
              <TR>
                <TD align=middle>CDWordArray</TD>
                <TD align=middle>32位无符号整数 DWORD类型</TD>
                <TD align=middle>0―4294967295 </TD>
                <TD>Afxcoll.h</TD></TR>
              <TR>
                <TD align=middle>CUIntArray</TD>
                <TD align=middle>32位无符号整数 UINT类型</TD>
                <TD align=middle>0―4294967295 </TD>
                <TD>Afxcoll.h</TD></TR>
              <TR>
                <TD align=middle>CStringArray</TD>
                <TD align=middle>CString字符串 string字符串</TD>
                <TD align=middle>　</TD>
                <TD>Afxcoll.h</TD></TR>
              <TR>
                <TD align=middle>CObArray</TD>
                <TD align=middle>CObject类及其派生类 </TD>
                <TD align=middle>　</TD>
                <TD>Afxcoll.h</TD></TR>
              <TR>
                <TD align=middle>CPtrArray</TD>
                <TD align=middle>void* 类型指针</TD>
                <TD align=middle>　</TD>
                <TD>Afxcoll.h</TD></TR></TBODY></TABLE><BR>MFC数组类使用方法基本相同，下面分别以CArray和CUIntArray为例演示说明数组类的使用方法。
            <P><B>使用 CArray</B> </P>
            <P>打开VC++ 6.0，创建基于对话框的工程Array。CArrayDlg类声明文件（ArrayDlg.h）中添加语句： </P><PRE> #include &lt;afxtempl.h&gt;
</PRE>请记住：使用CArray一定要包含头文件afxtempl.h。 
            <BR><BR>打开主对话框资源IDD_ARRAY_DIALOG，添加一个按钮IDC_ARRAY_CPOINT，标题为CArray_CPoint，双击该按钮，在OnArrayCpoint()函数中添加如下代码： 
<PRE>void CArrayDlg::OnArrayCpoint() 
{
	CArray &lt;CPoint,CPoint&amp;&gt; m_Array;
	m_Array.SetSize(10,10);
	CPoint pt1(10,10);
	m_Array.Add(pt1);
	CPoint pt2(10,50);
	m_Array.Add(pt2);
	CPoint pt3(10,100);
	m_Array.Add(pt3);
	int size=m_Array.GetSize();
	CClientDC dc(this);
	dc.MoveTo(0,0);
	CPoint pt;
	for(int i=0;i&lt;size;i++)
	{
		pt=m_Array.GetAt(i);
		dc.LineTo(pt);
	}
}
</PRE>代码简要说明： <PRE>CArray &lt;CPoint,CPoint&amp;&gt; m_Array;
</PRE>　　该语句定义一个CArray数组对象，模板类CArray有两个参数，第一个参数为数组元素的类型，该例中是CPoint，即m_Array是CPoint数组；第二个参数为引用类型，一般有两种选择，一种选择与第一个参数类型相同，它意味着数组对象作为参数传递时，传递的是数组对象。第二种选择是第一个参数类型的引用，它意味着数组对象作为参数传递时，传递的是数组对象的指针。因此，尤其对于较复杂的数组结构类型，推荐使用引用传递，节约内存同时加快程序运行速度，正如本例使用的是CPoint&amp;。 
<PRE>m_Array.SetSize(10,10);
</PRE>　　SetSize函数设定数组的大小，该函数有两个参数，第一个参数设定数组的大小；第二个参数设定数组增长时内存分配的大小，缺省值是－1，使用缺省值可以保证内存分配得更加合理。本例中第二个参数是10，意即增加一个数组元素会分配10个元素大小的内存供数组使用。 
            <BR>　　您可以随时使用SetSize函数设定数组的大小，如果第一个参数值小于数组已有成员数量，多于第一个参数值的成员将被截去并释放相应内存。<BR>　　在使用CArray数组前，最好先使用SetSize确定其大小并申请存储空间。如果不这样做，向数组中增加元素时，需要不断地移动和拷贝元素造成运行的低效率和内存碎块。 
<PRE>m_Array.Add(pt1);
</PRE>Add函数添加数组元素。 <PRE>int size=m_Array.GetSize();
</PRE>GetSize返回数组元素的数目。 <PRE>for(int i=0;i&lt;size;i++)
{
	pt=m_Array.GetAt(i);
	dc.LineTo(pt);
}
</PRE>　　为了直观显示，该段代码将各数组元素作成折线画到屏幕上，其中GetAt(int 
            index)通过index值得到相应的元素值。编译并运行程序，观察运行结果。<BR><BR><B>继续演示如何使用CArray</B> 
            <BR><BR>　　再次打开主对话框资源IDD_ARRAY_DIALOG，添加一个按钮IDC_ARRAY_CSTRING，标题为CArray_CString，双击该按钮，在OnArrayCstring 
            ()函数中添加如下代码： <PRE>void CArrayDlg::OnArrayCstring() 
{
	CArray<CSTRING,CSTRING&> m_string;
	CString sztiger("tiger");
	CString szbear("bear");
	CString szdog("dog");
	m_string.SetAtGrow(0,sztiger);
	m_string.SetAtGrow(2,szdog);
	m_string.InsertAt(1,szbear);
	int count=m_string.GetSize();
	CClientDC dc(this);
	dc.SetBkMode(TRANSPARENT);
	TEXTMETRIC textMetric;
	dc.GetTextMetrics(&amp;textMetric);
	int fontHeight=textMetric.tmHeight;
	int displayPos=10;
	for(int x=0;x&lt;count;++x)
	{
		dc.TextOut(10,displayPos,m_string[x]);
		displayPos+=fontHeight;
	}
	AfxMessageBox("Continue...");

	m_string.RemoveAt(2);
	count=m_string.GetSize();
	for(x=0;x&lt;count;++x)
	{
		dc.TextOut(10,displayPos,m_string[x]);
		displayPos+=fontHeight;
	}
	AfxMessageBox("A string has delete,continue...");
	m_string.RemoveAll();
	count=m_string.GetSize();
	if(count==0)
		AfxMessageBox("All elements are deleted.");
}
</PRE>代码简要说明： <PRE>m_string.SetAtGrow(2,szdog);
</PRE>　　SetAtGrow有两个参数，第一个参数决定数组元素的序号值，第二个参数是元素的值。该函数根据序号值设置相应数组元素的值，功能与SetAt相近，不同之处是使用该函数设置元素值时，如果序号值大于数组的上界，数组会自动增长。<BR>　　编译运行程序，细心的读者您可能会看到，第一行字符是“tiger”，第二行字符是“bear”，这是我们预料之中的，但第三行是空串，第四行是“dog”。空串是怎样造成的呢？细分析下面三行代码就可以知道： 
<PRE>m_string.SetAtGrow(0,sztiger);
m_string.SetAtGrow(2,szdog);
m_string.InsertAt(1,szbear);
</PRE>第一行设定元素0为“tiger”，这是没有疑义的。<BR>第二行设定元素2为“dog”，但是在设定元素2的同时自动将元素1填充为空串。<BR>第三行插入“bear”为元素1，同时原来的元素1和元素2后移为元素2和元素3。<BR><BR>怎么样，这回明白了吧。<PRE>m_string.InsertAt(1,szbear);
</PRE>　　InsertAt函数在指定序号处插入相应元素，该函数在执行过程中，插入点后面的元素会自动后移。 
            dc.TextOut(10,displayPos,m_string[x]); 
            其中，m_string[x]是数组类对操作符[]的重载，数组类CArray允许使用[]操作符，类似于C++的常规数组。m_string[x]也可以用m_string.GetAt(x)替代。 
<PRE>m_string.RemoveAt(2);
</PRE>RemoveAt只有一个参数，即元素序号值。该函数根据元素序号值删除相应元素值，后面的元素会自动前移。 <PRE>m_string.RemoveAll();
</PRE>RemoveAll删除所有元素值<BR><BR><B>演示使用CUIntArray类</B><BR><BR>　　打开主对话框资源IDD_ARRAY_DIALOG，添加一个按钮IDC_CUINTARRAY，标题为CUIntArray，双击该按钮，在OnCuintarray 
            ()函数中添加如下代码： <PRE>void CArrayDlg::OnCuintarray() 
{
	CUIntArray m_array;
	m_array.SetSize(5,5);
	m_array.SetAt(0,0);
	m_array.SetAt(1,1);
	m_array.SetAt(2,2);
	m_array.SetAt(3,3);
	m_array.SetAt(4,4);
	int count=m_array.GetSize();
	CClientDC dc(this);
	dc.SetBkMode(TRANSPARENT);
	TEXTMETRIC textMetric;
	dc.GetTextMetrics(&amp;textMetric);
	int fontHeight=textMetric.tmHeight;
	int displayPos=10;
	for(int x=0;x&lt;count;++x)
	{
		CString str;
		str.Format("%d",m_array.GetAt(x));
		dc.TextOut(10,displayPos,str);
		displayPos+=fontHeight;
	}
}
</PRE>这部分代码不作说明，请读者自行分析。<BR><BR>　　最后再说明一点：RemoveAt，InsertAt函数操作时会使得数组元素移位，运行时间大于SetAt，RemoveAll，Add函数。 
            <BR><BR>希望这篇文章能对您有所帮助。<BR>
            <P></P></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR>
<DIV align=center>
<SCRIPT type=text/javascript><!--
google_ad_client = "pub-4159669282587342";
google_alternate_color = "FFFFFF";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "text_image";
google_ad_channel ="";
google_color_border = "B4D0DC";
google_color_bg = "ECF8FF";
google_color_link = "0000CC";
google_color_url = "008000";
google_color_text = "6F6F6F";
//--></SCRIPT>

<SCRIPT src="MFC_CArray.files/show_ads.js" type=text/javascript>
</SCRIPT>
<BR><BR>
<TABLE class=small height=18 cellSpacing=0 cellPadding=0 width="98%" border=0>
  <TBODY>
  <TR vAlign=center>
    <TD width="47%" bgColor=#a0d39b><IMG height=10 
      src="MFC_CArray.files/toplogo.gif" width=10>最新评论 <A 
      href="http://www.vckbase.com/SYS/script/viewcomment.asp?gclsid=100&amp;itemid=1668" 
      target=_blank><SPAN class=small>[发表评论]</SPAN></A> <A 
      href="http://www.vckbase.com/support/contribute.html" target=_blank><SPAN 
      class=small>[文章投稿]</SPAN></A></TD>
    <TD align=right width="53%" bgColor=#a0d39b><IMG height=9 
      src="MFC_CArray.files/rec1.gif" width=9> <A 
      href="http://www.vckbase.com/SYS/script/viewcomment.asp?gclsid=100&amp;itemid=1668" 
      target=_blank><SPAN class=small>查看所有评论</SPAN></A> <IMG height=9 
      src="MFC_CArray.files/rec1.gif" width=9> <A 
      href="http://www.vckbase.com/SYS/script/writemail.asp?gclsid=100&amp;itemid=1668&amp;title=%ca%b9%d3%c3MFC%b5%c4%ca%fd%d7%e9%c0%e0" 
      target=_blank><SPAN class=small>推荐给好友</SPAN></A> <IMG height=9 
      src="MFC_CArray.files/rec1.gif" width=9> <A 
      href="javascript:window.print();"><SPAN 
  class=small>打印</SPAN></A></TD></TR></TBODY></TABLE>
<TABLE class=small cellSpacing=1 cellPadding=0 width="98%" bgColor=#ffffff 
border=0>
  <TBODY>
  <TR>
    <TD bgColor=#ffffff><BR><IMG height=11 src="MFC_CArray.files/doc2.gif" 
      width=11 align=absMiddle> 
      解答hubu_lin的问题：<BR>当有这行代码m_Array.SetSize(10,10);时，之后执行了三次m_Array.Add，所以元素个数为10+3=13.而且从第一个到第10个元素的x，y坐标均为0.当把代码m_Array.SetSize(10,10);注释之后，之后执行了三次m_Array.Add，元素个数为3.所以就出现两次划线不一样了 
      ( birdsinging 发表于 2008-1-25 10:27:00)<BR>&nbsp;<BR><IMG height=11 
      src="MFC_CArray.files/doc2.gif" width=11 align=absMiddle> 
      函数void&nbsp;CArrayDlg::OnArrayCstring()有误,其中的CArray&nbsp;m_string;应改为:<BR>CArray&nbsp;&lt;CString,CString&amp;&gt;&nbsp;m_string;<BR>不然程序运行有错! 
      ( 王浩儒 发表于 2006-11-6 23:29:00)<BR>&nbsp;<BR><IMG height=11 
      src="MFC_CArray.files/doc2.gif" width=11 align=absMiddle> 最好不要用这个冬冬。。 ( 
      jinhr9801 发表于 2006-9-15 21:30:00)<BR>&nbsp;<BR><IMG height=11 
      src="MFC_CArray.files/doc2.gif" width=11 align=absMiddle> 
      对于第一段代码，为什么所画折线段的起始点（不知道可不可能是终止点）总是（0，0）啊？我去掉m_Array.SetSize(10,10)；这行代码就可以了，高手们能不能给个解释啊，谢谢了。 
      ( hubu_lin 发表于 2006-8-31 15:01:00)<BR>&nbsp;<BR><IMG height=11 
      src="MFC_CArray.files/doc2.gif" width=11 align=absMiddle> 
      API拦截教程&nbsp;V1.0<BR>http://www.skycn.com/soft/27866.html ( marrco 发表于 
      2006-8-11 8:13:00)<BR>&nbsp;<BR><IMG height=11 
      src="MFC_CArray.files/doc2.gif" width=11 align=absMiddle> 谢谢! ( simon_2008 
      发表于 2006-7-21 13:17:00)<BR>&nbsp;<BR><IMG height=11 
      src="MFC_CArray.files/doc2.gif" width=11 align=absMiddle> 
      会不会出现内存泄露问题?<BR><BR>在知道用CObArray就容易内存泄露,因为清理内存时容易出错 ( alangsos 发表于 
      2006-7-16 
      14:43:00)<BR>&nbsp;<BR>.......................................................<BR><A 
      href="http://www.vckbase.com/SYS/script/viewcomment.asp?gclsid=100&amp;itemid=1668" 
      target=_blank><SPAN class=small>More...</SPAN></A> 
</TD></TR></TBODY></TABLE></DIV><BR>
<DIV align=right><BR><SPAN class=small>版权所有 &copy; 1999 - 2008 VC知识库&nbsp; 
<BR><BR></SPAN></DIV></BODY></HTML>
