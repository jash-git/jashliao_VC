<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 3.0">
<title>5.6 公用对话框</title>
</head>

<body link="#3973DE" alink="#3973DE">
<font SIZE="5"><b><div align="center"><center>

<table border="0" width="615" cellspacing="0" cellpadding="0">
  <tr>
    </b><td><div align="center"><center><table border="0" width="615" cellpadding="0" cellspacing="0" height="20">
      <tr>
        <td width="377" bgcolor="#15397D" height="20"></td>
        <td width="238" bgcolor="#000000" height="20"><p align="right"></font><span style="text-decoration: none"><a href="javascript:if(confirm('http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/index.htm  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/index.htm'" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/index.htm"><font color="#FFFFFF">电脑报Visual 
        C++网络教程</font></a></span></td>
      </tr>
    </table>
    </center></div><font FACE="Times New Roman" SIZE="3"><b><p ALIGN="CENTER"></b></font><font FACE="Times New Roman" size="4" color="#3973DE">5.6 </font><font size="4" color="#3973DE">公用对话框</font><font FACE="Times New Roman" size="4"></p>
    <p ALIGN="CENTER"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">在使用</font><font FACE="Times New Roman" SIZE="3">Windows</font><font SIZE="3">的过程中，用户经常会遇到一些常用的有特定用途的对话框。例如，当选择</font><font FACE="Times New Roman" SIZE="3">File-&gt;Open</font><font SIZE="3">，会弹出一个文件选择的对话框，用户可以在其中选择想要打开的文件。象文件选择这样的对话框，使用的非常普遍，因此</font><font FACE="Times New Roman" SIZE="3">Windows</font><font SIZE="3">系统本身提供了对该对话框的支持，用户不必自己设计文件选择对话框。与文件选择对话框类似的还有颜色选择、字体选择、打印和打印设置以及正文搜索和替换对话框。这五种对话框均由</font><font FACE="Times New Roman" SIZE="3">Windows</font><font SIZE="3">支持，被称为公用对话框。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">MFC</font><font SIZE="3">提供了一些公用对话框类，它们均是</font><font FACE="Times New Roman" SIZE="3">CDialog</font><font SIZE="3">类的派生类，封装了公用对话框的功能。表</font><font FACE="Times New Roman" SIZE="3">5.6</font><font SIZE="3">列出了</font><font FACE="Times New Roman" SIZE="3">MFC</font><font SIZE="3">的公用对话框类。</font><b><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="CENTER"></font><font SIZE="3">　</p>
    <p ALIGN="CENTER">表</font><font FACE="Times New Roman" SIZE="3">5.6 </font><font SIZE="3">公用对话框类</font></b></p>
    <table BORDER="1" CELLSPACING="1" CELLPADDING="1" WIDTH="579">
      <tr>
        <td WIDTH="50%"><font SIZE="3"><p ALIGN="JUSTIFY">通用对话框类</font></td>
        <td WIDTH="50%"><font SIZE="3"><p ALIGN="JUSTIFY">用途</font></td>
      </tr>
      <tr>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">CColorDialog</font></td>
        <td WIDTH="50%"><font SIZE="3"><p ALIGN="JUSTIFY">选择颜色</font></td>
      </tr>
      <tr>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">CFileDialog</font></td>
        <td WIDTH="50%"><font SIZE="3"><p ALIGN="JUSTIFY">选择文件名，用于打开和保存文件</font></td>
      </tr>
      <tr>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">CFindReplaceDialog</font></td>
        <td WIDTH="50%"><font SIZE="3"><p ALIGN="JUSTIFY">正文查找和替换</font></td>
      </tr>
      <tr>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">CFontDialog</font></td>
        <td WIDTH="50%"><font SIZE="3"><p ALIGN="JUSTIFY">选择字体</font></td>
      </tr>
      <tr>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">CPrintDialog</font></td>
        <td WIDTH="50%"><font SIZE="3"><p ALIGN="JUSTIFY">打印和打印设置</font></td>
      </tr>
    </table>
    <font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY"></font><font SIZE="3">通用对话框类使用方便，读者只需知道怎样创建对话框和访问对话框的数据，不必关心它们的内部细节。</font><font FACE="Times New Roman" SIZE="3"></p>
    <b><p ALIGN="JUSTIFY"></b></font><font color="#3973DE" FACE="Times New Roman" SIZE="3">5.6.1 
    CColorDialog</font><font SIZE="3" color="#3973DE">类</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CColorDialog</font><font SIZE="3">类用于实现</font><font FACE="Times New Roman" SIZE="3">Color</font><font SIZE="3">（颜色选择）公用对话框。</font><font FACE="Times New Roman" SIZE="3">Color</font><font SIZE="3">对话框如图</font><font FACE="Times New Roman" SIZE="3">5.12</font><font SIZE="3">所示，在</font><font FACE="Times New Roman" SIZE="3">Windows</font><font SIZE="3">的画板程序中，如果用户在颜色面板的某种颜色上双击鼠标，就会显示一个</font><font FACE="Times New Roman" SIZE="3">Color</font><font SIZE="3">对话框来让用户选择颜色。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><img src="T5_12.gif" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/vc++5.0/chap5/T5_12.gif" alt="T5_12.tif (167359 bytes)" WIDTH="491" HEIGHT="321"><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><font SIZE="3">图</font><font FACE="Times New Roman" SIZE="3">5.12 
    Color</font><font SIZE="3">对话框</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">Color</font><font SIZE="3">对话框的创建与一般的对话框没什么两样：首先是在堆栈上构建一个</font><font FACE="Times New Roman" SIZE="3">CColorDialog</font><font SIZE="3">对象，然后调用</font><font FACE="Times New Roman" SIZE="3">CColorDialog::DoModal( )</font><font SIZE="3">来启动对话框。</font><font FACE="Times New Roman" SIZE="3">CColorDialog</font><font SIZE="3">的构造函数为</p>
    <blockquote>
      <blockquote>
        <blockquote>
          </font><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">CColorDialog( COLORREF 
          clrInit = 0, DWORD dwFlags = 0, CWnd* pParentWnd = NULL );</p>
        </blockquote>
      </blockquote>
    </blockquote>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">参数</font><font FACE="Times New Roman" SIZE="3">clrInit</font><font SIZE="3">用来指定初始的颜色选择，</font><font FACE="Times New Roman" SIZE="3">dwFlags</font><font SIZE="3">用来设置对话框，</font><font FACE="Times New Roman" SIZE="3">pParentWnd</font><font SIZE="3">用于指定对话框的父窗口或拥有者窗口。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">根据</font><font FACE="Times New Roman" SIZE="3">DoModal</font><font SIZE="3">返回的是</font><font FACE="Times New Roman" SIZE="3">IDOK</font><font SIZE="3">还是</font><font FACE="Times New Roman" SIZE="3">IDCANCEL</font><font SIZE="3">可知道用户是否确认了对颜色的选择。</font><font FACE="Times New Roman" SIZE="3">DoModal</font><font SIZE="3">返回后，调用</font><font FACE="Times New Roman" SIZE="3">CColorDialog::GetColor()</font><font SIZE="3">可以返回一个</font><font FACE="Times New Roman" SIZE="3">COLORREF</font><font SIZE="3">类型的结果来指示在对话框中选择的颜色。</font><font FACE="Times New Roman" SIZE="3">COLORREF</font><font SIZE="3">是一个</font><font FACE="Times New Roman" SIZE="3">32</font><font SIZE="3">位的值，用来说明一个</font><font FACE="Times New Roman" SIZE="3">RGB</font><font SIZE="3">颜色。</font><font FACE="Times New Roman" SIZE="3">GetColor</font><font SIZE="3">返回的</font><font FACE="Times New Roman" SIZE="3">COLORREF</font><font SIZE="3">的格式是</font><font FACE="Times New Roman" SIZE="3">0x00bbggrr</font><font SIZE="3">，即低位三个字节分别包含了蓝、绿、红三种颜色的强度。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">读者将在后面的章节中看到颜色选择对话框的例子。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font></b><font color="#3973DE" FACE="Times New Roman" SIZE="3">5.6.2 
    CFileDialog</font><font SIZE="3" color="#3973DE">类</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CFileDialog</font><font SIZE="3">类用于实现文件选择对话框，以支持文件的打开和保存操作。用户要打开或保存文件，就会和文件选择对话框打交道，图</font><font FACE="Times New Roman" SIZE="3">5.13</font><font SIZE="3">显示了一个标准的用于打开文件的文件选择对话框。用</font><font FACE="Times New Roman" SIZE="3">MFC AppWizard</font><font SIZE="3">建立的应用程序中自动加入了文件选择对话框，在</font><font FACE="Times New Roman" SIZE="3">File</font><font SIZE="3">菜单选</font><font FACE="Times New Roman" SIZE="3">Open</font><font SIZE="3">或</font><font FACE="Times New Roman" SIZE="3">Save As</font><font SIZE="3">命令会启动它们。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><img src="T5_13.gif" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/vc++5.0/chap5/T5_13.gif" alt="T5_13.tif (115270 bytes)" WIDTH="425" HEIGHT="250"><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><font size="2">图<font FACE="Times New Roman">5.13 </font>文件选择对话框<font FACE="Times New Roman"></p>
    </font></font><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY"></font><font SIZE="3">文件选择对话框的创建过程与一般对话框的类似，首先是在堆栈上构建一个</font><font FACE="Times New Roman" SIZE="3">CFileDialog</font><font SIZE="3">对象，然后调用</font><font FACE="Times New Roman" SIZE="3">CFileDialog::DoModal( )</font><font SIZE="3">来启动对话框。文件对话框的构造函数为</p>
    <blockquote>
      <blockquote>
        <blockquote>
          <blockquote>
            </font><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">CFileDialog( BOOL 
            bOpenFileDialog, LPCTSTR lpszDefExt = NULL, LPCTSTR lpszFileName = NULL, DWORD dwFlags = 
            OFN_HIDEREADONLY | OFN_OVERWRITEPROMPT, LPCTSTR lpszFilter = NULL, CWnd* pParentWnd = NULL 
            );</p>
          </blockquote>
        </blockquote>
      </blockquote>
    </blockquote>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">如果参数</font><font FACE="Times New Roman" SIZE="3">bOpenFileDialog</font><font SIZE="3">的值为</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">，将创建</font><font FACE="Times New Roman" SIZE="3">Open</font><font SIZE="3">（打开文件）对话框，否则就创建</font><font FACE="Times New Roman" SIZE="3">Save As</font><font SIZE="3">（保存文件）对话框。参数</font><font FACE="Times New Roman" SIZE="3">lpszDefExt</font><font SIZE="3">用来指定缺省的文件扩展名。</font><font FACE="Times New Roman" SIZE="3">lpszFileName</font><font SIZE="3">用于规定初始文件名。</font><font FACE="Times New Roman" SIZE="3">dwFlags</font><font SIZE="3">用于设置对话框的一些属性。</font><font FACE="Times New Roman" SIZE="3">lpszFilter</font><font SIZE="3">指向一个过滤字符串，用户如果只想选择某种或某几种类型的文件，就需要指定过滤字符串。参数</font><font FACE="Times New Roman" SIZE="3">pParentWnd</font><font SIZE="3">是指向父窗口或拥有者窗口的指针。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">过滤字符串有特定的格式，它实际上是由多个子串组成，每个子串由两部分组成，第一部分是过滤器的字面说明，如“</font><font FACE="Times New Roman" SIZE="3">Text file (*.txt)</font><font SIZE="3">”，第二部分是用于过滤的匹配字符串，如“</font><font FACE="Times New Roman" SIZE="3">*.txt</font><font SIZE="3">”，子串的两部分用竖线字符“ 
    </font><font FACE="Times New Roman" SIZE="3">| </font><font SIZE="3">”分隔开。各子串之间也要用“ 
    </font><font FACE="Times New Roman" SIZE="3">| </font><font SIZE="3">”分隔，且整个串的最后两个字符必须是两个连续的竖线字符“ 
    </font><font FACE="Times New Roman" SIZE="3">|| </font><font SIZE="3">”。一个典型的过滤字符串如下面所示：</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">char szFilter[]=</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">“</font><font FACE="Times New Roman" SIZE="3">All 
    files (*.*)|*.*|Text files(*.txt)|*.txt|Word documents(*.doc)|*.doc||</font><font SIZE="3">”</font><font FACE="Times New Roman" SIZE="3">;</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">若</font><font FACE="Times New Roman" SIZE="3">CFileDialog::DoModal</font><font SIZE="3">返回的是</font><font FACE="Times New Roman" SIZE="3">IDOK</font><font SIZE="3">，那么可以用表</font><font FACE="Times New Roman" SIZE="3">5.7</font><font SIZE="3">列出的</font><font FACE="Times New Roman" SIZE="3">CFileDialog</font><font SIZE="3">类的成员函数来获取与所选文件有关的信息。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><b><font SIZE="3">　</p>
    <p ALIGN="CENTER">表</font><font FACE="Times New Roman" SIZE="3">5.7 CFileDialog</font><font SIZE="3">类辅助成员函数</font></b></p>
    <table BORDER="1" CELLSPACING="1" CELLPADDING="1" WIDTH="579">
      <tr>
        <td WIDTH="24%"><font SIZE="3"><b><p ALIGN="JUSTIFY">函数名</b></font></td>
        <td WIDTH="76%"><font SIZE="3"><b><p ALIGN="JUSTIFY">用途</b></font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetPathName</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">返回一个包含有全路径文件名的</font><font FACE="Times New Roman" SIZE="3">CString</font><font SIZE="3">对象。</font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetFileName</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">返回一个包含有文件名（不含路径）的</font><font FACE="Times New Roman" SIZE="3">CString</font><font SIZE="3">对象。</font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetFileExt</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">返回一个只含文件扩展名的</font><font FACE="Times New Roman" SIZE="3">CString</font><font SIZE="3">对象。</font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetFileTitle</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">返回一个只含文件名（不含扩展名）的</font><font FACE="Times New Roman" SIZE="3">CString</font><font SIZE="3">对象。</font></td>
      </tr>
    </table>
    <font FACE="Times New Roman" SIZE="3"><b><p ALIGN="JUSTIFY"></b></font><font color="#3973DE" FACE="Times New Roman" SIZE="3">5.6.3 CFindReplaceDialog</font><font SIZE="3" color="#3973DE">类</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CFindReplaceDialog</font><font SIZE="3">类用于实现</font><font FACE="Times New Roman" SIZE="3">Find</font><font SIZE="3">（搜索）和</font><font FACE="Times New Roman" SIZE="3">Replace</font><font SIZE="3">（替换）对话框，这两个对话框都是非模态对话框，用于在正文中搜索和替换指定的字符串。图</font><font FACE="Times New Roman" SIZE="3">5.14</font><font SIZE="3">显示了一个</font><font FACE="Times New Roman" SIZE="3">Find</font><font SIZE="3">对话框，图</font><font FACE="Times New Roman" SIZE="3">5.15</font><font SIZE="3">显示了一个</font><font FACE="Times New Roman" SIZE="3">Replace</font><font SIZE="3">对话框。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><img src="T5_14.gif" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/vc++5.0/chap5/T5_14.gif" alt="T5_14.tif (55570 bytes)" WIDTH="389" HEIGHT="126"><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><font SIZE="3">图</font><font FACE="Times New Roman" SIZE="3">5.14 
    Find</font><font SIZE="3">对话框</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><img src="T5_15.gif" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/vc++5.0/chap5/T5_15.gif" alt="T5_15.tif (69140 bytes)" WIDTH="365" HEIGHT="168"><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><font SIZE="3">图</font><font FACE="Times New Roman" SIZE="3">5.15 
    Replace</font><font SIZE="3">对话框</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">由于</font><font FACE="Times New Roman" SIZE="3">Find</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">Replace</font><font SIZE="3">对话框是非模式对话框，它们的创建方式与其它四类公用对话框不同。</font><font FACE="Times New Roman" SIZE="3">CFindReplaceDialog</font><font SIZE="3">对象是用</font><font FACE="Times New Roman" SIZE="3">new</font><font SIZE="3">操作符在堆中创建的，而不是象普通对话框那样以变量的形式创建。要启动</font><font FACE="Times New Roman" SIZE="3">Find/Replace</font><font SIZE="3">对话框，应该调用</font><font FACE="Times New Roman" SIZE="3">CFindReplaceDialog::Create</font><font SIZE="3">函数，而不是</font><font FACE="Times New Roman" SIZE="3">DoModal</font><font SIZE="3">。</font><font FACE="Times New Roman" SIZE="3">Create</font><font SIZE="3">函数的声明是</p>
    <blockquote>
      <blockquote>
        <blockquote>
          <blockquote>
            <blockquote>
              </font><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">BOOL Create( BOOL 
              bFindDialogOnly, LPCTSTR lpszFindWhat, LPCTSTR lpszReplaceWith = NULL, DWORD dwFlags = 
              FR_DOWN, CWnd* pParentWnd = NULL );</p>
            </blockquote>
          </blockquote>
        </blockquote>
      </blockquote>
    </blockquote>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">当参数</font><font FACE="Times New Roman" SIZE="3">bFindDialogOnly</font><font SIZE="3">的值为</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">时，创建的是</font><font FACE="Times New Roman" SIZE="3">Find</font><font SIZE="3">对话框，为</font><font FACE="Times New Roman" SIZE="3">FALSE</font><font SIZE="3">时创建的是</font><font FACE="Times New Roman" SIZE="3">Replace</font><font SIZE="3">对话框。参数</font><font FACE="Times New Roman" SIZE="3">lpszFindWhat</font><font SIZE="3">指定了要搜索的字符串，</font><font FACE="Times New Roman" SIZE="3">lpszReplaceWith</font><font SIZE="3">指定了用于替换的字符串。</font><font FACE="Times New Roman" SIZE="3">dwFlags</font><font SIZE="3">用来设置对话框，其缺省值是</font><font FACE="Times New Roman" SIZE="3">FR_DOWN</font><font SIZE="3">（向下搜索），该参数可以是几个</font><font FACE="Times New Roman" SIZE="3">FR_XXX</font><font SIZE="3">常量的组合，用户可以通过该参数来决定诸如是否要显示</font><font FACE="Times New Roman" SIZE="3">Match case</font><font SIZE="3">、</font><font FACE="Times New Roman" SIZE="3">Match Whole Word</font><font SIZE="3">检查框等设置。参数</font><font FACE="Times New Roman" SIZE="3">pParentWnd</font><font SIZE="3">指明了对话框的父窗口或拥有者窗口。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">Find/Replace</font><font SIZE="3">对话框与其它公用对话框的另一个不同之处在于它在工作过程中可以重复同一操作而对话框不被关闭，这就方便了频繁的搜索和替换。</font><font FACE="Times New Roman" SIZE="3">CFindReplaceDialog</font><font SIZE="3">类只提供了一个界面，它并不会自动实现搜索和替换功能。</font><font FACE="Times New Roman" SIZE="3">CFindReplaceDialog</font><font SIZE="3">使用了一种特殊的通知机制，当用户按下了操作的按钮后，它会向父窗口发送一个通知消息，父窗口应在该消息的消息处理函数中实现搜索和替换。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CFindReplaceDialog</font><font SIZE="3">类提供了一组成员函数用来获得与用户操作有关的信息，如表</font><font FACE="Times New Roman" SIZE="3">5.8</font><font SIZE="3">所示，这组函数一般应在通知消息处理函数中调用。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><b><font SIZE="3">　</p>
    <p ALIGN="CENTER">表</font><font FACE="Times New Roman" SIZE="3">5.8 CFindReplaceDialog</font><font SIZE="3">类的辅助成员函数</font></b></p>
    <table BORDER="1" CELLSPACING="1" CELLPADDING="1" WIDTH="579">
      <tr>
        <td WIDTH="25%"><font SIZE="3"><b><p ALIGN="JUSTIFY">函数名</b></font></td>
        <td WIDTH="75%"><font SIZE="3"><b><p ALIGN="JUSTIFY">用途</b></font></td>
      </tr>
      <tr>
        <td WIDTH="25%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">FindNext</font></td>
        <td WIDTH="75%"><font SIZE="3"><p ALIGN="JUSTIFY">如果用户点击了</font><font FACE="Times New Roman" SIZE="3">Findnext</font><font SIZE="3">按钮，该函数返回</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">。</font></td>
      </tr>
      <tr>
        <td WIDTH="25%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetNotifier</font></td>
        <td WIDTH="75%"><font SIZE="3"><p ALIGN="JUSTIFY">返回一个指向当前</font><font FACE="Times New Roman" SIZE="3">CFindReplaceDialog</font><font SIZE="3">对话框的指针。</font></td>
      </tr>
      <tr>
        <td WIDTH="25%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetFindString</font></td>
        <td WIDTH="75%"><font SIZE="3"><p ALIGN="JUSTIFY">返回一个包含要搜索字符串的</font><font FACE="Times New Roman" SIZE="3">CString</font><font SIZE="3">对象。</font></td>
      </tr>
      <tr>
        <td WIDTH="25%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetReplaceString</font></td>
        <td WIDTH="75%"><font SIZE="3"><p ALIGN="JUSTIFY">返回一个包含替换字符串的</font><font FACE="Times New Roman" SIZE="3">CString</font><font SIZE="3">对象。</font></td>
      </tr>
      <tr>
        <td WIDTH="25%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">IsTerminating</font></td>
        <td WIDTH="75%"><font SIZE="3"><p ALIGN="JUSTIFY">如果对话框终止了，则返回</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">。</font></td>
      </tr>
      <tr>
        <td WIDTH="25%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">MatchCase</font></td>
        <td WIDTH="75%"><font SIZE="3"><p ALIGN="JUSTIFY">如果选择了对话框中的</font><font FACE="Times New Roman" SIZE="3">Match case</font><font SIZE="3">检查框，则返回</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">。</font></td>
      </tr>
      <tr>
        <td WIDTH="25%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">MatchWholeWord</font></td>
        <td WIDTH="75%"><font SIZE="3"><p ALIGN="JUSTIFY">如果选择了对话框中的</font><font FACE="Times New Roman" SIZE="3">Match Whole Word</font><font SIZE="3">检查框，则返回</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">。</font></td>
      </tr>
      <tr>
        <td WIDTH="25%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">ReplaceAll</font></td>
        <td WIDTH="75%"><font SIZE="3"><p ALIGN="JUSTIFY">如果用户点击了</font><font FACE="Times New Roman" SIZE="3">Replace All</font><font SIZE="3">按钮，该函数返回</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">。</font></td>
      </tr>
      <tr>
        <td WIDTH="25%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">ReplaceCurrent</font></td>
        <td WIDTH="75%"><font SIZE="3"><p ALIGN="JUSTIFY">如果用户点击了</font><font FACE="Times New Roman" SIZE="3">Replace</font><font SIZE="3">按钮，该函数返回</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">。</font></td>
      </tr>
      <tr>
        <td WIDTH="25%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">SearchDown</font></td>
        <td WIDTH="75%"><font SIZE="3"><p ALIGN="JUSTIFY">返回</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">表明搜索方向向下，返回</font><font FACE="Times New Roman" SIZE="3">FALSE</font><font SIZE="3">则向上。</font></td>
      </tr>
    </table>
    <p><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CEditView</font><font SIZE="3">类自动实现了</font><font FACE="Times New Roman" SIZE="3">Find</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">Replace</font><font SIZE="3">对话框的功能，但</font><font FACE="Times New Roman" SIZE="3">MFC AppWizard</font><font SIZE="3">并未提供相应的菜单命令。读者可以在前面的</font><font FACE="Times New Roman" SIZE="3">Register</font><font SIZE="3">工程的</font><font FACE="Times New Roman" SIZE="3">Edit</font><font SIZE="3">菜单中加入</font><font FACE="Times New Roman" SIZE="3">&amp;Find...</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">&amp;Replace...</font><font SIZE="3">两项，并令其</font><font FACE="Times New Roman" SIZE="3">ID</font><font SIZE="3">分别为</font><font FACE="Times New Roman" SIZE="3">ID_EDIT_FIND</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">ID_EDIT_REPLACE</font><font SIZE="3">，则</font><font FACE="Times New Roman" SIZE="3">Find/Replace</font><font SIZE="3">对话框的功能就可以实现。</font><font FACE="Times New Roman" SIZE="3"></p>
    <b><p ALIGN="JUSTIFY"></b></font><font color="#3973DE" FACE="Times New Roman" SIZE="3">5.6.4 
    CFontDialog</font><font SIZE="3" color="#3973DE">类</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CFontDialog</font><font SIZE="3">类支持</font><font FACE="Times New Roman" SIZE="3">Font</font><font SIZE="3">（字体）对话框，用来让用户选择字体。图</font><font FACE="Times New Roman" SIZE="3">5.16</font><font SIZE="3">显示了一个</font><font FACE="Times New Roman" SIZE="3">Font</font><font SIZE="3">对话框。</font><font FACE="Times New Roman" SIZE="3">Font</font><font SIZE="3">对话框的创建过程与</font><font FACE="Times New Roman" SIZE="3">Color</font><font SIZE="3">对话框的类似，首先是在堆栈上构建一个</font><font FACE="Times New Roman" SIZE="3">CFontDialog</font><font SIZE="3">对象，然后调用</font><font FACE="Times New Roman" SIZE="3">CFontDialog::DoModal</font><font SIZE="3">来启动对话框。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><img src="T5_16.gif" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/vc++5.0/chap5/T5_16.gif" alt="T5_16.tif (144136 bytes)" WIDTH="411" HEIGHT="324"><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><font SIZE="3">图</font><font FACE="Times New Roman" SIZE="3">5.16 
    Font</font><font SIZE="3">对话框</font><font FACE="Times New Roman" SIZE="3"><b></p>
    <p ALIGN="JUSTIFY"></b></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CFontDialog</font><font SIZE="3">类的构造函数如下所示</p>
    <blockquote>
      <blockquote>
        <blockquote>
          <blockquote>
            </font><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">CFontDialog( LPLOGFONT 
            lplfInitial = NULL, DWORD dwFlags = CF_EFFECTS | CF_SCREENFONTS, CDC* pdcPrinter = NULL, 
            CWnd* pParentWnd = NULL );</p>
          </blockquote>
        </blockquote>
      </blockquote>
    </blockquote>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">参数</font><font FACE="Times New Roman" SIZE="3">lplfInitial</font><font SIZE="3">指向一个</font><font FACE="Times New Roman" SIZE="3">LOGFONG</font><font SIZE="3">结构，用来初始化对话框中的字体设置。</font><font FACE="Times New Roman" SIZE="3">dwFlags</font><font SIZE="3">用于设置对话框。</font><font FACE="Times New Roman" SIZE="3">pdcPrinter</font><font SIZE="3">指向一个代表打印机的</font><font FACE="Times New Roman" SIZE="3">CDC</font><font SIZE="3">对象，若设置该参数，则选择的字体就为打印机所用。</font><font FACE="Times New Roman" SIZE="3">pParentWnd</font><font SIZE="3">用于指定对话框的父窗口或拥有者窗口。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">若</font><font FACE="Times New Roman" SIZE="3">DoModal</font><font SIZE="3">返回</font><font FACE="Times New Roman" SIZE="3">IDOK</font><font SIZE="3">，那么可以调用</font><font FACE="Times New Roman" SIZE="3">CFontDialog</font><font SIZE="3">的成员函数来获得所选字体的信息，这些函数在表</font><font FACE="Times New Roman" SIZE="3">5.9</font><font SIZE="3">列出。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><b><font SIZE="3">　</p>
    <p ALIGN="CENTER">表</font><font FACE="Times New Roman" SIZE="3">5.9 CFontDialog</font><font SIZE="3">类的辅助成员函数</font></b></p>
    <table BORDER="1" CELLSPACING="1" CELLPADDING="1" WIDTH="579">
      <tr>
        <td WIDTH="20%"><font SIZE="3"><b><p ALIGN="JUSTIFY">函数名</b></font></td>
        <td WIDTH="80%"><font SIZE="3"><b><p ALIGN="JUSTIFY">用途</b></font></td>
      </tr>
      <tr>
        <td WIDTH="20%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetCurrentFont</font></td>
        <td WIDTH="80%"><font SIZE="3"><p ALIGN="JUSTIFY">用来获得所选字体的属性。该函数有一个参数，该参数是指向</font><font FACE="Times New Roman" SIZE="3">LOGFONT</font><font SIZE="3">结构的指针，函数将所选字体的各种属性写入这个</font><font FACE="Times New Roman" SIZE="3">LOGFONT</font><font SIZE="3">结构中。</font></td>
      </tr>
      <tr>
        <td WIDTH="20%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetFaceName</font></td>
        <td WIDTH="80%"><font SIZE="3"><p ALIGN="JUSTIFY">返回一个包含所选字体名字的</font><font FACE="Times New Roman" SIZE="3">CString</font><font SIZE="3">对象。</font></td>
      </tr>
      <tr>
        <td WIDTH="20%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetStyleName</font></td>
        <td WIDTH="80%"><font SIZE="3"><p ALIGN="JUSTIFY">返回一个包含所选字体风格名字的</font><font FACE="Times New Roman" SIZE="3">CString</font><font SIZE="3">对象。</font></td>
      </tr>
      <tr>
        <td WIDTH="20%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetSize</font></td>
        <td WIDTH="80%"><font SIZE="3"><p ALIGN="JUSTIFY">返回所选字体的尺寸（以</font><font FACE="Times New Roman" SIZE="3">10</font><font SIZE="3">个象素为单位）。</font></td>
      </tr>
      <tr>
        <td WIDTH="20%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetColor</font></td>
        <td WIDTH="80%"><font SIZE="3"><p ALIGN="JUSTIFY">返回一个含有所选字体的颜色的</font><font FACE="Times New Roman" SIZE="3">COLORREF</font><font SIZE="3">型值。</font></td>
      </tr>
      <tr>
        <td WIDTH="20%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetWeight</font></td>
        <td WIDTH="80%"><font SIZE="3"><p ALIGN="JUSTIFY">返回所选字体的权值。</font></td>
      </tr>
      <tr>
        <td WIDTH="20%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">IsStrikeOut</font></td>
        <td WIDTH="80%"><font SIZE="3"><p ALIGN="JUSTIFY">若用户选择了空心效果则返回</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">，否则返回</font><font FACE="Times New Roman" SIZE="3">FALSE</font><font SIZE="3">。</font></td>
      </tr>
      <tr>
        <td WIDTH="20%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">IsUnderline</font></td>
        <td WIDTH="80%"><font SIZE="3"><p ALIGN="JUSTIFY">若用户选择了下划线效果则返回</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">，否则返回</font><font FACE="Times New Roman" SIZE="3">FALSE</font><font SIZE="3">。</font></td>
      </tr>
      <tr>
        <td WIDTH="20%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">IsBold</font></td>
        <td WIDTH="80%"><font SIZE="3"><p ALIGN="JUSTIFY">若用户选择了黑体风格则返回</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">，否则返回</font><font FACE="Times New Roman" SIZE="3">FALSE</font><font SIZE="3">。</font></td>
      </tr>
      <tr>
        <td WIDTH="20%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">IsItalic</font></td>
        <td WIDTH="80%"><font SIZE="3"><p ALIGN="JUSTIFY">若用户选择了斜体风格则返回</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">，否则返回</font><font FACE="Times New Roman" SIZE="3">FALSE</font><font SIZE="3">。</font></td>
      </tr>
    </table>
    <p><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <b><p ALIGN="JUSTIFY"></b></font><font color="#3973DE" FACE="Times New Roman" SIZE="3">.6.5 
    CPrintDialog</font><font SIZE="3" color="#3973DE">类</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CPrintDialog</font><font SIZE="3">类支持</font><font FACE="Times New Roman" SIZE="3">Print</font><font SIZE="3">（打印）和</font><font FACE="Times New Roman" SIZE="3">Print Setup</font><font SIZE="3">（打印设置）对话框，通过这两个对话框用户可以进行与打印有关的操作。图</font><font FACE="Times New Roman" SIZE="3">5.17</font><font SIZE="3">显示了一个</font><font FACE="Times New Roman" SIZE="3">Print</font><font SIZE="3">对话框，图</font><font FACE="Times New Roman" SIZE="3">5.18</font><font SIZE="3">显示了一个</font><font FACE="Times New Roman" SIZE="3">Print Setup</font><font SIZE="3">对话框。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><img src="T5_17.gif" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/vc++5.0/chap5/T5_17.gif" alt="T5_17.tif (147955 bytes)" WIDTH="437" HEIGHT="315"><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><font SIZE="3">图</font><font FACE="Times New Roman" SIZE="3">5.17 
    Print</font><font SIZE="3">对话框</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><img src="T5_18.gif" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/vc++5.0/chap5/T5_18.gif" alt="T5_18.tif (136979 bytes)" WIDTH="437" HEIGHT="291"><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><font SIZE="3">图</font><font FACE="Times New Roman" SIZE="3">5.18 
    Print Setup</font><font SIZE="3">对话框</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">Print</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">Print Setup</font><font SIZE="3">对话框的创建过程与</font><font FACE="Times New Roman" SIZE="3">Color</font><font SIZE="3">对话框类似。该类的构造函数是</p>
    <blockquote>
      <blockquote>
        <blockquote>
          <blockquote>
            </font><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">CPrintDialog( BOOL 
            bPrintSetupOnly, DWORD dwFlags = PD_ALLPAGES | PD_USEDEVMODECOPIES | PD_NOPAGENUMS | 
            PD_HIDEPRINTTOFILE | PD_NOSELECTION, CWnd* pParentWnd = NULL );</p>
          </blockquote>
        </blockquote>
      </blockquote>
    </blockquote>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">参数</font><font FACE="Times New Roman" SIZE="3">bPrintSetupOnly</font><font SIZE="3">的值若为</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">，则创建的是</font><font FACE="Times New Roman" SIZE="3">Print</font><font SIZE="3">对话框，否则，创建的是</font><font FACE="Times New Roman" SIZE="3">Print Setup</font><font SIZE="3">对话框。</font><font FACE="Times New Roman" SIZE="3">dwFlags</font><font SIZE="3">用来设置对话框，缺省设置是打印出全部页，禁止</font><font FACE="Times New Roman" SIZE="3">From</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">To</font><font SIZE="3">编辑框（即不用确定要打印的页的范围），</font><font FACE="Times New Roman" SIZE="3">PD_USEDEVMODECOPIES</font><font SIZE="3">使对话框判断打印设备是否支持多份拷贝和校对打印</font><font FACE="Times New Roman" SIZE="3">(Collate)</font><font SIZE="3">，若不支持，就禁止相应的编辑控件和</font><font FACE="Times New Roman" SIZE="3">Collate</font><font SIZE="3">检查框。</font><font FACE="Times New Roman" SIZE="3">pParentWnd</font><font SIZE="3">用来指定对话框的父窗口或拥有者窗口。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">程序可以调用如表</font><font FACE="Times New Roman" SIZE="3">5.10</font><font SIZE="3">所示的</font><font FACE="Times New Roman" SIZE="3">CPrintDialog</font><font SIZE="3">的成员函数来获得打印参数。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><b><font SIZE="3">　</p>
    <p ALIGN="CENTER">表</font><font FACE="Times New Roman" SIZE="3">5.10 CPrintDialog</font><font SIZE="3">的辅助成员函数</font></b></p>
    <table BORDER="1" CELLSPACING="1" CELLPADDING="1" WIDTH="579">
      <tr>
        <td WIDTH="24%"><font SIZE="3"><b><p ALIGN="JUSTIFY">函数名</b></font></td>
        <td WIDTH="76%"><font SIZE="3"><b><p ALIGN="JUSTIFY">用途</b></font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetCopies</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">返回要求的拷贝数。</font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetDefaults</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">在不打开对话框的情况下返回缺省打印机的缺省设置，返回的设置放在</font><font FACE="Times New Roman" SIZE="3">m_pd</font><font SIZE="3">数据成员中。</font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetDeviceName</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">返回一个包含有打印机设备名的</font><font FACE="Times New Roman" SIZE="3">CString</font><font SIZE="3">对象。</font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetDevMode</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">返回一个指向</font><font FACE="Times New Roman" SIZE="3">DEVMODE</font><font SIZE="3">结构的指针，用来查询打印机的设备初始化信息和设备环境信息。</font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetDriverName</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">返回一个包含有打印机驱动程序名的</font><font FACE="Times New Roman" SIZE="3">CString</font><font SIZE="3">对象。</font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetFromPage</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">返回打印范围的起始页码。</font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetToPage</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">返回打印范围的结束页码。</font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetPortName</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">返回一个包含有打印机端口名的</font><font FACE="Times New Roman" SIZE="3">CString</font><font SIZE="3">对象。</font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">GetPrinterDC</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">返回所选打印设备的一个 </font><font FACE="Times New Roman" SIZE="3">HDC </font><font SIZE="3">句柄。</font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">PrintAll</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">若要打印文档的所有页则返回</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">。</font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">PrintCollate</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">若用户选择了</font><font FACE="Times New Roman" SIZE="3">Collate Copies</font><font SIZE="3">检查框（需要校对打印拷贝）则返回</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">。</font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">PrintRange</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">如果用户要打印文档的一部分页，则返回</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">。</font></td>
      </tr>
      <tr>
        <td WIDTH="24%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">PrintSelection</font></td>
        <td WIDTH="76%"><font SIZE="3"><p ALIGN="JUSTIFY">若用户想打印当前选择的部分文档，则返回</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">。</font></td>
      </tr>
    </table>
    <p><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">用缺省配置的</font><font FACE="Times New Roman" SIZE="3">MFC AppWizard</font><font SIZE="3">建立的程序支持</font><font FACE="Times New Roman" SIZE="3">Print</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">Print Setup</font><font SIZE="3">对话框，用户可以在</font><font FACE="Times New Roman" SIZE="3">File</font><font SIZE="3">菜单中启动它们。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">5.6.6 </font><font SIZE="3">公用对话框的使用实例</font></b><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">现在，让我们来测试一下公用对话框的使用。请读者用</font><font FACE="Times New Roman" SIZE="3">AppWizard</font><font SIZE="3">创建一个单文档的</font><font FACE="Times New Roman" SIZE="3">MFC</font><font SIZE="3">应用程序，名为</font><font FACE="Times New Roman" SIZE="3">CommonDlg</font><font SIZE="3">。注意别忘了在</font><font FACE="Times New Roman" SIZE="3">AppWizard</font><font SIZE="3">的第一步中选</font><font FACE="Times New Roman" SIZE="3">Single document</font><font SIZE="3">。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CommonDlg</font><font SIZE="3">程序要对所有的公用对话框进行了测试。为此，首先要提供用户命令接口。请读者在</font><font FACE="Times New Roman" SIZE="3">CommonDlg</font><font SIZE="3">的菜单资源中插入一个名为</font><font FACE="Times New Roman" SIZE="3">&amp;Common</font><font SIZE="3">的新菜单，这个菜单插在</font><font FACE="Times New Roman" SIZE="3">Help</font><font SIZE="3">菜单之前。然后，在</font><font FACE="Times New Roman" SIZE="3">Common</font><font SIZE="3">菜单中，请按表</font><font FACE="Times New Roman" SIZE="3">5.11</font><font SIZE="3">创建菜单项。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><b><font SIZE="3">　</p>
    <p ALIGN="CENTER">表</font><font FACE="Times New Roman" SIZE="3">5.11 Common</font><font SIZE="3">菜单的菜单项</font></b></p>
    <table BORDER="1" CELLSPACING="1" CELLPADDING="1" WIDTH="579">
      <tr>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><b><p ALIGN="JUSTIFY">Caption</b></font></td>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><b><p ALIGN="JUSTIFY">ID</b></font></td>
      </tr>
      <tr>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">&amp;Color...</font></td>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">ID_COMMON_COLOR</font></td>
      </tr>
      <tr>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">&amp;Open file...</font></td>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">ID_COMMON_OPENFILE</font></td>
      </tr>
      <tr>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">&amp;Save file...</font></td>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">ID_COMMON_SAVEFILE</font></td>
      </tr>
      <tr>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">&amp;Font...</font></td>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">ID_COMMON_FONT</font></td>
      </tr>
      <tr>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">&amp;Print...</font></td>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">ID_COMMON_PRINT</font></td>
      </tr>
      <tr>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">P&amp;rint 
        setup...</font></td>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">ID_COMMON_PRINTSETUP</font></td>
      </tr>
      <tr>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">F&amp;ind...</font></td>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">ID_COMMON_FIND</font></td>
      </tr>
      <tr>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">&amp;Replace...</font></td>
        <td WIDTH="50%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">ID_COMMON_REPLACE</font></td>
      </tr>
    </table>
    <p><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">接下来的工作是编写测试程序的源代码。首先，利用</font><font FACE="Times New Roman" SIZE="3">ClassWizard</font><font SIZE="3">为表</font><font FACE="Times New Roman" SIZE="3">5.11</font><font SIZE="3">的菜单项创建消息处理函数，注意这些处理函数都是</font><font FACE="Times New Roman" SIZE="3">CCommonDlgView</font><font SIZE="3">的成员。接着，请按清单</font><font FACE="Times New Roman" SIZE="3">5.10</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">5.11</font><font SIZE="3">修改程序。限于篇幅，这里仅列出与测试相关的部分源代码。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><b><font SIZE="3">　</p>
    <p ALIGN="JUSTIFY">清单</font><font FACE="Times New Roman" SIZE="3">5.10 </font><font SIZE="3">头文件</font><font FACE="Times New Roman" SIZE="3">CommonDlgView.h</b></p>
    <p ALIGN="JUSTIFY">class CCommonDlgView : public CView</p>
    <p ALIGN="JUSTIFY">{</p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">. . . . . .</b></p>
    <p ALIGN="JUSTIFY">#ifdef _DEBUG</p>
    <p ALIGN="JUSTIFY">virtual void AssertValid() const;</p>
    <p ALIGN="JUSTIFY">virtual void Dump(CDumpContext&amp; dc) const;</p>
    <p ALIGN="JUSTIFY">#endif</p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">protected:</p>
    <p ALIGN="JUSTIFY">void DispPrintInfo(CPrintDialog&amp; dlg);</p>
    <p ALIGN="JUSTIFY">protected:</p>
    <p ALIGN="JUSTIFY">CFont m_Font; //</font><font SIZE="3">正文的字体</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">COLORREF m_ForeColor; //</font><font SIZE="3">正文的前景色</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">COLORREF m_BackColor; //</font><font SIZE="3">正文的背景色</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CFindReplaceDialog *m_pFindReplaceDlg;</p>
    <p ALIGN="JUSTIFY">BOOL m_bFindOnly;</b></p>
    <p ALIGN="JUSTIFY">// Generated message map functions</p>
    <p ALIGN="JUSTIFY">protected:</p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">//Find</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">Replace</font><font SIZE="3">对话框通知消息处理函数</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">afx_msg LRESULT OnFindReplaceCmd(WPARAM, LPARAM lParam);</b></p>
    <p ALIGN="JUSTIFY">//{{AFX_MSG(CCommonDlgView)</p>
    <p ALIGN="JUSTIFY">afx_msg void OnCommonColor();</p>
    <p ALIGN="JUSTIFY">afx_msg void OnCommonFont();</p>
    <p ALIGN="JUSTIFY">afx_msg void OnCommonOpenfile();</p>
    <p ALIGN="JUSTIFY">afx_msg void OnCommonSavefile();</p>
    <p ALIGN="JUSTIFY">afx_msg void OnCommonPrint();</p>
    <p ALIGN="JUSTIFY">afx_msg void OnCommonPrintsetup();</p>
    <p ALIGN="JUSTIFY">afx_msg void OnCommonFind();</p>
    <p ALIGN="JUSTIFY">afx_msg void OnCommonReplace();</p>
    <p ALIGN="JUSTIFY">//}}AFX_MSG</p>
    <p ALIGN="JUSTIFY">DECLARE_MESSAGE_MAP()</p>
    <p ALIGN="JUSTIFY">};</p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">. . . . . .</b></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><b><font SIZE="3">　</p>
    <p ALIGN="JUSTIFY">清单</font><font FACE="Times New Roman" SIZE="3">5.11 </font><font SIZE="3">文件</font><font FACE="Times New Roman" SIZE="3">CCommonDlgView.cpp</b></p>
    <p ALIGN="JUSTIFY">#include &quot;stdafx.h&quot;</p>
    <p ALIGN="JUSTIFY">#include &quot;CommonDlg.h&quot;</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">#include &quot;CommonDlgDoc.h&quot;</p>
    <p ALIGN="JUSTIFY">#include &quot;CommonDlgView.h&quot;</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">#ifdef _DEBUG</p>
    <p ALIGN="JUSTIFY">#define new DEBUG_NEW</p>
    <p ALIGN="JUSTIFY">#undef THIS_FILE</p>
    <p ALIGN="JUSTIFY">static char THIS_FILE[] = __FILE__;</p>
    <p ALIGN="JUSTIFY">#endif</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">IMPLEMENT_DYNCREATE(CCommonDlgView, CView)</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">获取对本进程唯一的消息编号</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">static const UINT nMsgFindReplace = 
    ::RegisterWindowMessage(FINDMSGSTRING);</b></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">BEGIN_MESSAGE_MAP(CCommonDlgView, CView)</p>
    <p ALIGN="JUSTIFY">//{{AFX_MSG_MAP(CCommonDlgView)</p>
    <p ALIGN="JUSTIFY">ON_COMMAND(ID_COMMON_COLOR, OnCommonColor)</p>
    <p ALIGN="JUSTIFY">ON_COMMAND(ID_COMMON_FONT, OnCommonFont)</p>
    <p ALIGN="JUSTIFY">ON_COMMAND(ID_COMMON_OPENFILE, OnCommonOpenfile)</p>
    <p ALIGN="JUSTIFY">ON_COMMAND(ID_COMMON_SAVEFILE, OnCommonSavefile)</p>
    <p ALIGN="JUSTIFY">ON_COMMAND(ID_COMMON_PRINT, OnCommonPrint)</p>
    <p ALIGN="JUSTIFY">ON_COMMAND(ID_COMMON_PRINTSETUP, OnCommonPrintsetup)</p>
    <p ALIGN="JUSTIFY">ON_COMMAND(ID_COMMON_FIND, OnCommonFind)</p>
    <p ALIGN="JUSTIFY">ON_COMMAND(ID_COMMON_REPLACE, OnCommonReplace)</p>
    <p ALIGN="JUSTIFY">//}}AFX_MSG_MAP</p>
    <p ALIGN="JUSTIFY">// Standard printing commands</p>
    <p ALIGN="JUSTIFY">ON_COMMAND(ID_FILE_PRINT, CView::OnFilePrint)</p>
    <p ALIGN="JUSTIFY">ON_COMMAND(ID_FILE_PRINT_DIRECT, CView::OnFilePrint)</p>
    <p ALIGN="JUSTIFY">ON_COMMAND(ID_FILE_PRINT_PREVIEW, CView::OnFilePrintPreview)</p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">ON_REGISTERED_MESSAGE(nMsgFindReplace, OnFindReplaceCmd)</b></p>
    <p ALIGN="JUSTIFY">END_MESSAGE_MAP()</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CCommonDlgView::CCommonDlgView()</p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">// TODO: add construction code here</p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">缺省前景色为黑色，背景色为白色，字体为系统字体</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">m_ForeColor=0;</p>
    <p ALIGN="JUSTIFY">m_BackColor=0xFFFFFF;</p>
    <p ALIGN="JUSTIFY">m_Font.CreateStockObject(SYSTEM_FONT);</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">m_pFindReplaceDlg=NULL; </b></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">void CCommonDlgView::OnDraw(CDC* pDC)</p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">CCommonDlgDoc* pDoc = GetDocument();</p>
    <p ALIGN="JUSTIFY">ASSERT_VALID(pDoc);</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">// TODO: add draw code for native data here</p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">int x,y;</p>
    <p ALIGN="JUSTIFY">CFont *pOldFont;</p>
    <p ALIGN="JUSTIFY">TEXTMETRIC TM;</p>
    <p ALIGN="JUSTIFY">int textHeight;</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">设置正文的字体</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">pOldFont=pDC-&gt;SelectObject(&amp;m_Font);</p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">设置正文的前景色和背景色</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">pDC-&gt;SetTextColor(m_ForeColor);</p>
    <p ALIGN="JUSTIFY">pDC-&gt;SetBkColor(m_BackColor);</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">计算每行正文的高度</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">pDC-&gt;GetTextMetrics(&amp;TM);</p>
    <p ALIGN="JUSTIFY">textHeight=TM.tmHeight+TM.tmExternalLeading;</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">输出正文</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">x=5;y=5;</p>
    <p ALIGN="JUSTIFY">pDC-&gt;TextOut(x,y,&quot;ABCDEFG&quot;);</p>
    <p ALIGN="JUSTIFY">y+=textHeight;</p>
    <p ALIGN="JUSTIFY">pDC-&gt;TextOut(x,y,&quot;abcdefg&quot;);</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">恢复原来的字体</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">pDC-&gt;SelectObject(pOldFont);</b></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">void CCommonDlgView::OnCommonColor() </p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">// TODO: Add your command handler code here</p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CColorDialog dlg;</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">if(dlg.DoModal()==IDOK)</p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">m_BackColor=dlg.GetColor();</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">重绘视图</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">Invalidate();</p>
    <p ALIGN="JUSTIFY">UpdateWindow();</p>
    <p ALIGN="JUSTIFY">}</b></p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">void CCommonDlgView::OnCommonFont() </p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">// TODO: Add your command handler code here</p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CFontDialog dlg;</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">if(dlg.DoModal()==IDOK)</p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">LOGFONT LF;</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">获取所选字体的信息</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">dlg.GetCurrentFont(&amp;LF);</p>
    <p ALIGN="JUSTIFY">m_ForeColor=dlg.GetColor();</p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">建立新的字体</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">m_Font.DeleteObject();</p>
    <p ALIGN="JUSTIFY">m_Font.CreateFontIndirect(&amp;LF);</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">Invalidate();</p>
    <p ALIGN="JUSTIFY">UpdateWindow();</p>
    <p ALIGN="JUSTIFY">}</b></p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">void CCommonDlgView::OnCommonOpenfile() </p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">// TODO: Add your command handler code here</p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">过滤字符串</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">char szFileFilter[]=</p>
    <p ALIGN="JUSTIFY">&quot;Cpp files(*.cpp)|*.cpp|&quot;</p>
    <p ALIGN="JUSTIFY">&quot;Header files(*.h)|*.h|&quot;</p>
    <p ALIGN="JUSTIFY">&quot;All files(*.*)|*.*||&quot;;</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CFileDialog dlg(TRUE, //Open</font><font SIZE="3">对话框</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">&quot;cpp&quot;, //</font><font SIZE="3">缺省扩展名</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">&quot;*.cpp&quot;,</p>
    <p ALIGN="JUSTIFY">OFN_HIDEREADONLY|OFN_FILEMUSTEXIST, //</font><font SIZE="3">文件必须存在</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">szFileFilter,</p>
    <p ALIGN="JUSTIFY">this);</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">if(dlg.DoModal()==IDOK)</p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">CString str=&quot;The full path name is:&quot;;</p>
    <p ALIGN="JUSTIFY">str+=dlg.GetPathName();</p>
    <p ALIGN="JUSTIFY">AfxMessageBox(str);</p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY"></font></b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">void CCommonDlgView::OnCommonSavefile() </p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">// TODO: Add your command handler code here</p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">char szFileFilter[]=</p>
    <p ALIGN="JUSTIFY">&quot;Cpp files(*.cpp)|*.cpp|&quot;</p>
    <p ALIGN="JUSTIFY">&quot;Header files(*.h)|*.h|&quot;</p>
    <p ALIGN="JUSTIFY">&quot;All files(*.*)|*.*||&quot;;</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CFileDialog dlg(FALSE, //Save</font><font SIZE="3">对话框</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">&quot;cpp&quot;,</p>
    <p ALIGN="JUSTIFY">&quot;*.cpp&quot;,</p>
    <p ALIGN="JUSTIFY">OFN_HIDEREADONLY|OFN_OVERWRITEPROMPT,</p>
    <p ALIGN="JUSTIFY">szFileFilter,</p>
    <p ALIGN="JUSTIFY">this);</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">if(dlg.DoModal()==IDOK)</p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">CString str=&quot;The file name is:&quot;;</p>
    <p ALIGN="JUSTIFY">str+=dlg.GetFileName();</p>
    <p ALIGN="JUSTIFY">AfxMessageBox(str);</p>
    <p ALIGN="JUSTIFY">}</b></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">void CCommonDlgView::OnCommonPrint() </p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">// TODO: Add your command handler code here</p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CPrintDialog dlg(FALSE, PD_ALLPAGES); //Print</font><font SIZE="3">对话框</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">设置</font><font FACE="Times New Roman" SIZE="3">Print</font><font SIZE="3">对话框的属性</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">dlg.m_pd.nCopies=2;</p>
    <p ALIGN="JUSTIFY">dlg.m_pd.nMinPage=1;</p>
    <p ALIGN="JUSTIFY">dlg.m_pd.nMaxPage=50;</p>
    <p ALIGN="JUSTIFY">dlg.m_pd.nFromPage=1;</p>
    <p ALIGN="JUSTIFY">dlg.m_pd.nToPage=50;</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">if(dlg.DoModal()==IDOK)</p>
    <p ALIGN="JUSTIFY">DispPrintInfo(dlg);</b></p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">void CCommonDlgView::OnCommonPrintsetup() </p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">// TODO: Add your command handler code here</p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CPrintDialog dlg(TRUE) //Print Setup</font><font SIZE="3">对话框</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">if(dlg.DoModal()==IDOK)</p>
    <p ALIGN="JUSTIFY">DispPrintInfo(dlg);</b></p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">void CCommonDlgView::DispPrintInfo(CPrintDialog&amp; dlg)</p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">CString str;</p>
    <p ALIGN="JUSTIFY">CString temp;</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">str+=&quot;Driver name:&quot;;</p>
    <p ALIGN="JUSTIFY">str+=dlg.GetDriverName();</p>
    <p ALIGN="JUSTIFY">str+=&quot;\nDevice name:&quot;;</p>
    <p ALIGN="JUSTIFY">str+=dlg.GetDeviceName();</p>
    <p ALIGN="JUSTIFY">str+=&quot;\nPort name:&quot;;</p>
    <p ALIGN="JUSTIFY">str+=dlg.GetPortName();</p>
    <p ALIGN="JUSTIFY">str+=&quot;\nNumber of copies:&quot;;</p>
    <p ALIGN="JUSTIFY">temp.Format(&quot;%d&quot;,dlg.GetCopies());</p>
    <p ALIGN="JUSTIFY">str+=temp;</p>
    <p ALIGN="JUSTIFY">str+=&quot;\nCollate:&quot;;</p>
    <p ALIGN="JUSTIFY">str+=dlg.PrintCollate()?&quot;Yes&quot;:&quot;No&quot;;</p>
    <p ALIGN="JUSTIFY">str+=&quot;\nPrint all:&quot;;</p>
    <p ALIGN="JUSTIFY">str+=dlg.PrintAll()?&quot;Yes&quot;:&quot;No&quot;;</p>
    <p ALIGN="JUSTIFY">str+=&quot;\nPrint range:&quot;;</p>
    <p ALIGN="JUSTIFY">str+=dlg.PrintRange()?&quot;Yes&quot;:&quot;No&quot;;</p>
    <p ALIGN="JUSTIFY">str+=&quot;\nSelection:&quot;;</p>
    <p ALIGN="JUSTIFY">str+=dlg.PrintSelection()?&quot;Yes&quot;:&quot;No&quot;;</p>
    <p ALIGN="JUSTIFY">str+=&quot;\nFrom page:&quot;;</p>
    <p ALIGN="JUSTIFY">temp.Format(&quot;%d&quot;,dlg.GetFromPage());</p>
    <p ALIGN="JUSTIFY">str+=temp;</p>
    <p ALIGN="JUSTIFY">str+=&quot;\nTo page:&quot;;</p>
    <p ALIGN="JUSTIFY">temp.Format(&quot;%d&quot;,dlg.GetToPage());</p>
    <p ALIGN="JUSTIFY">str+=temp;</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">AfxMessageBox(str);</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">}</b></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">void CCommonDlgView::OnCommonFind() </p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">// TODO: Add your command handler code here</p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">判断是否已存在一个对话框</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">if(m_pFindReplaceDlg)</p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">if(m_bFindOnly)</p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">若</font><font FACE="Times New Roman" SIZE="3">Find</font><font SIZE="3">对话框已打开，则使之成为活动窗口</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">m_pFindReplaceDlg-&gt;SetActiveWindow();</p>
    <p ALIGN="JUSTIFY">return;</p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY">else</p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">关闭</font><font FACE="Times New Roman" SIZE="3">Replace</font><font SIZE="3">对话框</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">m_pFindReplaceDlg-&gt;SendMessage(WM_CLOSE);</p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY">m_bFindOnly=TRUE;</p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">创建</font><font FACE="Times New Roman" SIZE="3">Find</font><font SIZE="3">对话框</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">m_pFindReplaceDlg=new CFindReplaceDialog;</p>
    <p ALIGN="JUSTIFY">m_pFindReplaceDlg-&gt;Create(TRUE,NULL,NULL,FR_DOWN,this);</b></p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">void CCommonDlgView::OnCommonReplace() </p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">// TODO: Add your command handler code here</p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">判断是否已存在一个对话框</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">if(m_pFindReplaceDlg)</p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">if(!m_bFindOnly)</p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">若</font><font FACE="Times New Roman" SIZE="3">Replace</font><font SIZE="3">对话框已打开，则使之成为活动窗口</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">m_pFindReplaceDlg-&gt;SetActiveWindow();</p>
    <p ALIGN="JUSTIFY">return;</p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY">else</p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">关闭</font><font FACE="Times New Roman" SIZE="3">Find</font><font SIZE="3">对话框</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">m_pFindReplaceDlg-&gt;SendMessage(WM_CLOSE);</p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY">m_bFindOnly=FALSE;</p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">创建</font><font FACE="Times New Roman" SIZE="3">Replace</font><font SIZE="3">对话框</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">m_pFindReplaceDlg=new CFindReplaceDialog;</p>
    <p ALIGN="JUSTIFY">m_pFindReplaceDlg-&gt;Create(FALSE,NULL,NULL,FR_DOWN,this);</b></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">//Find</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">Replace</font><font SIZE="3">对话框通知消息处理函数</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">LRESULT CCommonDlgView::OnFindReplaceCmd(WPARAM, LPARAM lParam)</p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">//</font><font SIZE="3">判断对话框是否被关闭</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">if(m_pFindReplaceDlg-&gt;IsTerminating())</p>
    <p ALIGN="JUSTIFY">m_pFindReplaceDlg=NULL;</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">return 0;</p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font></b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">让我们先来看看对</font><font FACE="Times New Roman" SIZE="3">Color</font><font SIZE="3">对话框的测试。在</font><font FACE="Times New Roman" SIZE="3">CCommonDlgView::OnCommonColor</font><font SIZE="3">中创建了一个</font><font FACE="Times New Roman" SIZE="3">Color</font><font SIZE="3">对话框，在此处该对话框的用途是为视图中显示的正文指定背景色。在</font><font FACE="Times New Roman" SIZE="3">CCommonDlgView</font><font SIZE="3">的构造函数中将背景色</font><font FACE="Times New Roman" SIZE="3">m_BackColor</font><font SIZE="3">的初值设置为白色</font><font FACE="Times New Roman" SIZE="3">(0x00000000)</font><font SIZE="3">。若</font><font FACE="Times New Roman" SIZE="3">DoModal</font><font SIZE="3">返回</font><font FACE="Times New Roman" SIZE="3">IDOK</font><font SIZE="3">，则调用</font><font FACE="Times New Roman" SIZE="3">CColorDialog::GetColor</font><font SIZE="3">获取用户选择的颜色并将之保存在</font><font FACE="Times New Roman" SIZE="3">m_BackColor</font><font SIZE="3">成员中。然后，调用</font><font FACE="Times New Roman" SIZE="3">Invalidate</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">UpdateWindow</font><font SIZE="3">函数以重绘视图。这两个函数的说明如下：</p>
    <blockquote>
      <blockquote>
        </font><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">void Invalidate( BOOL 
        bErase = TRUE );<br>
        </font><font SIZE="3">该函数的作用是使整个窗口客户区无效。窗口的客户区无效意味着需要重绘，例如，如果一个被其它窗口遮住的窗口变成了前台窗口，那么原来被遮住的部分就是无效的，需要重绘。这时</font><font FACE="Times New Roman" SIZE="3">Windows</font><font SIZE="3">会在应用程序的消息队列中放置</font><font FACE="Times New Roman" SIZE="3">WM_PAINT</font><font SIZE="3">消息。</font><font FACE="Times New Roman" SIZE="3">MFC</font><font SIZE="3">为窗口类提供了</font><font FACE="Times New Roman" SIZE="3">WM_PAINT</font><font SIZE="3">的消息处理函数</font><font FACE="Times New Roman" SIZE="3">OnPaint</font><font SIZE="3">，</font><font FACE="Times New Roman" SIZE="3">OnPaint</font><font SIZE="3">负责重绘窗口。视图类有一些例外，在视图类的</font><font FACE="Times New Roman" SIZE="3">OnPaint</font><font SIZE="3">函数中调用了</font><font FACE="Times New Roman" SIZE="3">OnDraw</font><font SIZE="3">函数，实际的重绘工作由</font><font FACE="Times New Roman" SIZE="3">OnDraw</font><font SIZE="3">来完成。参数</font><font FACE="Times New Roman" SIZE="3">bErase</font><font SIZE="3">为</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">时，重绘区域内的背景将被擦除，否则，背景将保持不变。</p>
        </font><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">void UpdateWindow( );<br>
        </font><font SIZE="3">该函数的作用是使窗口立即重绘。调用</font><font FACE="Times New Roman" SIZE="3">Invalidate</font><font SIZE="3">等函数后窗口不会立即重绘，这是由于</font><font FACE="Times New Roman" SIZE="3">WM_PAINT</font><font SIZE="3">消息的优先级很低，它需要等消息队列中的其它消息发送完后才能被处理。调用</font><font FACE="Times New Roman" SIZE="3">UpdateWindow</font><font SIZE="3">函数可使</font><font FACE="Times New Roman" SIZE="3">WM_PAINT</font><font SIZE="3">被直接发送到目标窗口，从而导致窗口立即重绘。</font></p>
      </blockquote>
    </blockquote>
    <p><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">在</font><font FACE="Times New Roman" SIZE="3">CCommonView::OnDraw</font><font SIZE="3">函数中调用了</font><font FACE="Times New Roman" SIZE="3">CDC::SetBkColor</font><font SIZE="3">来设置背景色。</font><font FACE="Times New Roman" SIZE="3">CDC</font><font SIZE="3">类用于绘图，在后面的几章里将会对其作详细介绍。</font><font FACE="Times New Roman" SIZE="3">CDC::TextOut</font><font SIZE="3">函数用于输出正文。两个函数的说明如下：</p>
    <blockquote>
      <blockquote>
        </font><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">virtual COLORREF 
        SetBkColor( COLORREF crColor );<br>
        </font><font SIZE="3">用于设置背景色。参数</font><font FACE="Times New Roman" SIZE="3">crColor</font><font SIZE="3">指定了背景色的</font><font FACE="Times New Roman" SIZE="3">RGB</font><font SIZE="3">值。返回的是原来的背景色。</p>
        </font><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY">BOOL TextOut( int x, int 
        y, const CString&amp; str );<br>
        </font><font SIZE="3">在指定的位置输出正文。参数</font><font FACE="Times New Roman" SIZE="3">x</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">y</font><font SIZE="3">指定了输出起点的横向和纵向坐标。</font><font FACE="Times New Roman" SIZE="3">str</font><font SIZE="3">参数是输出的字符串。若该函数调用成功则返回</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">。</p>
        </font><font FACE="Times New Roman" SIZE="3">
      </blockquote>
    </blockquote>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">对文件选择对话框的测试比较简单。在</font><font FACE="Times New Roman" SIZE="3">CCommonDlgView::OnCommonOpenfile</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">CCommonDlgView:OnCommonSavefile</font><font SIZE="3">函数中，分别创建了一个</font><font FACE="Times New Roman" SIZE="3">Open</font><font SIZE="3">对话框和一个</font><font FACE="Times New Roman" SIZE="3">Save</font><font SIZE="3">对话框。在创建</font><font FACE="Times New Roman" SIZE="3">Open</font><font SIZE="3">对话框时，在</font><font FACE="Times New Roman" SIZE="3">CFileDialog</font><font SIZE="3">的构造函数中规定了</font><font FACE="Times New Roman" SIZE="3">OFN_FILEMUSTEXIST</font><font SIZE="3">属性，这样当用户试图打开一个不存在的文件时，对话框会发出错误信息并让用户从新选择文件。在创建</font><font FACE="Times New Roman" SIZE="3">Save</font><font SIZE="3">对话框时，在</font><font FACE="Times New Roman" SIZE="3">CFileDialog</font><font SIZE="3">的构造函数中规定了</font><font FACE="Times New Roman" SIZE="3">OFN_OVERWRITEPROMPT</font><font SIZE="3">属性，这样，当用户试图覆盖一个已存在的文件时，对话框会询问用户是否真的要覆盖该文件。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">若用户确认了对文件的选择，那么在文件选择对话框关闭后，程序会将所选文件的文件名或全路径文件名输出到屏幕上。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">Find</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">Replace</font><font SIZE="3">对话框的创建工作分别由</font><font FACE="Times New Roman" SIZE="3">CCommonDlgView::OnCommonFind</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">CCommonDlgView::OnCommonReplace</font><font SIZE="3">完成。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">在</font><font FACE="Times New Roman" SIZE="3">OnCommonFind</font><font SIZE="3">函数中，首先判断是否已经打开了一个</font><font FACE="Times New Roman" SIZE="3">Find/Replace</font><font SIZE="3">对话框。这个判断是完全必要的，因为</font><font FACE="Times New Roman" SIZE="3">Find/Replace</font><font SIZE="3">对话框是非模态对话框，打开一个对话框后，用户有可能通过菜单再次执行</font><font FACE="Times New Roman" SIZE="3">Find</font><font SIZE="3">或</font><font FACE="Times New Roman" SIZE="3">Replace</font><font SIZE="3">命令。成员</font><font FACE="Times New Roman" SIZE="3">m_pFindReplaceDlg</font><font SIZE="3">是指向</font><font FACE="Times New Roman" SIZE="3">CFindReplaceDialog</font><font SIZE="3">对象的指针，若该指针不为空，则说明对话框已打开。接着，根据成员</font><font FACE="Times New Roman" SIZE="3">m_bFindOnly</font><font SIZE="3">来判断原先打开的是否是</font><font FACE="Times New Roman" SIZE="3">Find</font><font SIZE="3">对话框，如果原先打开的是一个</font><font FACE="Times New Roman" SIZE="3">Find</font><font SIZE="3">对话框，则此时不必创建新的对话框，只需激活已打开的</font><font FACE="Times New Roman" SIZE="3">Find</font><font SIZE="3">对话框就行了；如果原先打开的是一个</font><font FACE="Times New Roman" SIZE="3">Replace</font><font SIZE="3">对话框，则应该先关闭该对话框，然后再创建</font><font FACE="Times New Roman" SIZE="3">Find</font><font SIZE="3">对话框。然后，给</font><font FACE="Times New Roman" SIZE="3">m_bFindOnly</font><font SIZE="3">赋</font><font FACE="Times New Roman" SIZE="3">TRUE</font><font SIZE="3">值，以表明现在打开的是一个</font><font FACE="Times New Roman" SIZE="3">Find</font><font SIZE="3">对话框。最后，创建一个非模态的</font><font FACE="Times New Roman" SIZE="3">Find</font><font SIZE="3">对话框，请注意其过程与创建模态对话框的不同之处：</p>
    <blockquote>
      <blockquote>
        <p ALIGN="JUSTIFY">对话框对象是用</font><font FACE="Times New Roman" SIZE="3">new</font><font SIZE="3">操作符在堆上创建的，而不是以变量的形式创建。</p>
        <p ALIGN="JUSTIFY">对话框的启动是靠调用</font><font FACE="Times New Roman" SIZE="3">Create</font><font SIZE="3">函数实现的，而不是</font><font FACE="Times New Roman" SIZE="3">DoModal</font><font SIZE="3">函数。</font></p>
      </blockquote>
    </blockquote>
    <p><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">调用</font><font FACE="Times New Roman" SIZE="3">CWnd::SetActiveWindow</font><font SIZE="3">以激活窗口。调用</font><font FACE="Times New Roman" SIZE="3">CWnd::SendMessage(WM_CLOSE)</font><font SIZE="3">来关闭窗口，这是因为</font><font FACE="Times New Roman" SIZE="3">WM_CLOSE</font><font SIZE="3">消息会导致</font><font FACE="Times New Roman" SIZE="3">CWnd::DestroyWindow</font><font SIZE="3">函数的调用。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">OnCommonReplace</font><font SIZE="3">函数的过程与</font><font FACE="Times New Roman" SIZE="3">OnCommonFind</font><font SIZE="3">函数类似。在该函数中，对</font><font FACE="Times New Roman" SIZE="3">m_bFindOnly</font><font SIZE="3">赋值</font><font FACE="Times New Roman" SIZE="3">FALSE</font><font SIZE="3">以表明打开的是</font><font FACE="Times New Roman" SIZE="3">Replace</font><font SIZE="3">对话框。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">Find/Replace</font><font SIZE="3">对话框通知消息的处理函数是</font><font FACE="Times New Roman" SIZE="3">CCommonDlgView::OnFindReplaceCmd</font><font SIZE="3">，这个消息处理函数及消息映射均是手工加入的。请注意在</font><font FACE="Times New Roman" SIZE="3">CommonDlgView.cpp</font><font SIZE="3">文件的开头部分定义了一个静态全局变量</font><font FACE="Times New Roman" SIZE="3">nMsgFindReplace</p>
    <p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">static const UINT nMsgFindReplace = :: RegisterWindowMessage( 
    FINDMSGSTRING );</b></p>
    <p ALIGN="JUSTIFY">nMsgFindReplace</font><font SIZE="3">变量用于存放消息码，这个消息是由函数</font><font FACE="Times New Roman" SIZE="3">RegisterWindowMessage</font><font SIZE="3">提供的，该函数的声明为</font><font FACE="Times New Roman" SIZE="3"><b></p>
    <p ALIGN="JUSTIFY">UINT RegisterWindowMessage(LPCTSTR lpString);</b></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">参数</font><font FACE="Times New Roman" SIZE="3">lpString</font><font SIZE="3">是一个消息字符串。调用</font><font FACE="Times New Roman" SIZE="3">RegisterWindowMessage</font><font SIZE="3">函数会返回一个</font><font FACE="Times New Roman" SIZE="3">Windows</font><font SIZE="3">注册消息，注册消息的编码在系统中是唯一的。当有多个应用程序需要处理同一个消息时，应调用该函数注册消息。如果消息是本应用程序专有的，则不必注册。如果两个应用程序使用相同的字符串注册消息，则会返回相同的消息，这样，通过该消息，两个应用程序可以进行通信。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">注册消息的消息映射宏是</font><font FACE="Times New Roman" SIZE="3">ON_REGISTERED_MESSAGE</font><font SIZE="3">，在</font><font FACE="Times New Roman" SIZE="3">CommonDlgView</font><font SIZE="3">的消息映射中可以找到它。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">在函数</font><font FACE="Times New Roman" SIZE="3">OnFindReplaceCmd</font><font SIZE="3">中应该进行实际的搜索和替换工作，但在本例中该函数什么工作也不作。该函数只是判断一下对话框是否被关闭，若是，则给</font><font FACE="Times New Roman" SIZE="3">m_pFindReplaceDlg</font><font SIZE="3">赋</font><font FACE="Times New Roman" SIZE="3">NULL</font><font SIZE="3">值，以表明对话框已不存在了。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">Font</font><font SIZE="3">对话框的创建由函数</font><font FACE="Times New Roman" SIZE="3">CCommonView:: OnCommonFont</font><font SIZE="3">完成。该函数收集了用户选择的字体的信息，并利用这些信息创建新的字体。成员</font><font FACE="Times New Roman" SIZE="3">m_ForeColor</font><font SIZE="3">用来保存所选字体的颜色，成员</font><font FACE="Times New Roman" SIZE="3">m_Font</font><font SIZE="3">是一个</font><font FACE="Times New Roman" SIZE="3">CFont</font><font SIZE="3">对象，用来保存用户选择的字体。在</font><font FACE="Times New Roman" SIZE="3">CCommonView</font><font SIZE="3">的构造函数中，</font><font FACE="Times New Roman" SIZE="3">m_ForeColor</font><font SIZE="3">被初始化成黑色</font><font FACE="Times New Roman" SIZE="3">(0xFFFFFF)</font><font SIZE="3">，</font><font FACE="Times New Roman" SIZE="3">m_Font</font><font SIZE="3">被初始化为系统字体。系统字体的获得是通过调用</font><font FACE="Times New Roman" SIZE="3">CGdiObject::CreateStockObject(SYSTEM_FONT)</font><font SIZE="3">实现的，该函数用于获得系统库存的绘图对象，包括字体、画笔、刷子、调色板等。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">在</font><font FACE="Times New Roman" SIZE="3">OnCommonFont</font><font SIZE="3">函数中，主要调用了下列函数：</p>
    <blockquote>
      <blockquote>
        <p ALIGN="JUSTIFY">调用</font><font FACE="Times New Roman" SIZE="3">CFontDialog:: 
        GetCurrentFont</font><font SIZE="3">以获得用户选择字体的信息，该函数的声明为<br>
        </font><font FACE="Times New Roman" SIZE="3">void GetCurrentFont( LPLOGFONT lplf );<br>
        </font><font SIZE="3">参数</font><font FACE="Times New Roman" SIZE="3">lplf</font><font SIZE="3">是一个指向</font><font FACE="Times New Roman" SIZE="3">LOGFONT</font><font SIZE="3">结构的指针，</font><font FACE="Times New Roman" SIZE="3">LOGFONT</font><font SIZE="3">结构用来存放与字体有关的信息。</p>
        <p ALIGN="JUSTIFY">调用</font><font FACE="Times New Roman" SIZE="3">CFontDialog::GetColor</font><font SIZE="3">来获得所选字体的颜色（前景色）。</p>
        <p ALIGN="JUSTIFY">调用</font><font FACE="Times New Roman" SIZE="3">CGdiObject:: 
        DeleteObject()</font><font SIZE="3">来删除存放在</font><font FACE="Times New Roman" SIZE="3">CFont</font><font SIZE="3">对象</font><font FACE="Times New Roman" SIZE="3">m_Font</font><font SIZE="3">中的老字体。</p>
        <p ALIGN="JUSTIFY">调用</font><font FACE="Times New Roman" SIZE="3">CFont::CreateFontIndirect</font><font SIZE="3">以创建一种字体，该函数的声明是<br>
        </font><font FACE="Times New Roman" SIZE="3">BOOL CreateFontIndirect(const LOGFONT* 
        lpLogFont );<br>
        </font><font SIZE="3">参数</font><font FACE="Times New Roman" SIZE="3">lpLogFont</font><font SIZE="3">是一个指向</font><font FACE="Times New Roman" SIZE="3">LOGFONT</font><font SIZE="3">结构的指针，函数根据该结构提供的信息来初始化</font><font FACE="Times New Roman" SIZE="3">Cfont</font><font SIZE="3">对象。</p>
        <p ALIGN="JUSTIFY">调用</font><font FACE="Times New Roman" SIZE="3">CWnd::Invalidate</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">CWnd::UpdateWindow</font><font SIZE="3">重绘视图。</font></p>
      </blockquote>
    </blockquote>
    <p><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">在</font><font FACE="Times New Roman" SIZE="3">CCommonView::OnDraw</font><font SIZE="3">函数中，利用选择的字体和颜色输出两行正文。当视图需要重绘时，</font><font FACE="Times New Roman" SIZE="3">OnDraw</font><font SIZE="3">就会被调用。在</font><font FACE="Times New Roman" SIZE="3">OnDraw</font><font SIZE="3">函数中主要调用了下列函数：</p>
    <blockquote>
      <blockquote>
        <p ALIGN="JUSTIFY">在输出正文前，调用</font><font FACE="Times New Roman" SIZE="3">CDC::SelectObject</font><font SIZE="3">指定输出正文的字体，输出完成后，调用</font><font FACE="Times New Roman" SIZE="3">CDC::SelectObject</font><font SIZE="3">恢复被替换的字体。</font><font FACE="Times New Roman" SIZE="3">SelectObject</font><font SIZE="3">有五个版本，用于为绘图指定画笔、刷子、字体、位图等绘图对象。在用该函数指定绘图对象时，应该把被替换的对象保存起来，在绘图完成后，需要再次调用该函数恢复被替换的绘图对象。如果不进行恢复，则可能会使设备对象</font><font FACE="Times New Roman" SIZE="3">CDC</font><font SIZE="3">中含有非法的句柄。指定字体的</font><font FACE="Times New Roman" SIZE="3">SelectObject</font><font SIZE="3">函数的声明是<br>
        </font><font FACE="Times New Roman" SIZE="3">virtual CFont* SelectObject( CFont* pFont );<br>
        </font><font SIZE="3">参数</font><font FACE="Times New Roman" SIZE="3">pFont</font><font SIZE="3">是指向</font><font FACE="Times New Roman" SIZE="3">CFont</font><font SIZE="3">对象的指针。函数返回一个</font><font FACE="Times New Roman" SIZE="3">CFont</font><font SIZE="3">对象的指针，指向被替代的字体。</p>
        <p ALIGN="JUSTIFY">调用</font><font FACE="Times New Roman" SIZE="3">CDC::SetTextColor</font><font SIZE="3">来指定正文显示的前景色，该函数的声明为<br>
        </font><font FACE="Times New Roman" SIZE="3">virtual COLORREF SetTextColor( COLORREF 
        crColor );<br>
        </font><font SIZE="3">参数</font><font FACE="Times New Roman" SIZE="3">crColor</font><font SIZE="3">指定了</font><font FACE="Times New Roman" SIZE="3">RGB</font><font SIZE="3">颜色。函数返回的是原来的正文颜色。</p>
        <p ALIGN="JUSTIFY">调用</font><font FACE="Times New Roman" SIZE="3">CDC:: GetTextMetrics</font><font SIZE="3">函数获得与绘图字体有关的各种信息，该函数的声明为<br>
        </font><font FACE="Times New Roman" SIZE="3">BOOL GetTextMetrics( LPTEXTMETRIC lpMetrics ) 
        const;<br>
        </font><font SIZE="3">参数</font><font FACE="Times New Roman" SIZE="3">lpMetrics</font><font SIZE="3">是一个指向</font><font FACE="Times New Roman" SIZE="3">TEXTMETRIC</font><font SIZE="3">结构的指针，该结构包含有字体的信息，其中</font><font FACE="Times New Roman" SIZE="3">tmHeight</font><font SIZE="3">成员说明了字体的高度，</font><font FACE="Times New Roman" SIZE="3">tmExternalLeading</font><font SIZE="3">成员说明了行与行之间的空白应该是多少。把这两个值相加就得到了每行正文的高度。</p>
        <p ALIGN="JUSTIFY">调用</font><font FACE="Times New Roman" SIZE="3">CDC::TextOut</font><font SIZE="3">在指定位置输出正文。</p>
        </font><font FACE="Times New Roman" SIZE="3">
      </blockquote>
    </blockquote>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">在</font><font FACE="Times New Roman" SIZE="3">CCommonDlgView::OnCommonPrint</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">CCommonDlgView::OnCommonPrintsetup()</font><font SIZE="3">函数中，分别创建了一个</font><font FACE="Times New Roman" SIZE="3">Print</font><font SIZE="3">对话框和</font><font FACE="Times New Roman" SIZE="3">Print Setup</font><font SIZE="3">对话框。在创建</font><font FACE="Times New Roman" SIZE="3">Print</font><font SIZE="3">对话框时，通过</font><font FACE="Times New Roman" SIZE="3">CPrintDialog</font><font SIZE="3">对象的</font><font FACE="Times New Roman" SIZE="3">m_pd</font><font SIZE="3">成员，对对话框进行了一些初始化，这包括对拷贝份数、打印范围等的设置。在两个对话框</font><font FACE="Times New Roman" SIZE="3">DoModal</font><font SIZE="3">返回</font><font FACE="Times New Roman" SIZE="3">IDOK</font><font SIZE="3">后，均调用</font><font FACE="Times New Roman" SIZE="3">CCommonDlgView::DispPrintInfo</font><font SIZE="3">报告打印信息。</font><font FACE="Times New Roman" SIZE="3">DispPrintInfo</font><font SIZE="3">函数的代码较简单，这里就不作解释了。</font><font FACE="Times New Roman" SIZE="3"></p>
    </font><div align="center"><center><table border="0" cellpadding="0" cellspacing="0" width="615">
      <tr>
        <td><a href="chap5_5.htm" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/vc++5.0/chap5/chap5_5.htm">上一页</a></td>
        <td><p align="right"><a href="chap5_7.htm" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/vc++5.0/chap5/chap5_7.htm">下一页</a></td>
      </tr>
    </table>
    </center></div><font SIZE="5"><hr noshade color="#3973DE" size="1">
    <p align="center"></font><font size="2" color="#000000">本教程由<a href="javascript:if(confirm('http://vcdynasty.yeah.net/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://vcdynasty.yeah.net/'" tppabs="http://vcdynasty.yeah.net/">Visual C++王朝（Where programmers come together）</a>协助制作<br>
    未经许可，请勿以任何形式复制</font></td>
    <b>
  </tr>
</table>
</center></div>

<p ALIGN="CENTER"></b><font SIZE="5">　</font><font FACE="Times New Roman" SIZE="5"></p>
</font><font FACE="Times New Roman" SIZE="3">

<p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
</font></b>

<p><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>

<p></font>　</p>
</body>
</html>
