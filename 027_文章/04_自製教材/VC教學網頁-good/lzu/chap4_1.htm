<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 3.0">
<title>4.1 工具条的可视化设计</title>
</head>

<body link="#3973DE" alink="#3973DE">
<font SIZE="5"><b><div align="center"><center>

<table border="0" width="615" cellspacing="0" cellpadding="0">
  <tr>
    </b><td><div align="center"><center><table border="0" width="615" cellpadding="0" cellspacing="0" height="20">
      <tr>
        <td width="377" bgcolor="#15397D" height="20"></td>
        <td width="238" bgcolor="#000000" height="20"><p align="right"></font><span style="text-decoration: none"><a href="javascript:if(confirm('http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/index.htm  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/index.htm'" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/index.htm"><font color="#FFFFFF">电脑报Visual 
        C++网络教程</font></a></span></td>
      </tr>
    </table>
    </center></div><font FACE="Times New Roman" SIZE="3"><b><p ALIGN="CENTER"></b></font><font color="#3973DE" FACE="Times New Roman" SIZE="3">4.1</font><font SIZE="3" color="#3973DE"> 
    工具条的可视化设计</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">从</font><font FACE="Times New Roman" SIZE="3">4.0</font><font SIZE="3">版开始，</font><font FACE="Times New Roman" SIZE="3">Visual C++</font><font SIZE="3">支持一种新型的工具条资源，这使得工具条的创建比以往更加方便灵活了。在</font><font FACE="Times New Roman" SIZE="3">MFC</font><font SIZE="3">中，工具条的功能由类</font><font FACE="Times New Roman" SIZE="3">CToolBar</font><font SIZE="3">实现。工具条资源和工具条类</font><font FACE="Times New Roman" SIZE="3">CToolBar</font><font SIZE="3">是工具条的两个要素。创建工具条的基本步骤是：</font><font FACE="Times New Roman" SIZE="3"></p>
    <blockquote>
      <p ALIGN="JUSTIFY">1.</font><font SIZE="3"><font SIZE="3">创建工具条资源。</font></font><font FACE="Times New Roman" SIZE="3"></p>
      <p ALIGN="JUSTIFY">2.</font><font SIZE="3"><font SIZE="3">构建一个</font></font><font FACE="Times New Roman" SIZE="3">CToolBar</font><font SIZE="3"><font SIZE="3">对象。</font></font><font FACE="Times New Roman" SIZE="3"></p>
      <p ALIGN="JUSTIFY">3.</font><font SIZE="3"><font SIZE="3">调用</font></font><font FACE="Times New Roman" SIZE="3">CToolBar::Create</font><font SIZE="3"><font SIZE="3">函数创建工具条窗口。</font></font><font FACE="Times New Roman" SIZE="3"></p>
      <p ALIGN="JUSTIFY">4.</font><font SIZE="3"><font SIZE="3">调用</font></font><font FACE="Times New Roman" SIZE="3">CToolBar::LoadToolBar</font><font SIZE="3"><font SIZE="3">载入工具条资源。</font><font FACE="Times New Roman" SIZE="3"></p>
      </font>
    </blockquote>
    </font><font SIZE="3"><p ALIGN="JUSTIFY">使用缺省配置时，</font><font FACE="Times New Roman" SIZE="3">AppWizard</font><font SIZE="3">会自动创建一个工具条。如图</font><font FACE="Times New Roman" SIZE="3">4.1</font><font SIZE="3">所示，这个工具条包含一些常用按钮，如打开文件、存盘、打印等等。用户可以修改这个工具条，去掉无用的按钮，加入自己需要的按钮。如果用户需要创建两个以上的工具条，则不能完全依赖</font><font FACE="Times New Roman" SIZE="3">AppWizard</font><font SIZE="3">，需要自己手工创建之。本节将分别讨论这两种方法。</font><font FACE="Times New Roman" SIZE="3"><b></p>
    <p ALIGN="JUSTIFY"></b></font><font color="#3973DE" FACE="Times New Roman" SIZE="3">4.1.1</font><font color="#3973DE"><font SIZE="3">利用</font><font FACE="Times New Roman" SIZE="3">AppWizard</font><font SIZE="3">自动创建</font></font><font FACE="Times New Roman" SIZE="3"></p>
    </font><font SIZE="3"><p ALIGN="JUSTIFY">自动创建工具条很简单，请读者按以下步骤操作：</p>
    <ol>
      <li><p ALIGN="JUSTIFY">选择 <font FACE="Times New Roman" SIZE="3">File-&gt;New</font>命令。</p>
      </li>
      <li><p ALIGN="JUSTIFY">在弹出的标签式对话框中选<font FACE="Times New Roman" SIZE="3">Projects</font>页，然后在该页中选中<font FACE="Times New Roman" SIZE="3">MFC AppWizard (exe)</font>项，并在<font FACE="Times New Roman" SIZE="3">Project 
        name</font>一栏中输入<font FACE="Times New Roman" SIZE="3">Record</font>以创建一个名为<font FACE="Times New Roman" SIZE="3">Record</font>的工程。按回车或用鼠标点击<font FACE="Times New Roman" SIZE="3">Create</font>按钮后就进入了<font FACE="Times New Roman" SIZE="3">MFC AppWizard</font>对话框。</p>
      </li>
      <li><p ALIGN="JUSTIFY">在<font FACE="Times New Roman" SIZE="3">MFC AppWizard</font>对话框的第一步中选中<font FACE="Times New Roman" SIZE="3">Single document</font>。这样就会创建一个单文档应用程序，若选择<font FACE="Times New Roman" SIZE="3">Multiple documents</font>项，则将创建一个多文档应用程序。单文档程序一次只能打开一个窗口，显示一个文档的内容，而多文档程序一次可以打开多个窗口，显示多个文档的内容。</p>
      </li>
      <li><p ALIGN="JUSTIFY">用鼠标点击<font FACE="Times New Roman" SIZE="3">Finish</font>按钮，并在接着的对话框中按<font FACE="Times New Roman" SIZE="3">OK</font>按钮。</p>
      </li>
    </ol>
    </font><p>　<font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">完成以上操作后，工程</font><font FACE="Times New Roman" SIZE="3">Record</font><font SIZE="3">被创建并被自动载入</font><font FACE="Times New Roman" SIZE="3">Developer Studio</font><font SIZE="3">中。将项目工作区切换到资源视图，并展开资源，就会发现其中有一个名为</font><font FACE="Times New Roman" SIZE="3">IDR_MAINFRAME</font><font SIZE="3">的</font><font FACE="Times New Roman" SIZE="3">Toolbar</font><font SIZE="3">（工具条）资源。用鼠标双击“</font><font FACE="Times New Roman" SIZE="3">IDR_MAINFRAME</font><font SIZE="3">”，</font><font FACE="Times New Roman" SIZE="3">Developer Studio</font><font SIZE="3">会打开一个功能强大的工具条资源编辑窗口，如图</font><font FACE="Times New Roman" SIZE="3">4.2</font><font SIZE="3">所示。该窗口的上部显示出了工具条上的按钮，当用户用鼠标选择某一按钮时，在窗口的下部会显示该按钮的位图。在窗口旁边有一个绘图工具面板和一个颜色面板，供用户编辑按钮位图时使用。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><img src="T4_2.gif" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/vc++5.0/chap4/T4_2.gif" alt="T4_2.tif (116672 bytes)" WIDTH="459" HEIGHT="236"><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><font SIZE="3">图</font><font FACE="Times New Roman" SIZE="3">4.2 
    </font><font SIZE="3">工具条资源编辑窗口</font><font FACE="Times New Roman" SIZE="3"></p>
    <div align="center"><center><table border="2" cellpadding="2" cellspacing="0" width="90%" bgcolor="#B4B4B4">
      <tr>
        <td width="100%"></font><b><font SIZE="3"><font SIZE="3">提示：如果读者看不到这两个面板，请在</font></font><font FACE="Times New Roman" SIZE="3">Developer Studio</font><font SIZE="3"><font SIZE="3">的工具条的空白处单击鼠标右键，并在随之弹出的菜单中选中</font></font><font FACE="Times New Roman" SIZE="3">Graphics</font><font SIZE="3"><font SIZE="3">和</font></font><font FACE="Times New Roman" SIZE="3">Colors</font><font SIZE="3"><font SIZE="3">两项。</font></font></b><font FACE="Times New Roman" SIZE="3"></td>
      </tr>
    </table>
    </center></div><p ALIGN="JUSTIFY"></font><font SIZE="3">在修改工具条以前，首先要修改菜单资源。请按以下几步修改菜单资源</font><font FACE="Times New Roman" SIZE="3">:</p>
    <ol>
      <li><font SIZE="3"><p ALIGN="JUSTIFY"></font><font SIZE="3">将项目工作区切换至资源视图，选择并打开</font></font><font FACE="Times New Roman" SIZE="3">menu</font><font SIZE="3"><font SIZE="3">（菜单）资源类型，双击名为</font></font><font FACE="Times New Roman" SIZE="3">IDR_MAINFRAME</font><font SIZE="3"><font SIZE="3">的菜单资源。</font><font FACE="Times New Roman" SIZE="3"></p>
        </font></li>
      <li><font SIZE="3"><p ALIGN="JUSTIFY"></font><font SIZE="3">删除</font></font><font FACE="Times New Roman" SIZE="3">Edit</font><font SIZE="3"><font SIZE="3">菜单。</font><font FACE="Times New Roman" SIZE="3"></p>
        </font></li>
      <li><font SIZE="3"><p ALIGN="JUSTIFY"></font><font SIZE="3">删除</font></font><font FACE="Times New Roman" SIZE="3">File</font><font SIZE="3"><font SIZE="3">菜单中除</font></font><font FACE="Times New Roman" SIZE="3">Exit</font><font SIZE="3"><font SIZE="3">以外的所有菜单项。</font><font FACE="Times New Roman" SIZE="3"></p>
        </font></li>
      <li><font SIZE="3"><p ALIGN="JUSTIFY"></font><font SIZE="3">在</font></font><font FACE="Times New Roman" SIZE="3">File</font><font SIZE="3"><font SIZE="3">菜单后插入一个名为</font></font><font FACE="Times New Roman" SIZE="3">&amp;Record</font><font SIZE="3"><font SIZE="3">的新菜单，并在该菜单中插入</font></font><font FACE="Times New Roman" SIZE="3">&amp;Start</font><font SIZE="3"><font SIZE="3">和</font></font><font FACE="Times New Roman" SIZE="3">St&amp;op</font><font SIZE="3"><font SIZE="3">两个菜单项，它们的命令</font></font><font FACE="Times New Roman" SIZE="3">ID</font><font SIZE="3"><font SIZE="3">（标识符）分别为</font></font><font FACE="Times New Roman" SIZE="3">ID_RECORD_START</font><font SIZE="3"><font SIZE="3">和</font></font><font FACE="Times New Roman" SIZE="3">ID_RECORD_STOP</font><font SIZE="3"><font SIZE="3">。</font></font><font FACE="Times New Roman" SIZE="3">Start</font><font SIZE="3"><font SIZE="3">表示开始录音，而</font></font><font FACE="Times New Roman" SIZE="3">Stop</font><font SIZE="3"><font SIZE="3">表示停止录音。</font></font><font FACE="Times New Roman" SIZE="3"></p>
      </li>
    </ol>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">修改后的菜单如图</font><font FACE="Times New Roman" SIZE="3">4.3</font><font SIZE="3">所示。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><img src="T4_3.gif" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/vc++5.0/chap4/T4_3.gif" alt="T4_3.tif (27461 bytes)" WIDTH="251" HEIGHT="83"><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="center"></font><font SIZE="3">图</font><font FACE="Times New Roman" SIZE="3">4.3 
    </font><font SIZE="3">修改后的菜单</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">接下来的任务是修改工具条资源，具体步骤是：</p>
    <blockquote>
      <p ALIGN="JUSTIFY">选择并打开<font FACE="Times New Roman" SIZE="3">Toolbar</font>（工具条）资源类型，双击名为<font FACE="Times New Roman" SIZE="3">IDR_MAINFRAME</font>的工具条资源以打开相应的资源编辑窗口。</p>
      <p ALIGN="JUSTIFY">删除“？”按钮前面的所有按钮，删除的方法是用鼠标将要删除的按钮拖出工具条即可。</p>
      <p ALIGN="JUSTIFY">先选中“？”按钮后面的空白按钮，然后在该按钮的放大位图上用红色画一个实心圆圈，以表示开始录音功能。再选中空白按钮，并用黑色在放大位图上画一个实心矩形，以表示停止功能。</p>
      <p ALIGN="JUSTIFY">通过用鼠标拖动按钮调整按钮的位置，调整后的位置如图<font FACE="Times New Roman" SIZE="3">4.4</font>所示。</p>
      <p ALIGN="center"><img src="T4_4.gif" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/vc++5.0/chap4/T4_4.gif" alt="T4_4.tif (115062 bytes)" WIDTH="458" HEIGHT="233"></p>
      <p ALIGN="center"></font><font size="2">图<font FACE="Times New Roman">4.4 </font>修改后的工具条资源</p>
      <p ALIGN="JUSTIFY"></font><font SIZE="3">分别为两个新加的按钮指定命令</font><font FACE="Times New Roman" SIZE="3">ID</font><font SIZE="3">为</font><font FACE="Times New Roman" SIZE="3">ID_RECORD_START</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">ID_RECORD_STOP</font><font SIZE="3">。指定</font><font FACE="Times New Roman" SIZE="3">ID</font><font SIZE="3">的方法是先选中一个按钮，接着按回车键，在弹出的属性对话框中输入</font><font FACE="Times New Roman" SIZE="3">ID(</font><font SIZE="3">或从</font><font FACE="Times New Roman" SIZE="3">ID</font><font SIZE="3">下拉列表中分别选择</font><font FACE="Times New Roman" SIZE="3">ID_RECORD_START</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">ID_RECORD_STOP)</font><font SIZE="3">。注意到这两个按钮的</font><font FACE="Times New Roman" SIZE="3">ID</font><font SIZE="3">与</font><font FACE="Times New Roman" SIZE="3">Record</font><font SIZE="3">菜单中的两个菜单项</font><font FACE="Times New Roman" SIZE="3">Start</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">Stop</font><font SIZE="3">的</font><font FACE="Times New Roman" SIZE="3">ID</font><font SIZE="3">相同，这样同样的命令既可以通过菜单执行，也可以通过工具条执行。</p>
      <p ALIGN="JUSTIFY">为两个新加的按钮指定命令提示。请分别在两个按钮的属性对话框中的</font><font FACE="Times New Roman" SIZE="3">Prompt</font><font SIZE="3">栏内输入</font><font FACE="Times New Roman" SIZE="3">Start record\nStart</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">Stop record\nStop</font><font SIZE="3">。命令提示实际上是作为字符串保存在</font><font FACE="Times New Roman" SIZE="3">String Table</font><font SIZE="3">字符串资源中的。命令提示用来解释命令的意义，分状态栏提示和工具提示两种，在</font><font FACE="Times New Roman" SIZE="3">Prompt</font><font SIZE="3">栏中，二者由</font><font FACE="Times New Roman" SIZE="3">\n</font><font SIZE="3">分隔开。当鼠标移动到某个菜单项或工具条上的按钮时，在状态栏中就会显示状态栏提示，当鼠标在某个按钮上停留片刻后，工具提示就会在一个黄色的弹出式窗口中显示出来。输入完成后，读者会发现</font><font FACE="Times New Roman" SIZE="3">Record</font><font SIZE="3">菜单中的两个菜单项被自动加入了相同的提示信息，这说明两个按钮与两个菜单项确实是相对应的。</p>
      </font><b>
    </blockquote>
    <font SIZE="3"><div align="center"><center><table border="2" cellpadding="2" cellspacing="0" width="90%" bgcolor="#BBFFFF">
      <tr>
        <td width="100%"></b>提示</font><font FACE="Times New Roman" SIZE="3">:</font><font SIZE="3">如果觉得按钮太小，读者可以用鼠标拖动围绕按钮放大位图的虚框的右下角，把按钮放大些。注意工具条内的所有按钮都将被放大<b></td>
      </tr>
    </table>
    </center></div></b></font><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY"></font><font SIZE="3">修改完后，读者可以编译并运行</font><font FACE="Times New Roman" SIZE="3">Record</font><font SIZE="3">，来看看修改的结果。读者很快会注意到</font><font FACE="Times New Roman" SIZE="3">Start</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">Stop</font><font SIZE="3">菜单项及按钮都是灰色的。这个现象是正常的，其原因将在</font><font FACE="Times New Roman" SIZE="3">4.2</font><font SIZE="3">节解释。有趣的是工具条可以被拖动（请在工具条的空白地方拖动）并停泊在主框架窗口的任何其它边上，并且工具条是可以浮动的，即当用鼠标双击工具条的空白处时，工具条变成了一个浮动窗口，可被拖动到屏幕上的任意地方。这些有趣的现象将在</font><font FACE="Times New Roman" SIZE="3">4.2</font><font SIZE="3">节解释。不管怎么说，创建和修改工具条的任务已经完成了。</font><font FACE="Times New Roman" SIZE="3"></p>
    <b><p ALIGN="JUSTIFY"></b></font><font color="#3973DE" FACE="Times New Roman" SIZE="3">4.1.2</font><font SIZE="3" color="#3973DE">手工创建</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">如果想要再加一个工具条，那么</font><font FACE="Times New Roman" SIZE="3">AppWizard</font><font SIZE="3">就无能为力了，必须手工创建。假设</font><font FACE="Times New Roman" SIZE="3">Record</font><font SIZE="3">程序的声音采样频率有</font><font FACE="Times New Roman" SIZE="3">11KHZ</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">44KHZ</font><font SIZE="3">两档选择，现在我们的任务是再创建一个工具条，可让用户对这两种档次进行选择。本来这样的功能应该位于第一个工具条内，但为了演示工具条的手工创建，这里不妨来个多此一举。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">如果</font><font FACE="Times New Roman" SIZE="3">Record</font><font SIZE="3">工程不在</font><font FACE="Times New Roman" SIZE="3">Developer Studio</font><font SIZE="3">中，请选择命令</font><font FACE="Times New Roman" SIZE="3">File-&gt;Open Workspace</font><font SIZE="3">打开</font><font FACE="Times New Roman" SIZE="3">Record</font><font SIZE="3">工程。首先要对原来的菜单进行修改，步骤如下：</p>
    <blockquote>
      <ol>
        <li><p ALIGN="JUSTIFY">打开<font FACE="Times New Roman" SIZE="3">IDR_MAINFRAME</font>菜单资源</p>
        </li>
        <li><p ALIGN="JUSTIFY">双击<font FACE="Times New Roman" SIZE="3">Record</font>菜单底端的空白项，在其属性窗口中选中<font FACE="Times New Roman" SIZE="3">Separator</font>，这样就加入了一条分隔线。</p>
        </li>
        <li><p ALIGN="JUSTIFY">在分隔线下面加入两个菜单项，其属性如表<font FACE="Times New Roman" SIZE="3">4.1</font>所示。</p>
        </li>
      </ol>
    </blockquote>
    </font><p>　<b><font SIZE="3"></p>
    <p ALIGN="CENTER">表</font><font FACE="Times New Roman" SIZE="3">4.1 </font><font SIZE="3">菜单项的属性</font></b></p>
    <table BORDER="1" CELLSPACING="1" CELLPADDING="1" WIDTH="579">
      <tr>
        <td WIDTH="33%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="CENTER">Caption</font></td>
        <td WIDTH="33%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="CENTER">ID</font></td>
        <td WIDTH="33%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="CENTER">Prompt</font></td>
      </tr>
      <tr>
        <td WIDTH="33%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="CENTER">&amp;Low quality</font></td>
        <td WIDTH="33%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="CENTER">ID_LOW_QUALITY</font></td>
        <td WIDTH="33%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="CENTER">Low 
        quality(11k)\n11k</font></td>
      </tr>
      <tr>
        <td WIDTH="33%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="CENTER">&amp;High quality</font></td>
        <td WIDTH="33%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="CENTER">ID_HIGH_QUALITY</font></td>
        <td WIDTH="33%"><font FACE="Times New Roman" SIZE="3"><p ALIGN="CENTER">High 
        quality(44k)\n44k</font></td>
      </tr>
    </table>
    <font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY"></font><font SIZE="3">接着要创建一个新的工具条资源，请按以下步骤进行：</p>
    <blockquote>
      <blockquote>
        <p ALIGN="JUSTIFY">选择</font><font FACE="Times New Roman" SIZE="3">Insert-&gt;Resource</font><font SIZE="3">命令，然后在</font><font FACE="Times New Roman" SIZE="3">Insert Resource</font><font SIZE="3">对话框中选中</font><font FACE="Times New Roman" SIZE="3">Toolbar</font><font SIZE="3">。按了</font><font FACE="Times New Roman" SIZE="3">OK</font><font SIZE="3">按钮后，在</font><font FACE="Times New Roman" SIZE="3">Toolbar</font><font SIZE="3">资源类下就会出现一个</font><font FACE="Times New Roman" SIZE="3">ID</font><font SIZE="3">为</font><font FACE="Times New Roman" SIZE="3">IDR_TOOLBAR1</font><font SIZE="3">的新资源。</p>
        <p ALIGN="JUSTIFY">在新工具条中加入两个按钮，如图</font><font FACE="Times New Roman" SIZE="3">4.5</font><font SIZE="3">所示。每个按钮上都画了一些竖线，线稀的按钮代表低频率采样，线密的按钮代表高频率采样。</p>
        <p ALIGN="center"><img src="T4_5.gif" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/vc++5.0/chap4/T4_5.gif" alt="T4_5.tif (115754 bytes)" WIDTH="459" HEIGHT="234"></p>
        <p ALIGN="center">图</font><font FACE="Times New Roman" SIZE="3">4.5 </font><font SIZE="3">新创建的工具条资源</p>
        <p ALIGN="JUSTIFY">分别为两个新加的按钮指定命令</font><font FACE="Times New Roman" SIZE="3">ID</font><font SIZE="3">为</font><font FACE="Times New Roman" SIZE="3">ID_LOW_QUALITY</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">ID_HIGH_QUALITY</font><font SIZE="3">。</font></p>
      </blockquote>
    </blockquote>
    <p>　<font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">要把这个新设计的工具条加入到程序中，需要在程序中加入一些与创建有关的源代码。在创建第一个工具条时，</font><font FACE="Times New Roman" SIZE="3">AppWizard</font><font SIZE="3">在程序中自动加入了创建源代码，通过仿制这些代码，我们很容易创建出第二个工具条。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">在</font><font FACE="Times New Roman" SIZE="3">MFC</font><font SIZE="3">中，工具条的功能由类</font><font FACE="Times New Roman" SIZE="3">CToolBar</font><font SIZE="3">实现。工具条实际上是主框架窗口的子窗口，因此工具条对象应该依附于主框架窗口对象。在</font><font FACE="Times New Roman" SIZE="3">AppWizard</font><font SIZE="3">创建的</font><font FACE="Times New Roman" SIZE="3">MFC</font><font SIZE="3">程序中，主框架窗口的类名是</font><font FACE="Times New Roman" SIZE="3">CMainFrame</font><font SIZE="3">，该类是</font><font FACE="Times New Roman" SIZE="3">MFC</font><font SIZE="3">标准类</font><font FACE="Times New Roman" SIZE="3">CFrameWnd</font><font SIZE="3">类的派生类。将项目工作区切换至类视图并展开</font><font FACE="Times New Roman" SIZE="3">CMainFrame</font><font SIZE="3">类，读者会发现该类有一个名为</font><font FACE="Times New Roman" SIZE="3">m_wndToolbar</font><font SIZE="3">的成员。双击该成员，则</font><font FACE="Times New Roman" SIZE="3">Developer Studio</font><font SIZE="3">会自动打开类</font><font FACE="Times New Roman" SIZE="3">CMainFrame</font><font SIZE="3">所在的头文件，并将光标停在对</font><font FACE="Times New Roman" SIZE="3">m_wndToolbar</font><font SIZE="3">成员的定义处。</font><font FACE="Times New Roman" SIZE="3"></p>
    <div align="center"><center><table border="2" cellpadding="2" cellspacing="0" width="90%" bgcolor="#BBFFFF">
      <tr>
        <td width="100%"></font><b><font SIZE="3"><font SIZE="3">提示</font></font><font FACE="Times New Roman" SIZE="3">:</font><font SIZE="3"><font SIZE="3">在类视图中双击某一个类名，则该类所在的头文件会自动打开。若双击某一个类的成员，则会自动切换到对该成员的定义处。</font></font></b><font FACE="Times New Roman" SIZE="3"></td>
      </tr>
    </table>
    </center></div><p ALIGN="JUSTIFY">　</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">对</font><font FACE="Times New Roman" SIZE="3">m_wndToolBar</font><font SIZE="3">的定义如下：</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">CToolBar m_wndToolBar;</p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">由此可见</font><font FACE="Times New Roman" SIZE="3">m_wndToolBar</font><font SIZE="3">是一个</font><font FACE="Times New Roman" SIZE="3">CToolBar</font><font SIZE="3">对象，它是</font><font FACE="Times New Roman" SIZE="3">CMainFrame</font><font SIZE="3">的成员。现在请紧接着该成员加入一个新的成员：</font><font FACE="Times New Roman" SIZE="3"><b></p>
    <p ALIGN="JUSTIFY">CToolBar m_wndToolBar1;</b></p>
    <p ALIGN="JUSTIFY">m_wndToolBar1</font><font SIZE="3">代表第二个工具条。读者不要以为给</font><font FACE="Times New Roman" SIZE="3">CMainFrame</font><font SIZE="3">加入一个</font><font FACE="Times New Roman" SIZE="3">CToolBar</font><font SIZE="3">对象就完事了。实际的创建工具条的工作不会在构造</font><font FACE="Times New Roman" SIZE="3">CToolBar</font><font SIZE="3">对象时完成，只有调用了类</font><font FACE="Times New Roman" SIZE="3">CToolBar</font><font SIZE="3">的一些成员函数后，创建工作才能结束。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">对工具条的实际创建工作在</font><font FACE="Times New Roman" SIZE="3">CMainFrame::OnCreate</font><font SIZE="3">函数中完成。</font><font FACE="Times New Roman" SIZE="3">OnCreate</font><font SIZE="3">函数是在创建窗口时被调用的，这时窗口的创建已部分完成，窗口对象的</font><font FACE="Times New Roman" SIZE="3">m_hWnd</font><font SIZE="3">成员中存放的</font><font FACE="Times New Roman" SIZE="3">HWND</font><font SIZE="3">句柄也已有效，但窗口还是不可见的。因此一般在</font><font FACE="Times New Roman" SIZE="3">OnCreate</font><font SIZE="3">函数中作一些诸如创建子窗口的初始化工作。</font><font FACE="Times New Roman" SIZE="3"></p>
    </font><font SIZE="3"><b><div align="center"><center><table border="2" cellpadding="2" cellspacing="0" width="90%" bgcolor="#BBFFFF">
      <tr>
        <td width="100%"></b>提示</font><font FACE="Times New Roman" SIZE="3">:</font><font SIZE="3">初学者一个易犯的错误是在构造函数而不是在</font><font FACE="Times New Roman" SIZE="3">OnCreate</font><font SIZE="3">中创建子窗口。在构造函数中，父窗口并没有创建，如果在这时创建子窗口，则将会因为得不到父窗口的有效</font><font FACE="Times New Roman" SIZE="3">HWND</font><font SIZE="3">句柄而导致创建失败。<b></td>
      </tr>
    </table>
    </center></div></b></font><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY"></font><font SIZE="3">找到</font><font FACE="Times New Roman" SIZE="3">CMainFrame::OnCreate</font><font SIZE="3">函数，对该函数进行一些修改，修改的部分如清单</font><font FACE="Times New Roman" SIZE="3">4.1</font><font SIZE="3">的黑体字所示。在以后，凡是程序中手工修改的部分，一般都会用黑体显示。</font><b><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font>　<font SIZE="3"></p>
    <p ALIGN="JUSTIFY">清单</font><font FACE="Times New Roman" SIZE="3">4.1 </font><font SIZE="3">修改后的</font><font FACE="Times New Roman" SIZE="3">CMainFrame::OnCreate</font><font SIZE="3">函数</font></b><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY">int CMainFrame::OnCreate(LPCREATESTRUCT lpCreateStruct)</p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">if (CFrameWnd::OnCreate(lpCreateStruct) == -1)</p>
    <p ALIGN="JUSTIFY">return -1;</p>
    <p ALIGN="JUSTIFY">　</p>
    <p ALIGN="JUSTIFY">if (!m_wndToolBar.Create(this) ||</p>
    <p ALIGN="JUSTIFY">!m_wndToolBar.LoadToolBar(IDR_MAINFRAME))</p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">TRACE0(&quot;Failed to create toolbar\n&quot;);</p>
    <p ALIGN="JUSTIFY">return -1; // fail to create</p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY">　</p>
    <p>　<b></p>
    <p ALIGN="JUSTIFY">if (!m_wndToolBar1.Create(this) ||</p>
    <p ALIGN="JUSTIFY">!m_wndToolBar1.LoadToolBar(IDR_TOOLBAR1))</p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">TRACE0(&quot;Failed to create toolbar\n&quot;);</p>
    <p ALIGN="JUSTIFY">return -1; // fail to create</p>
    <p ALIGN="JUSTIFY">}</b></p>
    <p ALIGN="JUSTIFY">　</p>
    <p ALIGN="JUSTIFY">if (!m_wndStatusBar.Create(this) ||</p>
    <p ALIGN="JUSTIFY">!m_wndStatusBar.SetIndicators(indicators,</p>
    <p ALIGN="JUSTIFY">sizeof(indicators)/sizeof(UINT)))</p>
    <p ALIGN="JUSTIFY">{</p>
    <p ALIGN="JUSTIFY">TRACE0(&quot;Failed to create status bar\n&quot;);</p>
    <p ALIGN="JUSTIFY">return -1; // fail to create</p>
    <p ALIGN="JUSTIFY">}</p>
    <p ALIGN="JUSTIFY">　</p>
    <p ALIGN="JUSTIFY">// TODO: Remove this if you don't want tool tips or a resizeable 
    toolbar</p>
    <p ALIGN="JUSTIFY">m_wndToolBar.SetBarStyle(m_wndToolBar.GetBarStyle() |</p>
    <p ALIGN="JUSTIFY">CBRS_TOOLTIPS | CBRS_FLYBY | CBRS_SIZE_DYNAMIC);</p>
    <p ALIGN="JUSTIFY">　</p>
    <blockquote>
      <blockquote>
        <blockquote>
          <blockquote>
            <blockquote>
              <blockquote>
                <blockquote>
                  <blockquote>
                    <b><p ALIGN="JUSTIFY">m_wndToolBar1.SetBarStyle(m_wndToolBar1.GetBarStyle()|CBRS_TOOLTIPS 
                    | CBRS_FLYBY | CBRS_SIZE_DYNAMIC);</p>
                    </b>
                  </blockquote>
                </blockquote>
              </blockquote>
            </blockquote>
          </blockquote>
        </blockquote>
      </blockquote>
    </blockquote>
    <p ALIGN="JUSTIFY">// TODO: Delete these three lines if you don't want the toolbar to</p>
    <p ALIGN="JUSTIFY">// be dockable</p>
    <p ALIGN="JUSTIFY">m_wndToolBar.EnableDocking(CBRS_ALIGN_ANY);</p>
    <p>　<b></p>
    <p ALIGN="JUSTIFY">m_wndToolBar1.EnableDocking(CBRS_ALIGN_ANY);</b></p>
    <p ALIGN="JUSTIFY">　</p>
    <p ALIGN="JUSTIFY">EnableDocking(CBRS_ALIGN_ANY);</p>
    <p ALIGN="JUSTIFY">　</p>
    <p ALIGN="JUSTIFY">DockControlBar(&amp;m_wndToolBar);</p>
    <p>　<b></p>
    <p ALIGN="JUSTIFY">DockControlBar(&amp;m_wndToolBar1);</b></p>
    <p ALIGN="JUSTIFY">return 0;</p>
    <p ALIGN="JUSTIFY">}</p>
    <b><p ALIGN="JUSTIFY"></b></font><font SIZE="3">注意在</font><font FACE="Times New Roman" SIZE="3">CMainFrame::OnCreate</font><font SIZE="3">函数首先调用了</font><font FACE="Times New Roman" SIZE="3">CFrameWnd::OnCreate</font><font SIZE="3">。这行代码是</font><font FACE="Times New Roman" SIZE="3">AppWizard</font><font SIZE="3">自动加入的，但有必要解释一下。</font><font FACE="Times New Roman" SIZE="3">CMainFrame</font><font SIZE="3">是</font><font FACE="Times New Roman" SIZE="3">CFrameWnd</font><font SIZE="3">类的继承类，在</font><font FACE="Times New Roman" SIZE="3">CMainFrame::OnCreate</font><font SIZE="3">中首先要调用基类</font><font FACE="Times New Roman" SIZE="3">CFrameWnd</font><font SIZE="3">的</font><font FACE="Times New Roman" SIZE="3">OnCreate</font><font SIZE="3">函数，因为基类也要进行一些初始化工作，而基类的</font><font FACE="Times New Roman" SIZE="3">OnCreate</font><font SIZE="3">函数不会自动调用，因此需要在继承类的</font><font FACE="Times New Roman" SIZE="3">OnCreate</font><font SIZE="3">函数中显式调用。</font><font FACE="Times New Roman" SIZE="3">OnCreate</font><font SIZE="3">实际上是</font><font FACE="Times New Roman" SIZE="3">WM_CREATE</font><font SIZE="3">消息的消息处理函数，读者可能要问，为什么是派生类的</font><font FACE="Times New Roman" SIZE="3">OnCreate</font><font SIZE="3">处理</font><font FACE="Times New Roman" SIZE="3">WM_CREATE</font><font SIZE="3">消息，而不是基类的</font><font FACE="Times New Roman" SIZE="3">OnCreate</font><font SIZE="3">呢。如果读者仔细观察</font><font FACE="Times New Roman" SIZE="3">OnCreate</font><font SIZE="3">函数在</font><font FACE="Times New Roman" SIZE="3">CMainFrame</font><font SIZE="3">类头文件中的说明，就会发现在该函数前有一个</font><font FACE="Times New Roman" SIZE="3">afx_msg</font><font SIZE="3">前缀。</font><font FACE="Times New Roman" SIZE="3">afx_msg</font><font SIZE="3">的作用与</font><font FACE="Times New Roman" SIZE="3">virtual</font><font SIZE="3">关键字类似，它使得被说明的函数有虚拟函数的特性，即由继承类而不是基类的处理函数来处理消息。</font><font FACE="Times New Roman" SIZE="3"></p>
    <p ALIGN="JUSTIFY"></font><font SIZE="3">读者可以看出黑体的代码是仿照第一个工具条的创建代码进行编写的。事实上，笔者不过是将原来的代码复制一份，然后在略作修改而已。</font><font FACE="Times New Roman" SIZE="3"></p>
    </font><font SIZE="3"><b><div align="center"><center><table border="2" cellpadding="2" cellspacing="0" width="90%" bgcolor="#BBFFFF">
      <tr>
        <td width="100%"></b>提示</font><font FACE="Times New Roman" SIZE="3">: </font><font SIZE="3">读者不必为这种“抄袭”行为感到羞愧。由于</font><font FACE="Times New Roman" SIZE="3">Visual C++</font><font SIZE="3">博大精深，各种类和函数成百上千，除非你有外星人一般的记忆力，否则是不可能记住所有东西的。用</font><font FACE="Times New Roman" SIZE="3">Visual C++</font><font SIZE="3">编程，重要的是理解而不是记忆。只要你理解了程序的来龙去脉，就可以最大限度的利用现有的成熟代码，提高程序的开发效率和可靠性。<b></td>
      </tr>
    </table>
    </center></div></b></font><font FACE="Times New Roman" SIZE="3"><p ALIGN="JUSTIFY"></font><font SIZE="3">对第二个工具条的创建代码的解释是：首先，调用</font><font FACE="Times New Roman" SIZE="3">CToolBar::Create</font><font SIZE="3">以创建工具条窗口，注意</font><font FACE="Times New Roman" SIZE="3">Create</font><font SIZE="3">函数的参数是</font><font FACE="Times New Roman" SIZE="3">this</font><font SIZE="3">指针，这是因为主框架窗口是工具条的父窗口。接着调用</font><font FACE="Times New Roman" SIZE="3">CToolbar::LoadToolBar(IDR_TOOLBAR1)</font><font SIZE="3">以载入工具条资源。然后调用</font><font FACE="Times New Roman" SIZE="3">CToolBar::SetBarStyle</font><font SIZE="3">指定工具条的风格，在调用该函数时先调用</font><font FACE="Times New Roman" SIZE="3">CToolBar::GetBarStyle</font><font SIZE="3">取得工具条的风格，然后在原有风格的基础上又指定了</font><font FACE="Times New Roman" SIZE="3">CBRS_TOOLTIPS</font><font SIZE="3">、 </font><font FACE="Times New Roman" SIZE="3">CBRS_FLYBY</font><font SIZE="3">和</font><font FACE="Times New Roman" SIZE="3">CBRS_SIZE_DYNAMIC</font><font SIZE="3">风格，这使得工具条可显示工具提示，并可以动态改变尺寸。接着调用</font><font FACE="Times New Roman" SIZE="3">CToolBar::EnableDocking(CBRS_ALIGN_ANY)</font><font SIZE="3">使工具条是可以停泊的，但还需调用</font><font FACE="Times New Roman" SIZE="3">CFrameWnd::EnableDocking(CBRS_ALIGN_ANY)</font><font SIZE="3">，只有这样才能实现可停泊的工具条。最后调用</font><font FACE="Times New Roman" SIZE="3">CFrameWnd::DockControlBar</font><font SIZE="3">以停泊工具条。</font><font FACE="Times New Roman" SIZE="3"><b></p>
    <p ALIGN="JUSTIFY"></b></font><font SIZE="3">编译并运行</font><font FACE="Times New Roman" SIZE="3">Record</font><font SIZE="3">看看，现在</font><font FACE="Times New Roman" SIZE="3">Record</font><font SIZE="3">程序已经拥有两个工具条了。至此创建工具条的任务已经完成，下面需要对工具条编程，以使其能够发挥执行命令的功能。</font><font FACE="Times New Roman" SIZE="3"></p>
    </font><div align="center"><center><table border="0" cellpadding="0" cellspacing="0" width="615">
      <tr>
        <td><a href="chap2_4.htm" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/vc++5.0/chap2/chap2_4.htm">上一页</a></td>
        <td><p align="right"><a href="chap2_6.htm" tppabs="http://www.lzu.edu.cn/netteach/jiaochen/vc++5.0/vc++5.0/chap2/chap2_6.htm">下一页</a></td>
      </tr>
    </table>
    </center></div><font SIZE="5"><hr noshade color="#3973DE" size="1">
    <p align="center"></font><font size="2" color="#000000">本教程由<a href="javascript:if(confirm('http://vcdynasty.yeah.net/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://vcdynasty.yeah.net/'" tppabs="http://vcdynasty.yeah.net/">Visual C++王朝（Where programmers come together）</a>协助制作<br>
    未经许可，请勿以任何形式复制</font></td>
    <b>
  </tr>
</table>
</center></div>

<p ALIGN="CENTER"></b><font SIZE="5">　</font><font FACE="Times New Roman" SIZE="5"></p>
</font><font FACE="Times New Roman" SIZE="3">

<p></font><b><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>
</font></b>

<p><font SIZE="3">　</font><font FACE="Times New Roman" SIZE="3"></p>

<p></font>　</p>
</body>
</html>
