<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0043)http://www.yesky.com/20030313/1656978.shtml -->
<HTML xmlns="http://www.w3.org/TR/xhtml1/strict"><HEAD><TITLE>Visual C++实现Flash动画播放</TITLE>
<META http-equiv=Content-Type content="text/html; charset=GB2312"></META><LINK 
href="Visual C++实现Flash动画播放.files/cpcw.css" rel=stylesheet></LINK>
<STYLE>.nava {
	FONT-SIZE: 9pt
}
</STYLE>

<META content="MSHTML 6.00.2743.600" name=GENERATOR></META>
<SCRIPT language=JavaScript>function sendemail(){	
OpenWindow = window.open('http://other.chinabyte.com/chinabyte/qin/sendemail.shtm?url=http%3A%2F%2Fwww.yesky.com/20030313/1656978.shtml&title=Visual C++实现Flash动画播放&channel=9','emailwin','toolbar=no,location=no,scrollbars=no,menubar=no,width=462,height=450')
}</SCRIPT>
</HEAD>
<BODY text=#000000 bgColor=#ffffff leftMargin=0 topMargin=2 marginheight="0" 
marginwidth="0">
<DIV align=center>
<TABLE height=90 cellSpacing=0 cellPadding=0 width=760 border=0>
  <TBODY>
  <TR>
    <TD width=149>&nbsp;</TD>
    <TD colSpan=2><A href="http://www.yesky.com/">首页</A> ・<A 
      href="http://www.yesky.com/ServerIndex/77124143618719744/index.shtml"><FONT 
      class=zzz>硬件</FONT> </A>・ <A 
      href="http://www.chinabyte.com/Enterprise/218706056904179712/index.shtml">E企业 
      </A>・<A href="http://price.yesky.com/"> 商情 </A>・<A 
      href="http://www.yesky.com/Fashion/73746443898191872/index.shtml"> 数字电子 
      </A>・<A 
      href="http://www.yesky.com/SoftChannel/72339069014638592/index.shtml"> 软件 
      </A>・ <A 
      href="http://www.yesky.com/Gameall/73183493944770560/index.shtml">游戏 
      </A>・<A href="http://download.yesky.com/"> 下载 </A>・ <A 
      href="http://www.yesky.com/Etimes/74872343805034496/index.shtml">E时代</A>・ 
      <A href="http://bbs.yesky.com/">论坛</A></TD></TR>
  <TR>
    <TD vAlign=top align=middle width=149 height=70><IMG height=60 
      src="Visual C++实现Flash动画播放.files/bz2.gif" width=110></TD>
    <TD vAlign=top width=474><IFRAME 
      src="Visual C++实现Flash动画播放.files/y-soft-column-s.htm" frameBorder=0 
      width=500 scrolling=no height=90></IFRAME></TD>
    <TD vAlign=top width=137><IFRAME 
      src="Visual C++实现Flash动画播放.files/soft.yesky[2]" frameBorder=0 width=130 
      scrolling=no height=60></IFRAME></TD></TR></TBODY></TABLE><IFRAME 
src="Visual C++实现Flash动画播放.files/y-soft-column-1.htm" frameBorder=0 width=766 
scrolling=no height=96>
		</IFRAME>
<TABLE cellSpacing=0 cellPadding=0 width=760 bgColor=#979797 border=0>
  <TBODY>
  <TR>
    <TD width=10></TD>
    <TD width=536><SPAN class=nava><FONT color=#ffffff>您现在的位置是： </FONT><A 
      href="http://www.yesky.com/72339069014638592/index.shtml"><FONT 
      color=#ffffff>软件</FONT></A><FONT color=#ffffff> &gt; </FONT><A 
      href="http://www.yesky.com/72342367549521920/index.shtml"><FONT 
      color=#ffffff>开发者网络</FONT></A><FONT color=#ffffff> &gt; </FONT><A 
      href="http://www.yesky.com/72342371844489216/index.shtml"><FONT 
      color=#ffffff>程序方舟</FONT></A><FONT color=#ffffff> &gt; </FONT><A 
      href="http://www.yesky.com/72342371928375296/index.shtml"><FONT 
      color=#ffffff>开发专栏</FONT></A><FONT color=#ffffff> &gt; </FONT><A 
      href="http://www.yesky.com/72342371928702976/index.shtml"><FONT 
      color=#ffffff>Visual C++开发</FONT></A><FONT color=#ffffff> &gt; 
      </FONT><FONT color=#ffffff>正文</FONT></SPAN></TD>
    <TD width=214 bgColor=#f7f7f7><IMG height=22 
      src="Visual C++实现Flash动画播放.files/content-1.gif" 
  width=214></IMG></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width=760 bgColor=#f7f7f7 border=0>
  <TBODY>
  <TR>
    <TD width=149 height=10></TD>
    <TD width=1 background="Visual C++实现Flash动画播放.files/content-3.gif" 
    height=10></TD>
    <TD width=610 height=10></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width=760 bgColor=#f7f7f7 border=0>
  <TBODY>
  <TR>
    <TD vAlign=top align=middle width=149>・<A 
      href="http://www.chinabyte.com/20020731/1623017.shtml">速成电脑精英（包分配）白领高薪一族从这里开始</A></TD></TR>
  <TR>
    <TD vAlign=top align=middle width=149><IFRAME 
      src="Visual C++实现Flash动画播放.files/softwaresv.html" frameBorder=0 width=120 
      scrolling=no height=500></IFRAME><BR><BR>
      <TABLE cellSpacing=0 cellPadding=0 width=135 border=0>
        <TBODY>
        <TR>
          <TD width=30 bgColor=#3d7b7b><IMG height=17 
            src="Visual C++实现Flash动画播放.files/content-2.gif" width=24 
            align=absMiddle></IMG></TD>
          <TD class=nava align=middle width=105 bgColor=#a0d0d0><A class=A1 
            href="http://www.yesky.com/72348964619288576/index.shtml"><FONT 
            color=#000000>T O P 排 行</FONT></A></TD></TR>
        <TR>
          <TD vAlign=top align=middle width="6%" bgColor=#ebebeb>-</TD>
          <TD width="94%" bgColor=#ebebeb><A 
            href="http://www.yesky.com/20030313/1656832.shtml">文件系统基础知识（上）</A><BR></TD></TR>
        <TR>
          <TD vAlign=top align=middle width="6%" bgColor=#ebebeb>-</TD>
          <TD width="94%" bgColor=#ebebeb><A 
            href="http://www.yesky.com/20030312/1656661.shtml">Photoshop字体特效手册</A><BR></TD></TR>
        <TR>
          <TD vAlign=top align=middle width="6%" bgColor=#ebebeb>-</TD>
          <TD width="94%" bgColor=#ebebeb><A 
            href="http://www.yesky.com/20030312/1656629.shtml">硬件测试小软件集粹</A><BR></TD></TR>
        <TR>
          <TD vAlign=top align=middle width="6%" bgColor=#ebebeb>-</TD>
          <TD width="94%" bgColor=#ebebeb><A 
            href="http://www.yesky.com/20030312/1656602.shtml">在故障恢复控制台对硬盘分区和格式化</A><BR></TD></TR></TBODY></TABLE><BR>
      <TABLE cellSpacing=0 cellPadding=0 width=135 border=0>
        <TBODY>
        <TR>
          <TD width=30 bgColor=#3d7b7b><IMG height=17 
            src="Visual C++实现Flash动画播放.files/content-2.gif" width=24 
            align=absMiddle></IMG></TD>
          <TD class=nava align=middle width=105 bgColor=#a0d0d0><A class=A1 
            href="http://training.yesky.com/"><FONT color=#000000>网 校 热 
            门</FONT></A></TD></TR></TBODY></TABLE>
      <SCRIPT src="Visual C++实现Flash动画播放.files/softyesky.js"></SCRIPT>
    </TD>
    <TD width=1 background="Visual C++实现Flash动画播放.files/content-3.gif"></TD>
    <TD vAlign=top align=middle>
      <TABLE cellSpacing=2 cellPadding=0 width=550 border=0>
        <TBODY>
        <TR>
          <TD align=middle><B><FONT class=BHEAD color=#333399>Visual 
            C++实现Flash动画播放</FONT></B></TD></TR>
        <TR>
          <TD bgColor=#bbbbbb height=1></TD></TR>
        <TR>
          <TD align=middle><FONT face="Arial, Helvetica, sans-serif"><SPAN 
            class=nava>2003-03-13・ ・信息产业部电子第二十二研究所青岛分所 
            郎锐・・yesky<BR><BR></SPAN></FONT></TD></TR>
        <TR>
          <TD><SPAN class=txt><IFRAME align=right marginWidth=0 marginHeight=0 
            src="Visual C++实现Flash动画播放.files/cont_flash_software.html" 
            frameBorder=0 width=360 scrolling=no height=300></IFRAME>
            <P>　　摘要： 
            本文通过在VC中将外部swf格式文件内嵌为VC的内部资源，使其在程序运行过程中从资源动态释放到临时文件，从而实现VC对Flash动画的播放。<BR></P>
            <P>　　<B>引言</B></P>
            <P>　　Flash动画由于可以很方便地把用户的想象通过动画显现出来，使原本只属于专业制作人员的动画制作变的异乎寻常的快捷、方便。由于Flash制作的动画在层次、内容、表现形式等诸多方面均比较出色，因此在网络上得到迅猛的发展，更有不少厂商用Flash在互联网上做起了广告和产品演示，效果丝毫不比视频的差，而体积则要小的多。Flash不仅在网络上有广泛的应用，在普通的应用程序中也可以借助Flash实现一些VC、Delphi等编程语言所难以实现的特效，比如在一些演示版的程序中完全可以将程序运行前的闪屏用Flash来制作。本文下面将通过对内嵌资源的动态释放来实现VC对Flash动画的播放，并给出了部分实现代码。</P>
            <P>　　<B>嵌资源的动态释放</B></P>
            <P>　　Flash动画在此是作为程序的一个模块，虽然也可以以文件的形式作为一个外部资源来使用，但为了避免因外部模块遗失而造成程序的非正常运行，可将由Flash 
            5.0预先制作好的swf格式的文件以资源的形式打包到应用程序中去，而在程序运行时再将其从资源恢复到文件，使用完毕再通过程序将其从磁盘删除。</P>
            <P>　　在导入资源时由于swf格式文件并非VC的标准资源，所以在导入时需要在"Resource 
            type"栏指定资源类型"SWF"，特别需要注意的是在此必须要包含引号。加入到资源后可以通过资源视图看到导入的SWF资源是以二进制形式保存的，一但加入就不能再通过资源视图对其进行编辑了。</P>
            <P>　　在使用SWF资源前首先要将其动态从应用程序中释放到文件中才可对资源做进一步的使用。可先通过宏MAKEINTRESOURCE（）将资源标识号IDR_SWF转换成字符串Name，再分别通过FindResource()、LoadResource()函数查找、装载该资源到内存：</P>
            <TABLE cellPadding=0 width="100%" bgColor=#ffffff border=0>
              <TBODY>
              <TR>
                <TD>CString Type="swf"；<BR>HRSRC res=FindResource 
                  (NULL,Name,Type);<BR>HGLOBAL gl=LoadResource 
              (NULL,res);</TD></TR></TBODY></TABLE>
            <P>　　当资源加载到内存后，还要通过对资源内存的锁定来返回指向资源内存的地址的指针，并籍此实现资源从内存到磁盘的保存，至于存盘的操作则由文件函数CreateFile()、和WriteFile()来完成： 
            </P>
            <TABLE cellPadding=0 width="100%" bgColor=#ffffff border=0>
              <TBODY>
              <TR>
                <TD>LPVOID lp=LockResource(gl); //返回指向资源内存的地址的指针。<BR>CString 
                  filename="Temp.swf"； //保存的临时文件名<BR>// 
                  CREATE_ALWAYS为不管文件存不存在都产生新文件。<BR>fp= CreateFile(filename 
                  ,GENERIC_WRITE,0,NULL,CREATE_ALWAYS,0,NULL);<BR>DWORD 
                  a;<BR>//sizeofResource 得到资源文件的大小<BR>if (!WriteFile 
                  (fp,lp,SizeofResource (NULL,res),&amp;a,NULL))<BR>return 
                  false;<BR>CloseHandle (fp); //关闭句柄<BR>FreeResource (gl); 
                //释放内存</TD></TR></TBODY></TABLE>
            <P>　　通过上述代码，可将SWF资源从应用程序中提取并释放到临时文件Temp.swf中，在此后只对此临时文件操作，与程序内嵌资源无关。</P>
            <P>　　<B>Flash动画的播放</B></P>
            <P>　　swf格式的Flash动画通常主要应用在网页上，也就是说IE浏览器本身可以支持Flash动画的播放。这样就不必再单独编写用于播放swf文件的代码，从而大大减少编程的工作量。在VC 
            ++ 6.0中新增了一个从CView派生的、用于处理网页的视类CHtmlView，由于该类是以Internet 
            Explorer为后台支持，因此在创建工程时只需在最后一步指定视类从CHtmlView派生就可以使程序不编一行代码而具备IE浏览器的网页显示能力。</P>
            <P>　　程序刚生成的时候缺省的连接主页是为微软公司的主页，需要对此修改，使程序在执行时立即显示刚才提取出来的Flash临时文件Temp.swf。显示缺省主页的代码是在视类的初始化函数中进行的：</P>
            <TABLE cellPadding=0 width="100%" bgColor=#ffffff border=0>
              <TBODY>
              <TR>
                <TD>void 
                  CEmbedModuleView::OnInitialUpdate()<BR>{<BR>CHtmlView::OnInitialUpdate();<BR>Navigate2(_T("http://www.microsoft.com"),NULL,NULL);<BR>}</TD></TR></TBODY></TABLE>
            <P>　　显然要将Navigate2（）函数的第一个参数改成Temp.swf的存放路径。刚才在释放资源到文件时并没有指定绝对路径，因此释放出来的资源文件应当和应用程序处于同一目录。但是在此处如果不写明绝对路径是无法显示该临时文件的。获取该临时文件的绝对路径可用如下方法实现：先获取应用程序本身的绝对路径，然后去处应用程序全名（程序名和扩展名）此时得到的是应用程序和临时文件所处文件夹的路径，最后只需在此基础上加上临时文件的文件名Temp.swf即可得到临时文件的全路径。下面是实现的主要代码：<BR></P>
            <TABLE cellPadding=0 width="100%" bgColor=#ffffff border=0>
              <TBODY>
              <TR>
                <TD>//获取应用程序的全路径<BR>char exeFullPath[MAX_PATH]; 
                  <BR>GetModuleFileName(NULL,exeFullPath,MAX_PATH);<BR>//将其格式化为字符串<BR>m_TempFile.Format("%s",exeFullPath);<BR>//去掉应用程序的全名（15为应用程序文件全名的长度）<BR>exeFullPath[m_TempFile.GetLength()-15]='\0';<BR>//得到应用程序所在路径<BR>m_TempFile.Format("%s",exeFullPath);<BR>//得到临时文件的全路径<BR>m_TempFile+="Temp.swf";</TD></TR></TBODY></TABLE>
            <P>　　最后将得到的临时文件的全路径m_TempFile作为参数传递给Navigate2（）即可在程序运行时把Flash动画作为主页而显示（如下图所示）。<BR><BR><IMG 
            height=197 
            src="Visual C++实现Flash动画播放.files/jt-2003-3-13-image002.jpg" 
            width=240><BR></P>
            <P>　　由于临时文件Temp.swf是在程序运行过程中从应用程序的资源中提取出来的，因此在程序退出之前需要将其删除。一般是在消息WM_DESTORY的响应函数里通过DeleteFile()函数来加以实现的。</P>
            <P>　　<B>小结</B></P>
            <P>　　本文通过对CHtmlView和内嵌资源的动态释放实现了Flash动画在VC程序中的播放，并对资源的动态释放作了较为清晰的描述。通过类似的方法，可以将动态链接库、HTML文件等程序模块作为资源嵌入其中，在使用时再动态释放到临时文件，这样可有效避免文件模块过多时的杂乱以及程序模块丢失导致程序非正常运行等情况的发生。本文所述程序在Windows 
            98下，由Microsoft Visual C++ 6.0编译通过。Flash动画由 Macromedia Flash 
            5.0制作，所需浏览器支持为Internet Explorer 6.0。</P>
            <P>&nbsp;</P></SPAN></TD></TR>
        <TR>
          <TD>
            <DIV align=right>【责任编辑：方舟】 <BR>
            <SCRIPT src="Visual C++实现Flash动画播放.files/dell.js"></SCRIPT>
            <IMG height=10 src="Visual C++实现Flash动画播放.files/kong.gif" 
            width=100></IMG><A href="javascript:sendemail()"><IMG height=13 
            src="Visual C++实现Flash动画播放.files/ms_020220.gif" width=73 
            border=0></IMG></A><A 
            href="http://bbs.yesky.com/servlet/IBBS2.ListTopic?forumID=123">【发表评论】</A><A 
            href="javascript:window.close()"><FONT 
            color=#000000>【关闭窗口】</FONT></A></DIV></TD></TR>
        <TR>
          <TD><IFRAME src="Visual C++实现Flash动画播放.files/software.html" 
            frameBorder=0 width=550 scrolling=no height=80></IFRAME>
            <TABLE cellSpacing=0 cellPadding=0 width=550 border=0>
              <TBODY>
              <TR>
                <TD width=1 bgColor=#000000 rowSpan=5></TD>
                <TD bgColor=#000000 height=1></TD>
                <TD width=1 bgColor=#000000 rowSpan=5></TD></TR>
              <TR>
                <TD bgColor=#a0d0d0>■ 相关内容</TD></TR>
              <TR>
                <TD bgColor=#000000 height=1></TD></TR>
              <TR>
                <TD>　<A 
                  href="http://www.yesky.com/20030307/1655676.shtml"><FONT 
                  color=#000000>Visual C++编程控制输入法</FONT></A><BR>　<A 
                  href="http://www.yesky.com/20030303/1654718.shtml"><FONT 
                  color=#000000>Visual C++利用多线程模拟并行计算</FONT></A><BR>　<A 
                  href="http://www.yesky.com/20030211/1651565.shtml"><FONT 
                  color=#000000>Visual C++编程疑难问题解（一）</FONT></A><BR>　<A 
                  href="http://www.yesky.com/20030102/1646785.shtml"><FONT 
                  color=#000000>基于Visual C++的Winsock API研究</FONT></A><BR>　<A 
                  href="http://www.yesky.com/20021224/1645640.shtml"><FONT 
                  color=#000000>Visual C++实现数字图像增强处理</FONT></A><BR>　<A 
                  href="http://www.yesky.com/20021209/1643404.shtml"><FONT 
                  color=#000000>Visual C++模态对话框消息处理机制的分析</FONT></A><BR>　<A 
                  href="http://www.yesky.com/20021205/1642979.shtml"><FONT 
                  color=#000000>Visual C++.NET中的字符串转换方法</FONT></A><BR>　<A 
                  href="http://www.yesky.com/20021122/1641169.shtml"><FONT 
                  color=#000000>Visual C++常微分方程初值问题求解</FONT></A><BR>　<A 
                  href="http://www.yesky.com/20021112/1639489.shtml"><FONT 
                  color=#000000>微软Visual C＃.NET和Visual C++.NET开发蓝图 
                  </FONT></A><BR>　<A 
                  href="http://www.yesky.com/20021021/1635957.shtml"><FONT 
                  color=#000000>Visual C++6.0 API函数操作技巧集 </FONT></A><BR>　<A 
                  href="http://www.yesky.com/20021014/1634708.shtml"><FONT 
                  color=#000000>在Visual C++中使用内联汇编</FONT></A><BR>　<A 
                  href="http://www.yesky.com/20021014/1634674.shtml"><FONT 
                  color=#000000>理解 Visual C++ Extensions for 
                ADO</FONT></A><BR></TD></TR>
              <TR>
                <TD bgColor=#000000 height=1></TD></TR></TBODY></TABLE></TD></TR>
        <TR>
          <TD align=middle><A href="http://www.yesky.com/hdong/zz.htm" 
            target=_blank><FONT 
            color=#000000>感谢访问天极网，如果您觉得该文章涉及版权问题，请看这里！</FONT></A><BR><BR></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width=760 bgColor=#4e4e4e border=0>
  <TBODY>
  <TR>
    <TD height=3></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width=770 align=center border=0>
  <TBODY>
  <TR>
    <TD><IFRAME src="Visual C++实现Flash动画播放.files/floor-tougao.htm" 
      frameBorder=0 width=770 scrolling=no 
height=20></IFRAME></TD></TR></TBODY></TABLE>
<TABLE height=40 cellSpacing=0 cellPadding=0 width=770 align=center border=0>
  <TBODY>
  <TR>
    <TD>
      <DIV align=center><SPAN class=nava><FONT 
      face="Arial, Helvetica, sans-serif" color=#000000>Copyright (C) 2001 
      Yesky.com, All Rights Reserved </FONT><FONT color=#000000><BR>版权所有　 <FONT 
      face="Arial, Helvetica, sans-serif">Yesky </FONT><A 
      href="mailto:webmaster@yesky.com"></A></FONT></SPAN></DIV></TD></TR></TBODY></TABLE>
<SCRIPT language=Javascript>document.write("<img src='http://counter.yesky.com/counter.shtml?CID=72342371928702976&AID=1656978&refer="+escape(document.referrer)+"&cur="+escape(document.URL)+"' border='0' alt='' width='0' height='0'>");</SCRIPT>
<BR></DIV></BODY></HTML>
