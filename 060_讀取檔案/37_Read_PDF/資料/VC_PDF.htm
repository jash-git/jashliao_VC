<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0048)http://www.vckbase.com/document/viewdoc/?id=1049 -->
<HTML><HEAD><TITLE>VC知识库文章 - 做个PDF格式电子图书浏览器</TITLE>
<META http-equiv=Content-Type content="text/html; charset=gb2312">
<META content=pdf,Adobe,Acrobat,activex,reader name=keywords>
<META content=pdf,Adobe,Acrobat,activex,reader name=description><LINK 
href="VC_PDF.files/style.css" rel=stylesheet>
<META content="MSHTML 6.00.2900.5659" name=GENERATOR></HEAD>
<BODY bgColor=#ffffff leftMargin=0 topMargin=0>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR bgColor=#a0d39b>
    <TD width="14%" height=78>&nbsp;<IMG height=13 
      src="VC_PDF.files/vckcom.gif" width=109></TD>
    <TD align=left width="76%"></TD>
    <TD vAlign=bottom align=right height=78><IMG height=27 
      src="VC_PDF.files/earch.gif" width=89></TD></TR>
  <TR bgColor=#eeeeee>
    <TD colSpan=2><FONT class=small color=#333333>::</FONT><A 
      href="http://www.vckbase.com/"><FONT color=black><SPAN 
      class=small>首页</SPAN></FONT></A> &gt;&gt; <A 
      href="http://www.vckbase.com/document"><FONT color=black><SPAN 
      class=small>文档中心</SPAN></FONT></A> &gt;&gt; <A 
      href="http://www.vckbase.com/document/journal"><SPAN class=small><FONT 
      color=black>在线杂志</FONT></SPAN></A> &gt;&gt; <A 
      href="http://www.vckbase.com/document/listdoc.asp?sclsid=1709"><SPAN 
      class=small><FONT color=black>ActiveX控件应用</FONT></SPAN></A></TD>
    <TD class=small align=right width="10%">[ <A 
      href="http://www.vckbase.com/document/journal/redir.asp?journal=29"><SPAN 
      class=small><FONT color=black>在线杂志 第29期</FONT></SPAN></A> ] 
</TD></TR></TBODY></TABLE>
<DIV align=center><BR><A href="http://www.uipower.com/" target=_blank><IMG 
height=125 src="VC_PDF.files/skin2.jpg" width=830 border=0></A> <!--br>
 <script type="text/javascript">
google_ad_client = "pub-4159669282587342";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "image";
google_ad_channel = "";
</script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script--></DIV><BR>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD background=VC_PDF.files/dotline2.gif height=1></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD width=40 height=74></TD>
    <TD vAlign=top width=* height=74>
      <FORM name=form2 action=/SYS/script/find.asp method=post>
      <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR>
          <TD><SPAN id=docinfo>[ <FONT color=#009900>原创文档</FONT> 本文适合中级读者 
            已阅读24083次 ]</SPAN></TD>
          <TD align=right><INPUT class=rect maxLength=20 size=10 name=keyword> 
            <SELECT class=rect name=gclsid> <OPTION value=100 
              selected>文档</OPTION> <OPTION value=200>代码</OPTION> <OPTION 
              value=400>工具</OPTION></SELECT> <INPUT type=image height=15 width=21 
            src="VC_PDF.files/go.gif" align=absMiddle border=0 name=imageField> 
          </TD></TR></TBODY></TABLE></FORM>
      <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR>
          <TD>
            <P align=center><B>做个PDF格式电子图书浏览器<BR>――<SPAN 
            style="FONT-SIZE: 10pt">浅谈一类控件的使用</SPAN></B><BR><BR>作者：<A 
            href="mailto:nie_yong@163.com">聂永 王永强</A></P>
            <P><BR><A 
            href="http://www.vckbase.com/code/downcode.asp?id=2285">下载源代码</A><BR><BR><IMG 
            src="VC_PDF.files/paragraph.gif"><B> 摘要</B> 
            <BR>　　通过PDF控件做一个PDF格式电子图书浏览器，学习一类控件的使用方法。<BR><BR><IMG 
            src="VC_PDF.files/paragraph.gif"><B> 关键词</B> PDF控件 电子图书浏览器 
            控件使用<BR><BR>　　首先声明，做这个PDF格式电子图书浏览器，其目的并不仅仅是教你如何做这个浏览器，而是教你如何正确使用控件进行编程。要提醒你的是，如果你想进行这个实验，那么你的机器上面必须安装有 
            Adobe Acrobat 4.0（或者更低版本）,经笔者实验，Adobe Acrobat 5.0 和 Adobe Acrobat 
            6.0 
            所提供的控件都是无法添加到我们的工程中去的。<BR>　　要新建一个基于对话框的工程。需要注意的是，一定要在第二步中选中ActiveX 
            Controls,否则在以后的步骤中还需要手动添加一些代码，挺麻烦的。下面的步骤按其默认既可。<BR><BR><IMG 
            height=327 src="VC_PDF.files/pdfbrw1.jpg" width=476 
            border=0><BR>图1<BR><BR>在下面出现的对话框中，可以把附加的控件删除。<BR>　　下面，我们要往项目里面加入PDF控件。Project- 
            &gt;Add To Project- &gt;Components and Controls- &gt;Registerded 
            ActiveX Controls,双击，在下面的控件窗口中找到"Acrobat Control 
            用于ActiveX"，选择下面的按钮"Insert",下面点击确定，正确插入后，我们可以在下面的框架里看到"Acrobat 
            Control for ActiveX"然后"Close"。<BR><BR><IMG height=324 
            src="VC_PDF.files/pdfbrw2.jpg" width=512 
            border=0><BR>图2<BR><BR>　　为了能够利用这个刚刚加入的控件，我们还需要在"ResourceView"加入一个Menu（菜单），具体做法为"PdfReader 
            resource"右健选择"Insert"，下面的就是新建一个"Menu"。但是，我们只是插入了这么个菜单，在程序中还是没有法调用的。这时返回到主对话框中，右健单击，选择"Properties"（属性），在"Menu"中选择刚才加入的Menu的ID。<BR>　　现在，为了使我们的这个PdfReader工作，我们要在菜单中加入"打开"，其ID可为ID_OPEN_PDFFILE,我们选择把"Pop-up"前的钩去除（注：如无说明，在菜单内加入其它选项，都是按照把"Pop-up"前钩去掉处理）。<BR><BR><IMG 
            height=178 src="VC_PDF.files/pdfbrw3.jpg" width=525 
            border=0><BR>图3<BR><BR>下面要用到ClassWizard(类向导)为刚刚加入的ID映射函数OnOpenPdffile（）。<BR><BR><IMG 
            height=181 src="VC_PDF.files/pdfbrw4.jpg" width=526 border=0><BR>图4 
            <BR><BR>此时需要在CPdfReaderDlg加入：<BR></P><PRE>public：CPdf  m_PdfFile;
</PRE>响应ID_OPEN_PDFFILE"打开"代码： <PRE>void CPdfReaderDlg::OnOpenPdffile() 
{ 
      char szFileFilter[]="PDF File(*.pdf)|*.pdf|All File(*.*)|*.*||";
	  CFileDialog FileDialog(true,"","",OFN_EXPLORER,szFileFilter,this);
		if(FileDialog.DoModal()==IDOK)
		{
			CString	FilePath=FileDialog.GetPathName();
		    m_PdfFile.LoadFile(FilePath);
 		}
}
</PRE>　　因为在上面的代码中我们直接引用PDF控件所产生类的函数的LoadFile()，很显然我们需要在"PdfReaderDlg.h"中加入"#include 
            "pdf.h"."也许心情迫切的你想编译现在的程序，行啊。运行一下，没有什么错误。选择"打开"，找到具有".pdf"格式的文件，可是会出现系统的警告错误。是什么原因呢，请想一想啊。对，我们还没有给控件在对话框内分配其存在空间呢。下面就是我们要做的。 
            利用Classwizard(类向导)，为WM_CREATE消息映射个函数OnCtreate().其代码如下： <PRE>int CPdfReaderDlg::OnCreate(LPCREATESTRUCT lpCreateStruct) 
{
	if (CDialog::OnCreate(lpCreateStruct) == -1)
		return -1;
	CRect rect;
	GetWindowRect(&amp;rect);
 	m_PdfFile.Create(NULL,WS_VISIBLE,rect,this,0);
	return 0;
}
</PRE>　　这时候你再编译，是不是可以观看PDF格式电子图书了？但是，细心的你，是不是发现，我们的窗口既没有最大化、最小化按钮，也不能在对话框边角位置拖动其大小。不用急，下面我们就准备做这些工作。<BR>返回到主对话框，右键单击，选择"Properties"（属性）,在"Styles"里"Border:"选择"Resizing",在"Minimize 
            box"和"Maximize box"前选择打钩。那么我们的问题就算解决了。<BR><BR><IMG height=225 
            src="VC_PDF.files/pdfbrw5.jpg" width=527 
            border=0><BR>图5<BR><BR>　　在下面的拖拉对话框大小的时候，你也许会发现，我们的阅读pdf电子图书那部分窗口却没有发生什么变化，是不是感到美中不足呢。对于这个问题，用一个函数就可以完美解决。我们需要用WM_SIZE映射一个函数OnSize()。<BR><PRE>void CPdfReaderDlg::OnSize(UINT nType, int cx, int cy) 
{
	CDialog::OnSize(nType, cx, cy);
	m_PdfFile.MoveWindow(0,0,cx,cy); //我们就需要加入这么一行就行了。
}
</PRE>　　在我们的菜单里就"打开"这么一个选择未免太单调，我们可以自己手动加入一些东西。比如，"上页""下页""首页""末页""退出"，其对应ID分别为：ID_PREVIOUS_PAGE,ID_NEXT_PAGE,ID_FIRST_PAGE,ID_LAST_PAGE,IDCANCEL（这里要说的是，在其菜单属性里把"Pop-up"前钩去掉），其对应函数分别为： 
<PRE>void CPdfReaderDlg::OnFirstPage() 
{
	 m_PdfFile.gotoFirstPage();
}

void CPdfReaderDlg::OnLastPage() 
{
	m_PdfFile.gotoLastPage();
	
}

void CPdfReaderDlg::OnNextPage() 
{
	m_PdfFile.gotoNextPage();
}

void CPdfReaderDlg::OnPreviousPage() 
{
	m_PdfFile.gotoPreviousPage();
	
}

void CPdfReaderDlg::OnCancel() 
{
	CDialog::OnCancel();
}
</PRE>　　我们能不能控制PDF格式电子图书显示的大小呢，答案是肯定的。在菜单中加入"视图"，其子项为"放大"，"缩小"，对应ID为ID_CHANG_BIG，ID_CHANG_SMALL。相应函数可为： 
<PRE>void CPdfReaderDlg::OnChangBig() 
{
	 i=i+50; //设定i的变化范围。你可以改变一下i每次变化的大小。
	m_PdfFile.setZoom(i);
	
}

void CPdfReaderDlg::OnChangSmall() 
{
	i=i-50;
	m_PdfFile.setZoom(i);
	
}
</PRE>注意：要在PdfReaderDlg.cpp前面加上 <PRE>int i=100;       //初始化i的大小
</PRE>　　当然，你也可以添加一个新的对话框 
            ，用来设定PDF格式电子图书显示的大小。新加一个对话框后，生成相应的类，如CFind。在新生成的对话框内添加"Static"和 
            "Edit"控件。见下表和图8： <PRE>Static Text 控件	自定义大小：
Edit Box  控件	IDC_FIND
</PRE><IMG height=285 src="VC_PDF.files/pdfbrw6.jpg" width=525 
            border=0><BR>图6<BR><BR>声明后，打开Classwizard(类向导)，选择"Member 
            Variables",选择"Add Variable",为IDC_FIND映射float类型变量m_find。 <BR><BR><IMG 
            height=476 src="VC_PDF.files/pdfbrw7.jpg" width=741 border=0><BR>图7 
            <BR><BR>现在往菜单视图里加入"自定义大小",ID为ID_SET_SIZE，相应函数极其代码如下： <PRE>void CPdfReaderDlg::OnSetSize() 
{
	CFind getsize;
	getsize.DoModal();
	m_PdfFile.setZoom(getsize.m_find);
}
</PRE>　　仅仅加入这些代码，还不行，在OSetSize（）直接使用CFind，这个类还没有声明，因此我们需要在"PdfReaderDlg.h"里加入"Find.h". 
            如果考虑到"打印"的话，在菜单里加入"打印"，ID为ID_PRINT_PDFFILE，映射对应函数： <PRE>void CPdfReaderDlg::OnPrintPdffile() 
{
	 m_PdfFile.Print();
}
</PRE>　　到此时，我们的这个PDF电子图书浏览器算是初具规模了。下面我们要添加一些小的功能。 
            比如在窗口栏内显示阅读PDF电子图书的名称。这项功能可在下面函数里添加： <PRE>void CPdfReaderDlg::OnOpenPdffile() 
{   CString m_Caption;   //新添加的一个变量，用于显示窗口标题
    CString m_Word=" 现在正在观看：";//也是新添加的
	char szFileFilter[]="PDF File(*.pdf)|*.pdf|All File(*.*)|*.*||";
	CFileDialog FileDialog(TRUE,NULL,NULL,OFN_HIDEREADONLY,szFileFilter);
	if(FileDialog.DoModal()==IDOK)
	{   CString FileName=FileDialog.GetFileTitle();
	    m_Caption=m_Word+FileName;//CString类型的重载操作。
		SetWindowText(m_Caption);//设置在窗口显示
		CString PathName=FileDialog.GetPathName();
		m_PdfFile.LoadFile(PathName);
	}
}
</PRE>　　我们要对这个浏览器整容，我们要给对话框添加红色背景。 SetDialogBkColor(RGB(255,0,0) ); 
            把上面这句添加到InitInstance()里既可。我们运行出来的对话框左上角的那个系统默认图标，实在没有个性。好办，我们要换成我们喜欢的小图标。首先用鼠标选中，按"Delete"键删除系统默认ICO图标，然后在Menu上右键单击，选择"Insert"，在下面的出现的对话框中选中"Icon"，单击"Import"按钮选择你要插入的Icon图标。在新插入的Icon图标上单击右键，选择"Properties",把其ID修改为"IDR_MAINFRAME"，现在运行一下，看看效果。 
            <BR><BR><IMG height=353 src="VC_PDF.files/pdfbrw8.jpg" width=484 
            border=0><BR>图8<BR><BR>　　我们的程序到此算是告一段落了。下面我们要总结一下。我们从加入的"Acrobat 
            Control 用于ActiveX"控件所产生的类"CPdf"引用的函数有： <BR><PRE>BOOL CPdf::LoadFile(LPCTSTR fileName)
void CPdf::Print()     //用于打印文件              
void CPdf::setZoom(float percent)//设置页面的大小
void CPdf::gotoFirstPage()//到第一页
void CPdf::gotoLastPage()//到最后一页
void CPdf::gotoNextPage()//到下一页
void CPdf::gotoPreviousPage()//到上一页
</PRE>　　这些函数相对于类"CPdf"来说，只是很少的一部分，下面就要看各位的努力去丰富我们的"PdfReader"浏览器了。因为，本文的目的，不仅仅是教会您如何做一个PDF浏览器，而是通过做这么个简易的浏览器，触类旁通。如果您仔细的阅读了本文，那么首先庆祝您现在利用FLASH控件"Shockwave 
            Flash Object "，Windows Media Player提供的"ActiveMovieObject 
            Control"控件，还有RealOne Player播放器提供的控件"RealPlayer G2 
            Control"（前提是你的电脑上面安装有RealOne）等一类控件可以自己制作完全属于自己的FLASH播放器，Windows 
            Media播放器，以及RealOne 播放器等。最后需要说明的是，关于添加控件，也可以在对话框内右键单击，选择"Insert 
            ActiveX 
            Control"，在下面出现的控件选择对话框里选择我们需要用到的控件既可。下面的步骤和我们在前面所介绍的步骤类似，在此不再介绍。至于，本文所牵涉到的源码，如果各位想参考的话，其下载地址为： 
<PRE>http://i8boy.go.nease.net/vccode/pdfreader.rar
</PRE>有什么问题可发信到：nie_yong@163.com，定会全力解答。祝愿各位，都能在编程的天空自由翱翔！<BR></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR>
<DIV align=center>
<SCRIPT type=text/javascript><!--
google_ad_client = "pub-4159669282587342";
google_alternate_color = "FFFFFF";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "text_image";
google_ad_channel ="";
google_color_border = "B4D0DC";
google_color_bg = "ECF8FF";
google_color_link = "0000CC";
google_color_url = "008000";
google_color_text = "6F6F6F";
//--></SCRIPT>

<SCRIPT src="VC_PDF.files/show_ads.js" type=text/javascript>
</SCRIPT>
<BR><BR>
<TABLE class=small height=18 cellSpacing=0 cellPadding=0 width="98%" border=0>
  <TBODY>
  <TR vAlign=center>
    <TD width="47%" bgColor=#a0d39b><IMG height=10 
      src="VC_PDF.files/toplogo.gif" width=10>最新评论 <A 
      href="http://www.vckbase.com/SYS/script/viewcomment.asp?gclsid=100&amp;itemid=1049" 
      target=_blank><SPAN class=small>[发表评论]</SPAN></A> <A 
      href="http://www.vckbase.com/support/contribute.html" target=_blank><SPAN 
      class=small>[文章投稿]</SPAN></A></TD>
    <TD align=right width="53%" bgColor=#a0d39b><IMG height=9 
      src="VC_PDF.files/rec1.gif" width=9> <A 
      href="http://www.vckbase.com/SYS/script/viewcomment.asp?gclsid=100&amp;itemid=1049" 
      target=_blank><SPAN class=small>查看所有评论</SPAN></A> <IMG height=9 
      src="VC_PDF.files/rec1.gif" width=9> <A 
      href="http://www.vckbase.com/SYS/script/writemail.asp?gclsid=100&amp;itemid=1049&amp;title=%d7%f6%b8%f6PDF%b8%f1%ca%bd%b5%e7%d7%d3%cd%bc%ca%e9%e4%af%c0%c0%c6%f7" 
      target=_blank><SPAN class=small>推荐给好友</SPAN></A> <IMG height=9 
      src="VC_PDF.files/rec1.gif" width=9> <A 
      href="javascript:window.print();"><SPAN 
  class=small>打印</SPAN></A></TD></TR></TBODY></TABLE>
<TABLE class=small cellSpacing=1 cellPadding=0 width="98%" bgColor=#ffffff 
border=0>
  <TBODY>
  <TR>
    <TD bgColor=#ffffff><BR><IMG height=11 src="VC_PDF.files/doc2.gif" 
      width=11 align=absMiddle> 
      为什么提示说pdf.ocx没有注册<BR>我用regsvr32进行注册，还是没用啊，<BR>acrobat&nbsp;reader我也重装了，还是不行。。。。 
      ( ldqmoon 发表于 2005-10-18 16:39:00)<BR>&nbsp;<BR><IMG height=11 
      src="VC_PDF.files/doc2.gif" width=11 align=absMiddle> 
      怎样才使该pdf浏览器双击打开pdf打开,或拖拽打开pdf文件. ( phiqy 发表于 2004-6-14 
      16:46:00)<BR>&nbsp;<BR>.......................................................<BR><A 
      href="http://www.vckbase.com/SYS/script/viewcomment.asp?gclsid=100&amp;itemid=1049" 
      target=_blank><SPAN class=small>More...</SPAN></A> 
</TD></TR></TBODY></TABLE></DIV><BR>
<DIV align=right><BR><SPAN class=small>版权所有 &copy; 1999 - 2008 VC知识库&nbsp; 
<BR><BR></SPAN></DIV></BODY></HTML>
