<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0048)http://www.vckbase.com/document/viewdoc/?id=1747 -->
<HTML><HEAD><TITLE>VC知识库文章 - XML文件的简单初步解析</TITLE>
<META http-equiv=Content-Type content="text/html; charset=gb2312">
<META content=xml,parser，解析 name=keywords>
<META content=xml,parser，解析 name=description><LINK 
href="VC知识库文章 - XML文件的简单初步解析.files/style.css" rel=stylesheet>
<META content="MSHTML 6.00.2900.3243" name=GENERATOR></HEAD>
<BODY bgColor=#ffffff leftMargin=0 topMargin=0>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR bgColor=#a0d39b>
    <TD width="14%" height=78>&nbsp;<IMG height=13 
      src="VC知识库文章 - XML文件的简单初步解析.files/vckcom.gif" width=109></TD>
    <TD align=right width="76%"><A href="http://www.longmai.com.cn/" 
      target=_blank><IMG height=70 
      src="VC知识库文章 - XML文件的简单初步解析.files/longmai.gif" width=195 align=middle 
      border=0></A></TD>
    <TD vAlign=bottom align=right height=78><IMG height=27 
      src="VC知识库文章 - XML文件的简单初步解析.files/earch.gif" width=89></TD></TR>
  <TR bgColor=#eeeeee>
    <TD colSpan=2><FONT class=small color=#333333>::</FONT><A 
      href="http://www.vckbase.com/"><FONT color=black><SPAN 
      class=small>首页</SPAN></FONT></A> &gt;&gt; <A 
      href="http://www.vckbase.com/document"><FONT color=black><SPAN 
      class=small>文档中心</SPAN></FONT></A> &gt;&gt; <A 
      href="http://www.vckbase.com/document/journal"><SPAN class=small><FONT 
      color=black>在线杂志</FONT></SPAN></A> &gt;&gt; <A 
      href="http://www.vckbase.com/document/listdoc.asp?sclsid=2201"><SPAN 
      class=small><FONT color=black>XML</FONT></SPAN></A></TD>
    <TD class=small align=right width="10%">[ <A 
      href="http://www.vckbase.com/document/journal/redir.asp?journal=51"><SPAN 
      class=small><FONT color=black>在线杂志 第51期</FONT></SPAN></A> ] 
</TD></TR></TBODY></TABLE>
<DIV align=center><BR><A 
href="http://www.uipower.com/showjob.asp?jobid=20070730214939" 
target=_blank><IMG height=116 src="VC知识库文章 - XML文件的简单初步解析.files/uipower2.jpg" 
width=990 border=0></A> <!--br>
 <script type="text/javascript">
google_ad_client = "pub-4159669282587342";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "image";
google_ad_channel = "";
</script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script--></DIV><BR>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD background="VC知识库文章 - XML文件的简单初步解析.files/dotline2.gif" 
  height=1></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD width=40 height=74></TD>
    <TD vAlign=top width=* height=74>
      <FORM name=form2 action=/SYS/script/find.asp method=post>
      <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR>
          <TD><SPAN id=docinfo>[ <FONT color=#009900>原创文档</FONT> 本文适合初级读者 
            已阅读4843次 ]</SPAN></TD>
          <TD align=right><INPUT class=rect maxLength=20 size=10 name=keyword> 
            <SELECT class=rect name=gclsid> <OPTION value=100 
              selected>文档</OPTION> <OPTION value=200>代码</OPTION> <OPTION 
              value=400>工具</OPTION></SELECT> <INPUT type=image height=15 width=21 
            src="VC知识库文章 - XML文件的简单初步解析.files/go.gif" align=absMiddle border=0 
            name=imageField> </TD></TR></TBODY></TABLE></FORM>
      <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
        <TBODY>
        <TR>
          <TD>
            <P align=center><B>XML文件的简单初步解析</B><BR><BR>作者：<A 
            href="mailto:Jeffrey.nupt@gmail.com">南京邮电大学 吴登荣</A></P>
            <P><A 
            href="http://www.vckbase.com/code/downcode.asp?id=3017">下载源代码</A><BR><BR><B>摘要</B>：通过扫描字符串及结构体数组，实现对XML文件的简单初步解析。<BR><BR><B>关键字</B>：XML，解析<BR><BR><B>主要算法</B>：XML文件的实质是字符串，解析XML的工作主要是了解XML的规则，从而对字符串进行分析，解析。从XML文件的开始扫描，连续获得2个标签的位置，转化为字符串，比较firstname和nextname，如果匹配关闭，则把标签名，内容，层次，存放到结构体数组中，继续扫描，如果不匹配，则把firstname压栈，继续扫描，直到firstname和nextname匹配或者与栈顶元素匹配。本题主要是自己设计一种数据结构和一种算法来把解析出来的XML数据信息，合理的存放，从而实现最简单最初步的解析。我是在控制台上实现的，运行后可以把XML的所有结点的标签名，值，以及它位于整个XML文件的层次。具体的请参考源程序，在VC6.0下测试通过（其中的web.xml为程序运行的初始xml文件）。<BR><BR>结构体定义：<BR></P><PRE>struct xmlnode
{
	CString name;//标签名
	CString value;//内容
	int id;//这个标签的层次，通过栈实现
};
xmlnode node[1000]; 
</PRE>解析函数： <PRE>void str2array(CString context)
{
	CString firstname;
	CString nextname;
	CString tempname;
	CString tempvalue;
	CStringArray stack;//一个记录标签是否关闭的栈
	stack.Add("");
	int max=0;
	int nid=1;
	int k=0;
	int i1,i2,j1,j2,k1,k2;
	while((k&lt;context.GetLength())&amp;&amp;(context[k]!=''&lt;''))//确定各个标签的位置
	{
		k++;
	}
	i1=k; 
	while((k&lt;context.GetLength())&amp;&amp;(context[k]!='' '')&amp;&amp;(context[k]!=''&gt;''))
	{
		k++;
	}
	k1=k;
	while((k&lt;context.GetLength())&amp;&amp;(context[k]!=''&gt;''))
	{
		k++;
	}
	j1=k;
	firstname=getcontext(context,i1,k1);//获得第一个标签
	while((k&lt;context.GetLength())&amp;&amp;(context[k]!=''&lt;''))//确定各个标签的位置
	{
		k++;
	}
	i2=k;
	while((k&lt;context.GetLength())&amp;&amp;(context[k]!='' '')&amp;&amp;(context[k]!=''&gt;''))
	{
		k++;
	}
	k2=k;
	while((k&lt;context.GetLength())&amp;&amp;(context[k]!=''&gt;''))
	{
		k++;
	}
	j2=k;
	nextname=getcontext(context,i2,k2);//获得第二个标签
	tempname=''/''+firstname;
	while(k&lt;context.GetLength())
	{
		if(tempname.Compare(nextname)==0)//该标签关闭
		{
			node[count].name=firstname;
			tempvalue=getcontext(context,j1,i2);
			tempvalue.TrimLeft();
			tempvalue.TrimRight();
			node[count].value=tempvalue;
			node[count].id=nid;
			count++;
			do
			{
				while((k&lt;context.GetLength())&amp;&amp;(context[k]!=''&lt;''))//获得下一个标签
				{
					k++;
				}
				i2=k;
				while((k&lt;context.GetLength())&amp;&amp;(context[k]!='' '')&amp;&amp;(context[k]!=''&gt;''))
				{
					k++;
				}
				k2=k;
				while((k&lt;context.GetLength())&amp;&amp;(context[k]!=''&gt;''))
				{
					k++;
				}
				j2=k;
				nextname=getcontext(context,i2,k2);
				if(nextname.Compare(stack.GetAt(max))==0)
				{
					stack.RemoveAt(max);
					nid--;
					max--;
				}
			}while((nextname.GetLength()&gt;0)&amp;&amp;(nextname[0]==''/''));
			//same
		}
		else//标签没有关闭，压栈
		{
			tempname=''/''+firstname;
			max++;
			stack.Add(tempname);
			node[count].name=firstname;
			node[count].value="";
			node[count].id=nid;
			count++;
			nid++;
			//different
		}
		firstname=nextname;
		i1=i2;
		k1=k2;
		j1=j2;
		while((k&lt;context.GetLength())&amp;&amp;(context[k]!=''&lt;''))//获得下一个标签
		{
			k++;
		}
		i2=k;
		while((k&lt;context.GetLength())&amp;&amp;(context[k]!='' '')&amp;&amp;(context[k]!=''&gt;''))
		{
			k++;
		}
		k2=k;
		while((k&lt;context.GetLength())&amp;&amp;(context[k]!=''&gt;''))
		{
			k++;
		}
		j2=k;
		nextname=getcontext(context,i2,k2);
		tempname=''/''+firstname;
	}
}
</PRE>附言：<BR>本题为南京邮电大学计算机学院科协交流题,本程序对XML开始的说明部分不能解析，对注释也不能解析，只能达到一个最基本的解析。 
            <BR>
            <P></P></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><BR>
<DIV align=center>
<SCRIPT type=text/javascript><!--
google_ad_client = "pub-4159669282587342";
google_alternate_color = "FFFFFF";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "text_image";
google_ad_channel ="";
google_color_border = "B4D0DC";
google_color_bg = "ECF8FF";
google_color_link = "0000CC";
google_color_url = "008000";
google_color_text = "6F6F6F";
//--></SCRIPT>

<SCRIPT src="VC知识库文章 - XML文件的简单初步解析.files/show_ads.js" type=text/javascript>
</SCRIPT>
<BR><BR>
<TABLE class=small height=18 cellSpacing=0 cellPadding=0 width="98%" border=0>
  <TBODY>
  <TR vAlign=center>
    <TD width="47%" bgColor=#a0d39b><IMG height=10 
      src="VC知识库文章 - XML文件的简单初步解析.files/toplogo.gif" width=10>最新评论 <A 
      href="http://www.vckbase.com/SYS/script/viewcomment.asp?gclsid=100&amp;itemid=1747" 
      target=_blank><SPAN class=small>[发表评论]</SPAN></A> <A 
      href="http://www.vckbase.com/support/contribute.html" target=_blank><SPAN 
      class=small>[文章投稿]</SPAN></A></TD>
    <TD align=right width="53%" bgColor=#a0d39b><IMG height=9 
      src="VC知识库文章 - XML文件的简单初步解析.files/rec1.gif" width=9> <A 
      href="http://www.vckbase.com/SYS/script/viewcomment.asp?gclsid=100&amp;itemid=1747" 
      target=_blank><SPAN class=small>查看所有评论</SPAN></A> <IMG height=9 
      src="VC知识库文章 - XML文件的简单初步解析.files/rec1.gif" width=9> <A 
      href="http://www.vckbase.com/SYS/script/writemail.asp?gclsid=100&amp;itemid=1747&amp;title=XML%ce%c4%bc%fe%b5%c4%bc%f2%b5%a5%b3%f5%b2%bd%bd%e2%ce%f6" 
      target=_blank><SPAN class=small>推荐给好友</SPAN></A> <IMG height=9 
      src="VC知识库文章 - XML文件的简单初步解析.files/rec1.gif" width=9> <A 
      href="javascript:window.print();"><SPAN 
  class=small>打印</SPAN></A></TD></TR></TBODY></TABLE>
<TABLE class=small cellSpacing=1 cellPadding=0 width="98%" bgColor=#ffffff 
border=0>
  <TBODY>
  <TR>
    <TD bgColor=#ffffff><BR><IMG height=11 
      src="VC知识库文章 - XML文件的简单初步解析.files/doc2.gif" width=11 align=absMiddle> 
      这样解析&nbsp;遇到&nbsp;CDATA很可能会失败的。<BR>因为CDATA里面的字符是不编码的<BR>最好是采用MSXML的&nbsp;SAX方式&nbsp;<BR>( 
      wangjia184 发表于 2008-1-18 13:05:00)<BR>&nbsp;<BR><IMG height=11 
      src="VC知识库文章 - XML文件的简单初步解析.files/doc2.gif" width=11 align=absMiddle> 
      我记得有一个第三方的CMarkup类可以对XML进行专门的解析<BR>解析得还比较好<BR>( bingxuefly 发表于 2007-4-24 
      10:58:00)<BR>&nbsp;<BR><IMG height=11 
      src="VC知识库文章 - XML文件的简单初步解析.files/doc2.gif" width=11 align=absMiddle> 
      vc&nbsp;vb&nbsp;dll&nbsp;控件学习网(&nbsp;源码　)<BR>http://konny520.diy.myrice.com<BR><BR>vc&nbsp;vb&nbsp;dll&nbsp;控件学习网(&nbsp;源码　)<BR>http://konny520.diy.myrice.com 
      ( konny 发表于 2007-3-5 
      15:59:00)<BR>&nbsp;<BR>.......................................................<BR><A 
      href="http://www.vckbase.com/SYS/script/viewcomment.asp?gclsid=100&amp;itemid=1747" 
      target=_blank><SPAN class=small>More...</SPAN></A> 
</TD></TR></TBODY></TABLE></DIV><BR>
<DIV align=right><BR><SPAN class=small>版权所有 &copy; 2006 VC知识库&nbsp; 
<BR><BR></SPAN></DIV></BODY></HTML>
