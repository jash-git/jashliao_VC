var baseJs={time:8,ct:0,ut:0,firstClick:!0,mainParams:{rem:75,clickTime:0,index:0,bool:!1,timer:null,timeOut:null},init:function(){$("#change").html(baseJs.time);var a=this;a.protocol=window.location.protocol,a.showId=a._getQueryString("si"),a.containerID=a._getQueryString("containerID"),window.addEventListener("message",function(e){if(a.containerID!=e.data.containerID)return!1;"ADDataReady"==e.data.action&&(window.newAwards=e.data.data,window.clickPlugin=e.data.clickPlugin,window.gameData=e.data.pluginData,window.backupData=e.data.backupData,a.game=e.data.game,a.setGameData()),"askOpenDialog"==e.data.action&&window.parent.postMessage({action:"openMyAward",containerID:a.containerID,list:JSON.parse(window.localStorage.getItem("myAward"))},"*"),"closeDialogForCard"==e.data.action&&a.cardRecover()}),a.cardPostion(),a.clickCard(),a.cardRecover(),a.openAward(),a.getInfos(),a.setRemainTimes()},cardPostion:function(){var a=$(".box li"),e=a.length,s=[[34/baseJs.mainParams.rem,0],[273/baseJs.mainParams.rem,0],[512/baseJs.mainParams.rem,0],[34/baseJs.mainParams.rem,268/baseJs.mainParams.rem],[273/baseJs.mainParams.rem,268/baseJs.mainParams.rem],[512/baseJs.mainParams.rem,268/baseJs.mainParams.rem]];baseJs.mainParams.bool;baseJs.mainParams.index=e;for(var t=0;t<e;t++)!function(e){var t=setTimeout(function(){a.eq(e).css({left:s[e][0]+"rem",top:s[e][1]+"rem"}),clearTimeout(t)},300*e)}(t);clearTimeout(baseJs.mainParams.timeOut),localStorage.getItem("timesCardsMin"+this.showId)<8&&(baseJs.mainParams.timeOut=setTimeout(function(){clearInterval(baseJs.mainParams.timer),baseJs.mainParams.timer=setInterval(function(){baseJs.mainParams.bool=!0,$(".box li").eq(baseJs.mainParams.index-1).removeClass("active"),baseJs.mainParams.index%=6,$(".box li").eq(baseJs.mainParams.index).addClass("active"),baseJs.mainParams.index++},1e3)},1e3))},clickCard:function(){$(".box li").on("mousedown",function(a){baseJs.ct=(new Date).getTime()}).on("mouseup",function(){baseJs.ut=(new Date).getTime()}),$(".box").on("click","li",function(){baseJs.times<=0&&baseJs.clickBtn(!1),new Date-baseJs.mainParams.clickTime>1e3&&baseJs.mainParams.bool&&(baseJs.times>0?($("#mask-card").show(),clearInterval(baseJs.mainParams.timer),$(".box li").removeClass("active"),$(this).addClass("open-card"),$(this).on("animationend",function(){$(this).removeClass("open-card"),$(".box li").css({left:512/baseJs.mainParams.rem+"rem",top:268/baseJs.mainParams.rem+"rem"}),$("#mask-card").fadeOut(),baseJs.clickBtn(!0),$(this).off("animationend")})):($(".box li").removeClass("active"),baseJs.clickBtn(!1)))})},cardRecover:function(){$(".box li").removeClass("active"),baseJs.mainParams.clickTime=new Date,baseJs.mainParams.index=0,baseJs.cardPostion()},_getQueryString:function(a){var e=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),s=window.location.search.substr(1).match(e);return null!=s?unescape(s[2]):null},getInfos:function(){var a=0,e=this,s=window.setInterval(function(){if(a++,window.newAwards){for(var t in newAwards.ads)newAwards.ads[t].impurl=newAwards.impurl,newAwards.ads[t].imptk.push(newAwards.impurl+newAwards.ads[t].imparg);window.clearInterval(s)}a>3&&!window.newAwards&&(e.askData(),a=0)},100)},setRemainTimes:function(){var a=this;try{var e=localStorage.getItem("timesCardsMin"+a.showId)}catch(s){var e=a.getCookie("timesCardsMin"+a.showId)}a.isDateChange()?(a.times=a.time,baseJs.syncRemains(a.times)):(a.times=a.time-e,baseJs.syncRemains(a.times)),$(".lastTimes").find("span").html(a.times)},openAward:function(){var a=this;$("#myAwards").on("click",function(){window.parent.postMessage({action:"openMyAward",containerID:a.containerID,list:JSON.parse(window.localStorage.getItem("myAward"))},"*")})},isDateChange:function(){var a="",e=this,s=new Date;if(!this.showId)return!1;s=""+s.getFullYear()+(s.getMonth()+1)+s.getDate();try{a=localStorage.getItem("rawDateCardsMin"+e.showId)}catch(t){a=baseJs.getCookie("rawDateCardsMin"+e.showId)}if(s!=a){try{localStorage.setItem("rawDateCardsMin"+e.showId,s),localStorage.removeItem("statusCardsMin"+e.showId),localStorage.removeItem("timesCardsMin"+e.showId)}catch(t){baseJs.setCookie("rawDateCardsMin"+e.showId,s,1),baseJs.delCookie("statusCardsMin"+e.showId),baseJs.delCookie("timesCardsMin"+e.showId)}return!0}return!1},askData:function(){window.parent.postMessage({action:"askADData",containerID:this.containerID,si:this.showId},"*")},openDialog:function(a){window.parent.postMessage({action:"openDialog",data:a,containerID:this.containerID,si:this.showId},"*")},clickBtn:function(a){if("undefined"==typeof newAwards)return!1;baseJs.firstClick&&(window.parent.postMessage({action:"clickGame",containerID:this.containerID},"*"),baseJs.firstClick=!1);var e=this;if(a){e.adClickPlugin(e.ct,e.ut,e.times),e.times-=1,e.times=e.times>0?e.times:0,$(".lastTimes").find("span").html(e.times);try{localStorage.setItem("timesCardsMin"+e.showId,e.time-e.times)}catch(i){e.setCookie("timesCardsMin"+e.showId,e.time-e.times)}try{if(!newAwards||!newAwards.ads){var s={type:"none"};return void e.openDialog(s)}if(0==newAwards.ads.length){var s={type:"none"};return void e.openDialog(s)}var t=newAwards.ads.shift(),s={item:t,title:t.desc,ticket:t.img,btntext:"\u7acb\u5373\u9886\u53d6",awardlink:t.curl,type:"bingo"};e.saveAward(t),e.openDialog(s)}catch(n){}}else{var s={type:"over"};e.openDialog(s)}},adClickPlugin:function(a,e,s){var t=this,i=window.clickPlugin;if(!window.clickPlugin)return!1;i=i.replace("__EVENT_TIME_START__",a).replace("__EVENT_TIME_END__",e).replace("__ACT_NUM__",s),baseJs.syncRemains(s),$.each(i.split(","),function(a,e){t.sendLog(e)})},sendLog:function(a){window.parent.postMessage({action:"sendLog",url:a,containerID:this.containerID,si:this.showId},"*")},syncRemains:function(a){a-=1,window.parent.postMessage({action:"syncRemains",containerID:this.containerID,times:a},"*")},saveAward:function(a){var e=JSON.parse(window.localStorage.getItem("myAward"))||[],s=!1;if(e.length>0)for(var t=0;t<e.length;t++){e[t].desc==a.desc&&(s=!0);var i=(new Date).getTime();i-e[t].expireDate>=6048e5&&e.splice(t,1)}s||(a.expireDate=(new Date).getTime(),e.push(a),window.localStorage.setItem("myAward",JSON.stringify(e)))},setGameData:function(){var a=JSON.parse(window.gameData.dj_interaction),e=a.skin.styleUrl?a.skin.styleUrl:"//cjhd.mediav.com/css/card/card_default.css";$("head").append('<link rel="stylesheet" href="'+e+'" type="text/css"/>'),$("#wrap").fadeIn(1e3),$(".page-loading").fadeOut(1e3)}};